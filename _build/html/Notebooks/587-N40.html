
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Kinetics II &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebooks/587-N40';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kinetics III" href="587-N41.html" />
    <link rel="prev" title="Kinetics I" href="587-N39.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="../_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../Chapter2.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="587-N39.html">Kinetics I</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Kinetics II</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N41.html">Kinetics III</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/CEN587/main?urlpath=tree/Notebooks/587-N40.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/CEN587" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/CEN587/issues/new?title=Issue%20on%20page%20%2FNotebooks/587-N40.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Notebooks/587-N40.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Kinetics II</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integral-analysis">Integral Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-solution">First Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-solution">Second Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-order-solution">Third Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-well-do-these-models-describe-the-observed-trends">How well do these models describe the observed trends?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-least-squares-formally">Nonlinear Least Squares, formally</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minimizing-the-error-with-numerical-tools">Minimizing the error with numerical tools</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-first-order-fit">Analysis of First Order Fit</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-2nd-order-fit">Analysis of 2nd order fit</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="kinetics-ii">
<h1>Kinetics II<a class="headerlink" href="#kinetics-ii" title="Link to this heading">#</a></h1>
<p>This Notebook continues with the analysis of kinetic data obtained in a constant volume batch reactor. It considers the same data set from <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html">Notebook 39</a>, where we applied a differential method of analysis to estimate the reaction order and rate constant for an <span class="math notranslate nohighlight">\(A \rightarrow B\)</span> reaction. In this Notebook, we will work through the same data set using an integral method of analysis. This will result in nonlinear models that describe how species concentration varies as a function of time. When we are working with nonlinear models and data sets, we have two choices when making decisions about the model that best describes our data and in determining the numerical values of the parameters in that model. We can use nonlinear regression (nonlinear least squares) or, as in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html">Notebook 39</a>, we can attempt to linearize models and data and then apply the methods of linear least sqaures. We will consider both approaches here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">opt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span>
</pre></div>
</div>
</div>
</div>
<section id="example-problem-01">
<h2>Example Problem 01<a class="headerlink" href="#example-problem-01" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This problem statement is the same as <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html#example-problem-01">Example Problem 01 in Notebook 39</a>, but we will apply a new method of analysis.</p>
</div>
<p>The following reaction is carried out in a well-mixed, isothermal, constant volume batch reactor. The concentration of species <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> in the tank are initially <span class="math notranslate nohighlight">\(C_{A0} = 10 \mathrm{M}\)</span> and <span class="math notranslate nohighlight">\(C_{B0} = 0 \mathrm{M}\)</span> at <span class="math notranslate nohighlight">\(t = 0\)</span>. You may assume that the fluid inside of the reactor has constant density.</p>
<div class="math notranslate nohighlight">
\[A \longrightarrow B\]</div>
<p>We measure the concentration of species <span class="math notranslate nohighlight">\(A\)</span> in this reactor, monitoring how it changes with time. The collected data are tabulated below.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>time (s)</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(C_A \ (\mathrm{mol \ L^{-1}})\)</span></p></th>
<th class="head text-center"><p>time (s)</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(C_A \ (\mathrm{mol \ L^{-1}})\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>0</p></td>
<td class="text-center"><p>10.0</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>4.96</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>1</p></td>
<td class="text-center"><p>9.58</p></td>
<td class="text-center"><p>55</p></td>
<td class="text-center"><p>4.10</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>2</p></td>
<td class="text-center"><p>9.21</p></td>
<td class="text-center"><p>89</p></td>
<td class="text-center"><p>3.33</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>3</p></td>
<td class="text-center"><p>8.87</p></td>
<td class="text-center"><p>144</p></td>
<td class="text-center"><p>2.68</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>5</p></td>
<td class="text-center"><p>8.30</p></td>
<td class="text-center"><p>233</p></td>
<td class="text-center"><p>2.13</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>8</p></td>
<td class="text-center"><p>7.62</p></td>
<td class="text-center"><p>377</p></td>
<td class="text-center"><p>1.69</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>13</p></td>
<td class="text-center"><p>6.79</p></td>
<td class="text-center"><p>610</p></td>
<td class="text-center"><p>1.34</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>21</p></td>
<td class="text-center"><p>5.88</p></td>
<td class="text-center"><p>987</p></td>
<td class="text-center"><p>1.06</p></td>
</tr>
</tbody>
</table>
</div>
<p>You may assume that the rate law for this reaction follows basic, power law kinetics, i.e.:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^{\alpha}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is a presently unknown integer. Use the data in the above table to determine the reaction order, <span class="math notranslate nohighlight">\(\alpha\)</span>, and to estimate the rate constant, <span class="math notranslate nohighlight">\(k\)</span>, as precisely as possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###################################################################################################</span>
<span class="c1"># Store experimental time and concentration data in separate arrays                               #</span>
<span class="c1">###################################################################################################</span>

<span class="n">tdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">987</span><span class="p">])</span> <span class="c1">#experimental measurement time in seconds</span>
<span class="n">CAdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.00</span><span class="p">,</span> <span class="mf">9.58</span><span class="p">,</span> <span class="mf">9.21</span><span class="p">,</span> <span class="mf">8.87</span><span class="p">,</span> <span class="mf">8.30</span><span class="p">,</span> <span class="mf">7.62</span><span class="p">,</span> <span class="mf">6.79</span><span class="p">,</span> <span class="mf">5.88</span><span class="p">,</span> <span class="mf">4.96</span><span class="p">,</span> <span class="mf">4.10</span><span class="p">,</span> <span class="mf">3.33</span><span class="p">,</span> <span class="mf">2.68</span><span class="p">,</span> <span class="mf">2.13</span><span class="p">,</span> <span class="mf">1.69</span><span class="p">,</span> <span class="mf">1.34</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">])</span><span class="c1"># Concentrations in moles per liter</span>
<span class="n">tfine</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">#set of times on a finely spaced grid; use for generating smooth line graphs</span>

<span class="c1">###################################################################################################</span>
<span class="c1"># Graph experimental CA vs t data                                                                 #</span>
<span class="c1">###################################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2f9ae0c639e1f10b6774dfbfbfa434aeb824d31f54771c351fd2d0bc03dc8968.png" src="../_images/2f9ae0c639e1f10b6774dfbfbfa434aeb824d31f54771c351fd2d0bc03dc8968.png" />
</div>
</div>
<section id="solution-to-example-problem-01">
<h3>Solution to Example Problem 01<a class="headerlink" href="#solution-to-example-problem-01" title="Link to this heading">#</a></h3>
<p>We want to use the data to determine the rate law and kinetic parameters <span class="math notranslate nohighlight">\((\alpha, k)\)</span>. This is an inverse problem, and we need to find a way to extract this information from the data. Since this reaction is overall (not an elementary step), we can at most propose that the rate of reaction depends on temperature (which we capture with a rate constant) and the concentration of the reactant, <span class="math notranslate nohighlight">\(A\)</span>. At the moment, the reaction order is unknown, and propose general power law kinetics with an unknown reaction order <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha\]</div>
<p>As discussed in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html">Notebook 39</a>, the data available is a set of values for <span class="math notranslate nohighlight">\(C_A\)</span> measured at various values of <span class="math notranslate nohighlight">\(t\)</span>. We do not yet have a model that could describe the functional relationship between <span class="math notranslate nohighlight">\(C_A\)</span> and <span class="math notranslate nohighlight">\(t\)</span>, we only have a proposed rate law that describes the general relationship between <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(C_A\)</span>. In order to model the dependence of <span class="math notranslate nohighlight">\(C_A\)</span> on <span class="math notranslate nohighlight">\(t\)</span>, we need to solve a material balance on this batch reactor – it may not be immediately intuitive, but we make this choice because, fundamentally, the material balance is what specifies the relationship between <span class="math notranslate nohighlight">\(C_A\)</span> and <span class="math notranslate nohighlight">\(t\)</span>, it just does so in the form of a differential equation. We start by writing a material balance on species <span class="math notranslate nohighlight">\(A\)</span> in this constant volume batch reactor:</p>
<div class="math notranslate nohighlight">
\[\frac{dN_A}{dt} = R_AV\]</div>
<p>For a constant volume reactor, we can divide through by <span class="math notranslate nohighlight">\(V\)</span> and move it inside of the derivative:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = R_A\]</div>
<p>For a single reaction, we know that <span class="math notranslate nohighlight">\(R_A = -r\)</span>, so:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -r\]</div>
<p>Finally, we have proposed power law kinetics, hence:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k{C_A}^\alpha\]</div>
<p>At this point, we make a decision about whether we want to use a <em><strong>differential</strong></em> method of analysis, where we attempt to approximate reaction rates by taking numerical derivatives of data, or an <em><strong>integral</strong></em> method of analysis, where we attempt to solve the material balance by integration and then regress parameters in the resultant model that best describe our data.</p>
<p>In <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html">Notebook 39</a>, we used a differential method of analysis. Some points about differential analysis should be clear after working through Notebook 39.</p>
<p><strong>Advantages of Differential Analysis</strong>*</p>
<ol class="arabic simple">
<li><p>Quick to apply using finite differences</p></li>
<li><p>Convenient when you do not know the reaction order as it will be determined by regression</p></li>
<li><p>Avoids having to guess reaction orders and solve the material balance as with integral methods</p></li>
</ol>
<p><strong>Challenges with Differential Analysis</strong></p>
<ol class="arabic simple">
<li><p>Numerical differentiation is imprecise, and especially so when considering large changes in concentration/time</p></li>
<li><p>Imprecision arises from the assumption that the derivative is constant over the range considered, a built in feature of finite differences</p></li>
<li><p>If we aren’t careful, a differential analysis can give us a false impression of true reaction kinetics, even for “perfect data” generated by a batch reactor simulation.</p></li>
</ol>
<p>Today, we’ll consider the integral method of analysis and highlight its strengths and weaknesses.  We’ll also take this opportunity to introduce nonlinear regression, which is a very useful skill.</p>
</section>
<section id="integral-analysis">
<h3>Integral Analysis<a class="headerlink" href="#integral-analysis" title="Link to this heading">#</a></h3>
<p>As the name suggests, integral analysis of batch reactor data is based on integration, which entails solving the differential equation that comprises the batch reactor material balance.  Above, we developed the following ODE that describes the change in the concentration of species a with respect to time – remember that at this point this is done symbolically for an arbitrary rate constant, <span class="math notranslate nohighlight">\(k\)</span>, and an arbitrary reaction order <span class="math notranslate nohighlight">\(\alpha\)</span>. As of now, we do not know either of their values, so we leave them symbolic in the material balance.</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k{C_A}^\alpha\]</div>
<p>Now, we proceed with solving the material balance. The easiest way to do this is to guess a numerical value for the reaction order, which permits a straightforward analysical solution. Once we have an analytical solution for an assumed reaction order, we can check to see if the data are well described by that solution. If so, then we would conclude that the proposed reaction order is probably adequate. If not, we would conclude that the proposed reaction order does not describe the data, and we would repeat the procedure with a different numerical value of reaction order. Although iterating through reaction orders is somewhat tedious, it gives us a lot of information, and it has an added bonus of providing us the opportunity to compare goodness of fit across multiple models. Often, it is difficult to determine in isolation if a single model fits data well – one can improve confidence by comparing optimal fits for many models, which is helpful in identifing the model that best describes the data.</p>
<p>Let’s start simple by assuming (1) that the reaction order is positive and (2) that the reaction has an integer order in <span class="math notranslate nohighlight">\(A\)</span>. With this in mind, a good starting point would be to say that the reaction order is either order is either 1, 2, or 3. Once we do that, we can solve the material balance on <span class="math notranslate nohighlight">\(A\)</span> for each reaction order to get three different analytical solutions for <span class="math notranslate nohighlight">\(C_A(t)\)</span>. We can then compare each to our data.</p>
<section id="first-order-solution">
<h4>First Order Solution<a class="headerlink" href="#first-order-solution" title="Link to this heading">#</a></h4>
<p>For a first order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -kC_A\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is far better in kinetic analysis if you can obtain an analytical solution than having to resort to a numerical one.</p>
</div>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{C_A}dC_A = \int_0^t-kdt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[C_A = C_{A0}\exp\left(-kt\right)\]</div>
</section>
<section id="second-order-solution">
<h4>Second Order Solution<a class="headerlink" href="#second-order-solution" title="Link to this heading">#</a></h4>
<p>For a second order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k{C_A}^2\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^2}dC_A = \int_0^t-kdt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + kt\]</div>
<p>And, keeping with the theme of solving for <span class="math notranslate nohighlight">\(C_A(t)\)</span>, we can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{C_{A0}} + kt\right)^{-1}\]</div>
</section>
<section id="third-order-solution">
<h4>Third Order Solution<a class="headerlink" href="#third-order-solution" title="Link to this heading">#</a></h4>
<p>For a third order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k{C_A}^3\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^3}dC_A = \int_0^t-kdt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{2{C_A}^2} = \frac{1}{2{C_{A0}}^2} + kt\]</div>
<p>And, keeping with the theme of solving for <span class="math notranslate nohighlight">\(C_A(t)\)</span>, we can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{{C_{A0}}^2} + 2kt\right)^{-\frac{1}{2}}\]</div>
</section>
<section id="how-well-do-these-models-describe-the-observed-trends">
<h4>How well do these models describe the observed trends?<a class="headerlink" href="#how-well-do-these-models-describe-the-observed-trends" title="Link to this heading">#</a></h4>
<p>Now, we are ready to decide which of these models (if any!) describes our data the best. To summarize, we have 3 models to vet against our data:</p>
<p><strong>First Order</strong>: <span class="math notranslate nohighlight">\(C_A = C_{A0}\exp\left(-kt\right)\)</span></p>
<p><strong>Second Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{C_{A0}} + kt\right)^{-1}\)</span></p>
<p><strong>Third Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{{C_{A0}}^2} + 2kt\right)^{-\frac{1}{2}}\)</span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The only thing we do not know in the above three models is the numerical value of the rate constant – convince yourself that <em>if</em> we did know the rate constant, then we could generate a graph of <span class="math notranslate nohighlight">\(C_A\)</span> vs. <span class="math notranslate nohighlight">\(t\)</span> and visually assess whether it fits the observed data.</p>
</div>
<p>We will start with a straightforward approach. We are going to very simply guess a numerical value for the rate constant in each model. Once we do that, we can generate a graph and overlay it with the data. If the model does not fit the data, it indicates that (1) our model is incorrect, (2) we have picked an incorrect value for the rate constant, or (3) both. After assessing an initial overlay, we’ll vary the value of the unknown parameter <span class="math notranslate nohighlight">\((k)\)</span> until we get the best possible fit to the data using a given model. As we do this, we will also quantify the total “error” in a given data fit. We’ll do this by calculating the residual sum of squares, which we introduced in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N38.html">Notebook 38</a>:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i (y_i - \hat{y}_i)^2\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\bar{y}_i\)</span> is the <span class="math notranslate nohighlight">\(i^\text{th}\)</span> measurement of the observable <span class="math notranslate nohighlight">\(y\)</span> at the corresponding value of independent variable, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(\hat{y}\)</span> is the model prediction of the observable value (<span class="math notranslate nohighlight">\(y\)</span>) at the same condition of independent variable, <span class="math notranslate nohighlight">\(x_i\)</span>. The quantity in parentheses represents the displacement (or “error”) between our model’s prediction and our measurement’s value.  We square it to ensure that the error is positive – otherwise, positive and negative errors will average out to zero, making it difficult to identify the true minimum error.</p>
<p>In this case, we’d base our SSE on measured and model predicted values of the concentration of A since that is our observable.</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i \left(\bar{C}_{A_i} - \hat{C}_{A_i}\right)^2\]</div>
<p>First, let’s define each model using lambda functions; this is done in the code cell below. We do not know the value of the rate constant yet, so we are constructing these functions to take two arguments – the rate constant and time.  Each time we want to use this function, we need to pass values of <span class="math notranslate nohighlight">\((k,t)\)</span>. If we do so, it will calculate the resultant concentration for that particular combination of <span class="math notranslate nohighlight">\((k,t)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a crude approach to optimization, but it is educational, and it builds an awareness of what is involved in parameter estimation.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># The initial concentrations are well-defined and can be set as global constants            #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CA0</span>   <span class="o">=</span> <span class="mi">10</span> <span class="c1">#mol/L</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for first order kinetics                                             #</span>
<span class="c1">#############################################################################################</span>
<span class="n">CAONE</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k1</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">CA0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for second order kinetics                                            #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CATWO</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k2</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for third order kinetics                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CATHREE</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k3</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can test the first order model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Define a test value for the first order rate constant                                     #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k1test</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1">#1/s</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass test rate constant to a 1st order model; broadcast to tdata; generates y predictions #</span>
<span class="c1">#############################################################################################  </span>

<span class="n">CMODONE</span> <span class="o">=</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k1test</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate SSE                                                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSEONE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CMODONE</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Print SSE and overlay CA(t) with CA vs. t data                                            #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;With k = </span><span class="si">{</span><span class="n">k1test</span><span class="si">}</span><span class="s1">, the residual sum of squares for the first order model is SSE = </span><span class="si">{</span><span class="n">SSEONE</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CMODONE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;First Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With k = 1, the residual sum of squares for the first order model is SSE = 443.11
</pre></div>
</div>
<img alt="../_images/c9788fc0d2fb765c5fb8a214b733cbf8cba9a47b6eb7ee555f697a2b9624cb1f.png" src="../_images/c9788fc0d2fb765c5fb8a214b733cbf8cba9a47b6eb7ee555f697a2b9624cb1f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Define a test value for the second order rate constant                                    #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k2test</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1">#L/mol/s</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass test rate constant to a 2nd order model; broadcast to tdata; generates y predictions #</span>
<span class="c1">#############################################################################################  </span>

<span class="n">CMODTWO</span> <span class="o">=</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k2test</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate SSE                                                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSETWO</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CMODTWO</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Print SSE and overlay CA(t) with CA vs. t data                                            #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;With k = </span><span class="si">{</span><span class="n">k2test</span><span class="si">}</span><span class="s1">, the residual sum of squares for the second order model is SSE = </span><span class="si">{</span><span class="n">SSETWO</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CMODTWO</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Second Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With k = 1, the residual sum of squares for the second order model is SSE = 494.90
</pre></div>
</div>
<img alt="../_images/bf436fa01708000a6100c6609db97703d5616a1a9cf4b9713044264a820fa31f.png" src="../_images/bf436fa01708000a6100c6609db97703d5616a1a9cf4b9713044264a820fa31f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Define a test value for the third order rate constant                                     #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k3test</span>   <span class="o">=</span> <span class="mi">1</span>  <span class="c1">#L^2/mol^2/s</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass test rate constant to a 3rd order model; broadcast to tdata; generates y predictions #</span>
<span class="c1">#############################################################################################  </span>

<span class="n">CMODTHREE</span> <span class="o">=</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k3test</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate SSE                                                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSETHREE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CMODTHREE</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Print SSE and overlay CA(t) with CA vs. t data                                            #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;With k = </span><span class="si">{</span><span class="n">k3test</span><span class="si">}</span><span class="s1">, the residual sum of squares for the third order model is SSE = </span><span class="si">{</span><span class="n">SSETHREE</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CMODTHREE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Second Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With k = 1, the residual sum of squares for the third order model is SSE = 487.35
</pre></div>
</div>
<img alt="../_images/6b69acd650ecc7b3b572d0c9819e62b926bb7510ad59aa3e42ade773e2283885.png" src="../_images/6b69acd650ecc7b3b572d0c9819e62b926bb7510ad59aa3e42ade773e2283885.png" />
</div>
</div>
</section>
<section id="nonlinear-least-squares-formally">
<h4>Nonlinear Least Squares, formally<a class="headerlink" href="#nonlinear-least-squares-formally" title="Link to this heading">#</a></h4>
<p>Above, we performed a crude but intuitive optimization. We iteratively changed the value of the rate constant (a parameter) in each model until we found the value that <em><strong>minimized residual sum of squares</strong></em> and therefore best described the data. This approach is nice because it gives both visual and quantitative feedback after each iteration; unfortunately, this approach is inefficient for solving complex parameter estimation problems. In practice, we will use a more mathematically rigorous approach for parameter estimation. The basic idea is the same as we discussed in linear regression analysis (<a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N37.html">Notebook 37</a>). We will find the value of the parameter (here, the rate constant) that produces the “line of best fit.” In a least squares approach, the line of best fit is defined as the one given by the value of the parameter that <em><strong>minimizes</strong></em> the residual sum of squares. We discussed linear least squares in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N37.html">Notebook 37</a>. In that approach, we leveraged the fact that our models were linear in parameters (coefficients), which allowed us to transform large systems of linear equations into a matrix representation that we could then use to minimize the residual sum of squares. In the current analysis, we have three models that are nonlinear in parameters/time:</p>
<p><strong>First Order</strong>: <span class="math notranslate nohighlight">\(C_A = C_{A0}\exp\left(-kt\right)\)</span></p>
<p><strong>Second Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{C_{A0}} + kt\right)^{-1}\)</span></p>
<p><strong>Third Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{{C_{A0}}^2} + 2kt\right)^{-\frac{1}{2}}\)</span></p>
<p>To perform least squares analysis, we can either (1) transform these nonlinear models into linear models that we can process using linear algebra or (2) retain models in a nonlinear form, write a nonlinear objetive function that accepts <span class="math notranslate nohighlight">\(k\)</span> as an argument and calculates residual sum of squares for a given value of <span class="math notranslate nohighlight">\(k\)</span>, and use numerical tools to minimize the objective function.</p>
<p>We will use the 2nd approach first – this approach is generally called <em><strong>nonlinear least squares</strong></em> or <em><strong>nonlinear regression</strong></em>.</p>
<p>First, we need to define an objective function – this is the function that we would like to minimize. Clearly, we should try to minimize the residual sum of squares! We will minimize the residual sum of squares just as we did above – by iteratively changing the value of the parameter (rate constant) until we find a minimum residual error.  This insight motivates us to write an objective function that:</p>
<ol class="arabic simple">
<li><p>Takes the parameter value as an argument.</p></li>
<li><p>Calculates residual sum of squares as a function of that parameter value.</p></li>
</ol>
<p>In the cell below, we construct an objective function that accomplishes these things for the case of first order kinetics, <span class="math notranslate nohighlight">\(r = kC_A\)</span>, in a constant volume batch reactor.  As you review the code in this cell, make sure you can clearly see that the function takes the rate constant as an argument, and it calculates (and returns!) the residual sum of squares as an output.  The function additionally generates a plot that will display when you run the function – this is helpful for illustrating how good the fit is for a given value of rate constant, but we will typically not include visualization during numerical optimization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Define objective function for first order kinetics                                        #</span>
<span class="c1"># Function has the form f(k) and it returns SSE                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="k">def</span><span class="w"> </span><span class="nf">OBJONE</span><span class="p">(</span><span class="n">k1</span><span class="p">):</span>
    <span class="n">CAmodel</span> <span class="o">=</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
    <span class="n">RESID</span>   <span class="o">=</span> <span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAmodel</span>
    <span class="n">SSE</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;k1 = </span><span class="si">{</span><span class="n">k1</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
    <span class="c1">#########################################################################################</span>
    <span class="c1"># code block below prints SSE and graphs CA vs t when the function is run               #</span>
    <span class="c1">#########################################################################################</span>

    <span class="c1"># plt.figure(figsize = (5, 5))</span>
    <span class="c1"># plt.scatter(tdata, CAdata, edgecolor = &#39;black&#39;, color = &#39;none&#39;, label = &#39;CA&#39;)</span>
    <span class="c1"># plt.plot(tdata, CAmodel, color = &#39;black&#39;, linestyle = &#39;dashed&#39;, label = &#39;First order model with k = &#39; + str(k))</span>
    <span class="c1"># plt.xlabel(&#39;time (min)&#39;, fontsize = 12)</span>
    <span class="c1"># plt.ylabel(&#39;CA (M)&#39;, fontsize = 12)</span>
    <span class="c1"># plt.xlim(0, 1000)</span>
    <span class="c1"># plt.ylim(0, 12)</span>
    <span class="c1"># plt.legend()</span>
    <span class="c1"># plt.show()</span>
    <span class="k">return</span> <span class="n">SSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Run the objective function for a test value of the first order rate constant k1           #</span>
<span class="c1">#############################################################################################</span>
<span class="n">k1test</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># OBJONE(k1test)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For first order kinetics with k1 = </span><span class="si">{</span><span class="n">k1test</span><span class="si">}</span><span class="s1">, the residual sum of squares is SSE = </span><span class="si">{</span><span class="n">OBJONE</span><span class="p">(</span><span class="n">k1test</span><span class="p">)</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k1 =  1.00E+00, SSE = 4.43E+02
For first order kinetics with k1 = 1, the residual sum of squares is SSE = 443.11
</pre></div>
</div>
</div>
</div>
</section>
<section id="minimizing-the-error-with-numerical-tools">
<h4>Minimizing the error with numerical tools<a class="headerlink" href="#minimizing-the-error-with-numerical-tools" title="Link to this heading">#</a></h4>
<p>Now that we have an objective function that takes our unknown parameter as an argument and returns the residual sum of squares, we can use an optimization algorithm to find the value of <span class="math notranslate nohighlight">\(k\)</span> that minimizes the residual sum of squares. We are already familiar withe the appropriate tools in Python – for univariate problems (we have only one unknown parameter), we would use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize_scalar()</span></code> and for multivariate problems (we have more than one unknown parameter), we would use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize()</span></code>.</p>
<p>Here, we are trying to minimize the objective function value with respect to a single parameter, <span class="math notranslate nohighlight">\(k\)</span>, so this is a univariate problem, and we use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize_scalar()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k1 that minimizes the objective function using opt.minimize_scalar()    #</span>
<span class="c1"># Show result of each iteration with print/graph in objective function                      #</span>
<span class="c1"># Comment sections of OBJONE(k) after demonstrating iterations                              #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_one</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJONE</span><span class="p">)</span><span class="c1">#, method = &#39;Brent&#39;, bracket = [0.01, 10])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k1 =  0.00E+00, SSE = 4.82E+02
k1 =  1.00E+00, SSE = 4.43E+02
k1 =  2.62E+00, SSE = 5.18E+02
k1 =  1.62E+00, SSE = 4.90E+02
k1 =  6.18E-01, SSE = 3.80E+02
k1 =  3.82E-01, SSE = 3.08E+02
k1 =  2.36E-01, SSE = 2.36E+02
k1 =  1.46E-01, SSE = 1.69E+02
k1 =  9.02E-02, SSE = 1.12E+02
k1 =  5.57E-02, SSE = 6.70E+01
k1 =  3.44E-02, SSE = 3.68E+01
k1 =  2.13E-02, SSE = 2.17E+01
k1 =  1.32E-02, SSE = 2.19E+01
k1 =  1.74E-02, SSE = 2.00E+01
k1 =  1.73E-02, SSE = 2.00E+01
k1 =  1.67E-02, SSE = 1.99E+01
k1 =  1.53E-02, SSE = 2.02E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k1 that minimizes the objective function using opt.minimize_scalar()    #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_one</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJONE</span><span class="p">)</span><span class="c1">#, method = &#39;Brent&#39;, bracket = [0.01, 10])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE</span>     <span class="o">=</span> <span class="n">ans_one</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_one</span>   <span class="o">=</span> <span class="n">ans_one</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k1 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_one</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 1st order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDONE</span> <span class="o">=</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k_one</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k_one</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, First Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1"># Converting the error to a percentage is not necessary                                     #</span>
<span class="c1"># I chose to convert to a percentage so that residuals for all models are on same y-scale   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDONE</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k1 =  0.00E+00, SSE = 4.82E+02
k1 =  1.00E+00, SSE = 4.43E+02
k1 =  2.62E+00, SSE = 5.18E+02
k1 =  1.62E+00, SSE = 4.90E+02
k1 =  6.18E-01, SSE = 3.80E+02
k1 =  3.82E-01, SSE = 3.08E+02
k1 =  2.36E-01, SSE = 2.36E+02
k1 =  1.46E-01, SSE = 1.69E+02
k1 =  9.02E-02, SSE = 1.12E+02
k1 =  5.57E-02, SSE = 6.70E+01
k1 =  3.44E-02, SSE = 3.68E+01
k1 =  2.13E-02, SSE = 2.17E+01
k1 =  1.32E-02, SSE = 2.19E+01
k1 =  1.74E-02, SSE = 2.00E+01
k1 =  1.73E-02, SSE = 2.00E+01
k1 =  1.67E-02, SSE = 1.99E+01
k1 =  1.53E-02, SSE = 2.02E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01
k1 =  1.68E-02, SSE = 1.99E+01

k =  1.68E-02, SSE = 1.99E+01
</pre></div>
</div>
<img alt="../_images/0d0d8bfe76ed2abd18f6c2d5934aae3396976d95e80dd4cfef474964ddf32d13.png" src="../_images/0d0d8bfe76ed2abd18f6c2d5934aae3396976d95e80dd4cfef474964ddf32d13.png" />
<img alt="../_images/95f2298f149f5bc9e26a032847e2ec9d999d4c3829255e0d3116ce651895d6fd.png" src="../_images/95f2298f149f5bc9e26a032847e2ec9d999d4c3829255e0d3116ce651895d6fd.png" />
</div>
</div>
</section>
<section id="analysis-of-first-order-fit">
<h4>Analysis of First Order Fit<a class="headerlink" href="#analysis-of-first-order-fit" title="Link to this heading">#</a></h4>
<p>Based on that result, the best fit value of the rate constant in a first order model is <span class="math notranslate nohighlight">\(k_1 = 0.017 \ \mathrm{s^{-1}}\)</span>, which achieves a minimum SSE of ~19.9.  Visually, it does an OK job of fitting data at low times, but it falls apart after about 100 minutes.  We notice that the first order model over-predicts measured concentration at short times, and it underpredicts at long times.  This would be a sign that the order of reaction is too low. Now we’ll do the analogous optimization using a second order model and a second order rate constant. We start by defining an objective function that takes <span class="math notranslate nohighlight">\(k\)</span> as an argument and then uses the model for <span class="math notranslate nohighlight">\(C_A(t)\)</span> based on second order kinetics to calculate the residual sum of squares.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##############################################################################################</span>
<span class="c1"># Define an objective function that takes k2 as input and uses 2nd order model to calc SSE   #</span>
<span class="c1">##############################################################################################</span>

<span class="k">def</span><span class="w"> </span><span class="nf">OBJTWO</span><span class="p">(</span><span class="n">k2</span><span class="p">):</span>
    <span class="n">CAmodel</span> <span class="o">=</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
    <span class="n">RESID</span>   <span class="o">=</span> <span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAmodel</span>
    <span class="n">SSE</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;k2 = </span><span class="si">{</span><span class="n">k2</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k2 that minimizes the OBJTWO using opt.minimize_scalar()                #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_two</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTWO</span><span class="p">)</span><span class="c1">#, method = &#39;Brent&#39;, bracket = [0.01, 10])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE</span>     <span class="o">=</span> <span class="n">ans_two</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_two</span>   <span class="o">=</span> <span class="n">ans_two</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k2 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_two</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 2nd order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDTWO</span> <span class="o">=</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k_two</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k_two</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, Second Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTWO</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k2 =  0.00E+00, SSE = 4.82E+02
k2 =  1.00E+00, SSE = 4.95E+02
k2 = -1.62E+00, SSE = 5.60E+02
k2 = -6.18E-01, SSE = 6.13E+02
k2 =  3.82E-01, SSE = 4.46E+02
k2 =  6.00E-01, SSE = 4.73E+02
k2 =  3.21E-01, SSE = 4.33E+02
k2 =  1.98E-01, SSE = 3.90E+02
k2 =  1.22E-01, SSE = 3.37E+02
k2 =  7.57E-02, SSE = 2.78E+02
k2 =  4.68E-02, SSE = 2.17E+02
k2 =  2.89E-02, SSE = 1.57E+02
k2 =  1.79E-02, SSE = 1.04E+02
k2 =  1.10E-02, SSE = 6.05E+01
k2 =  6.82E-03, SSE = 2.86E+01
k2 =  4.22E-03, SSE = 9.76E+00
k2 =  2.61E-03, SSE = 4.49E+00
k2 =  1.67E-03, SSE = 1.17E+01
k2 =  3.03E-03, SSE = 4.67E+00
k2 =  2.73E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00
k2 =  2.75E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00
k2 =  2.76E-03, SSE = 4.40E+00

k =  2.76E-03, SSE = 4.40E+00
</pre></div>
</div>
<img alt="../_images/d911cf43d08cdbf59b55e6e536a2440d2e5a197076093a369e691cd92c696912.png" src="../_images/d911cf43d08cdbf59b55e6e536a2440d2e5a197076093a369e691cd92c696912.png" />
<img alt="../_images/fcf31b2cadaf58379584854f7860efebc863dcdf461a8233eac86a64527dc1a5.png" src="../_images/fcf31b2cadaf58379584854f7860efebc863dcdf461a8233eac86a64527dc1a5.png" />
</div>
</div>
</section>
<section id="analysis-of-2nd-order-fit">
<h4>Analysis of 2nd order fit<a class="headerlink" href="#analysis-of-2nd-order-fit" title="Link to this heading">#</a></h4>
<p>This does a better job than the first order model; we find that an optimum rate constant of <span class="math notranslate nohighlight">\(k_2 = 0.0028 \ \mathrm{L \ mol^{-1} \ min^{-1}}\)</span> gives us a minimum sum of squares of 4.40, which is quite a bit better than the minimum sum of squares achieved with a first order model (19.9).  Still, the shape of the curve is not quite correct, and we find that the model overpredicts concentrations at short times and under predicts them at longer times.  This prompts us to test the 3rd order model. To do so, we use an analogous approach. First, we construct an objective function that takes a third order rate constant as an input argument and calculates the corresponding residual sum of squares. Once this is done, we can use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.minimize_scalar()</span></code> to find the value of <span class="math notranslate nohighlight">\(k_3\)</span> that minimizes the objective function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##############################################################################################</span>
<span class="c1"># Define an objective function that takes k3 as input and uses 3rd order model to calc SSE   #</span>
<span class="c1">##############################################################################################</span>

<span class="k">def</span><span class="w"> </span><span class="nf">OBJTHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">):</span>
    <span class="n">CAmodel</span> <span class="o">=</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
    <span class="n">RESID</span>   <span class="o">=</span> <span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAmodel</span>
    <span class="n">SSE</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;k3 = </span><span class="si">{</span><span class="n">k3</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k3 that minimizes the OBJTHREE using opt.minimize_scalar()              #</span>
<span class="c1"># We have switched to a bounded optimization method                                         #</span>
<span class="c1"># This is implemented to prevent the optimizer from testing negative values of k3           #</span>
<span class="c1"># Physically, these aren&#39;t realistic, so we want to generally avoid negative values         #</span>
<span class="c1"># This is usually accomplished naturally because negative rate constants give large SSE     #</span>
<span class="c1"># In the case of the third order solution, the k3 value is passed to a square root          #</span>
<span class="c1"># This generates an imaginary number and throws an error                                    #</span>
<span class="c1"># Hence the need for bounds that keep the rate constant guesses positive                    #</span>
<span class="c1">#############################################################################################</span>

<span class="c1"># ans_three = opt.minimize_scalar(OBJTHREE)# Test this; it will throw a warning and not find an optiumum</span>
<span class="n">ans_three</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTHREE</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Bounded&#39;</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE</span>       <span class="o">=</span> <span class="n">ans_three</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_three</span>   <span class="o">=</span> <span class="n">ans_three</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k3 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_three</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 2nd order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDTHREE</span> <span class="o">=</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k_three</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k_three</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, Third Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTHREE</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k3 =  3.82E-01, SSE = 4.61E+02
k3 =  6.18E-01, SSE = 4.75E+02
k3 =  2.36E-01, SSE = 4.42E+02
k3 =  1.46E-01, SSE = 4.19E+02
k3 =  9.02E-02, SSE = 3.92E+02
k3 =  5.57E-02, SSE = 3.59E+02
k3 =  3.45E-02, SSE = 3.21E+02
k3 =  2.13E-02, SSE = 2.77E+02
k3 =  1.32E-02, SSE = 2.30E+02
k3 =  8.14E-03, SSE = 1.81E+02
k3 =  5.03E-03, SSE = 1.33E+02
k3 =  3.12E-03, SSE = 8.89E+01
k3 =  1.93E-03, SSE = 5.19E+01
k3 =  1.20E-03, SSE = 2.39E+01
k3 =  7.43E-04, SSE = 6.34E+00
k3 =  4.63E-04, SSE = 2.00E-02
k3 =  2.90E-04, SSE = 4.89E+00
k3 =  5.02E-04, SSE = 3.02E-01
k3 =  4.60E-04, SSE = 1.10E-02
k3 =  4.49E-04, SSE = 4.06E-04
k3 =  3.88E-04, SSE = 5.58E-01
k3 =  4.52E-04, SSE = 5.86E-04
k3 =  4.46E-04, SSE = 3.03E-03

k =  4.49E-04, SSE = 4.06E-04
</pre></div>
</div>
<img alt="../_images/d2e83c19a7315f770270edbc5cea7ae9feb002cc9170189513850ccac10edd67.png" src="../_images/d2e83c19a7315f770270edbc5cea7ae9feb002cc9170189513850ccac10edd67.png" />
<img alt="../_images/34268d831e4eed5c35e3a42914259c2cddc9e6a5d8db4f6aaa55396175c43fec.png" src="../_images/34268d831e4eed5c35e3a42914259c2cddc9e6a5d8db4f6aaa55396175c43fec.png" />
</div>
</div>
<p>Now we have a great fit to the data.  This is indicated visually in the line of best fit and the residual plots, where we observe scatter around the liner of zero error. We also see this quantitatively in the minimum SSE of 4.06E-04, which is orders of magnitude smaller than the minimum SSE for first and second order models. Based on this, we would conclude that this reaction is third order in the concentration of A, and we would report that <span class="math notranslate nohighlight">\(k \approx 4.5 \times 10^{-04} \ \mathrm{L^2 \ mol^{-2} \ s^{-1}}\)</span>.</p>
<p>Thus far, we’ve used “nonlinear” regression because the models that we fit for first, second, and third order kinetics were non-linear functions of parameter values and time.  This is a powerful technique but it can also lead to problems. Most notably, when have data that is nonlinear, it is supposed to be curved in some way.  It can be hard to tell if the amount of curvature is correct.  In this case, it is easy to see, but recall that this is actually a <em><strong>perfect data set</strong></em> that was generated by solving the batch reactor material balance using third order kinetics. When we have messy, “real” data, it can be difficult to tell if the type of curvature observed in your model is correct, and it can be hard to resolve whether one nonlinear model is better than the other. Additionally, when we perform nonlinear regression, we are relying on iterative, numerical methods to perform the optimization. These can be unstable for certain objective function/parameter value combinations.</p>
<p>Where it is possible to do so, it is always useful to linearize a model.  This gains us a couple of important things.</p>
<ol class="arabic simple">
<li><p>Whereas deviation between experimental data and a curved line can be difficult to assess, it is relatively easy to detect deviations from linearity.  This makes linearization a powerful visual tool for assessing goodness of fit.</p></li>
<li><p>If we can linearize a model, we can use linear regression tools.  Regardless of how they are packaged (e.g., trendline in Excel or polyfit in Python), they are all based on similar methods that use linear algebra.</p></li>
<li><p>The ability to leverage linear algebra means that linear least sqaures solutions solutions are deterministic. We do not need to perform iterations to identify the optimum parameter set for linear least squares problems.</p></li>
<li><p>With nonlinear regression (as above), we are forced to use iterative optimization routines like <code class="docutils literal notranslate"><span class="pre">opt.minimize()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.minimize_scalar()</span></code>. These are not guaranteed to converge, and linear algebra solutions are typically more stable.</p></li>
</ol>
<p>For these reasons, in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N41.html">Notebook 41</a> we will consider how to linearize these models, perform linear regression, and visually inspect the results compared to a linearized data set.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="587-N39.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Kinetics I</p>
      </div>
    </a>
    <a class="right-next"
       href="587-N41.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Kinetics III</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integral-analysis">Integral Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-solution">First Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-solution">Second Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-order-solution">Third Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-well-do-these-models-describe-the-observed-trends">How well do these models describe the observed trends?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-least-squares-formally">Nonlinear Least Squares, formally</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minimizing-the-error-with-numerical-tools">Minimizing the error with numerical tools</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-first-order-fit">Analysis of First Order Fit</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-2nd-order-fit">Analysis of 2nd order fit</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>