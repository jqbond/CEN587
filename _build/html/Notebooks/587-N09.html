
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Passing Extra Parameters in Python &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebooks/587-N09';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Chemical Equilibrium IV" href="587-N08.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="../_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Chapter1.html">Python Supplements</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../Chapter2.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="587-N01.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N02.html">Jupyter and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N03.html">Solving Algebraic Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N04.html">Extent and Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N05.html">Chemical Equilibrium I</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N06.html">Chemical Equilibrium II</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N07.html">Chemical Equilibrium III</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N08.html">Chemical Equilibrium IV</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Passing Extra Parameters in Python</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/CEN587/main?urlpath=tree/Notebooks/587-N09.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/CEN587" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/CEN587/issues/new?title=Issue%20on%20page%20%2FNotebooks/587-N09.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Notebooks/587-N09.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Passing Extra Parameters in Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ammonia-synthesis-under-industrial-conditions">Ammonia Synthesis Under Industrial Conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#thermodynamic-data-and-k">Thermodynamic data and K</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-is-also-a-function-of-thermodynamic-activities">K is also a function of thermodynamic activities!</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expressing-mole-fractions-as-functions-of-extent">Expressing Mole Fractions as functions of Extent</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-t-and-p-as-extra-arguments-to-opt-newton-or-opt-root">Passing T and P as extra arguments to <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-parameters-with-lambda-functions">Passing extra parameters with lambda functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-parameters-with-the-args-keyword-in-python">Passing extra parameters with the args keyword in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-go-through-the-trouble">Why go through the trouble?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="passing-extra-parameters-in-python">
<h1>Passing Extra Parameters in Python<a class="headerlink" href="#passing-extra-parameters-in-python" title="Link to this heading">#</a></h1>
<p>This notebook is intended to develop ancillary skills in Python, specifically passing extra parameters to equation solvers. The Notebooks to this point have covered basic root finding with univariate solvers in Python. We can handle considerably more complex problems in a much more efficient way if we can learn to pass parameters instead of hard coding parameters within the scope of a single problem solution. To cover this topic, we will revist ammonia synthesis at varying temperatures and pressures, which was covered in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N08.html">Notebook 08</a>. We have already solved this problem, and now that we know the answer and have some expectations about the system, we will now use it as a platform to learn about passing extra parameters to equation solvers like <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code>. This notebook has some light review of equilibrium concepts, but it is primarily a Python exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">opt</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="ammonia-synthesis-under-industrial-conditions">
<h2>Ammonia Synthesis Under Industrial Conditions<a class="headerlink" href="#ammonia-synthesis-under-industrial-conditions" title="Link to this heading">#</a></h2>
<p>In <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N08.html">Notebook 08</a>, we discussed the importance of temperature in determining the equilibrium position for ammonia synthesis:</p>
<div class="math notranslate nohighlight">
\[N_2 (g) + 3H_2 (g) \leftrightharpoons 2N\!H_3 (g)\]</div>
<p>This reaction is <em><strong>exothermic</strong></em> and leads to a substantial <em><strong>loss of entropy</strong></em>. This means that it is (very) enthalpically favorable and (very) entropically unfavorable, and it will be very sensitive to changes in temperature.  We found that it is extremely favorable at room temperature (<span class="math notranslate nohighlight">\(X_{N_2} \approx 0.97\)</span> at <span class="math notranslate nohighlight">\(T = 298\)</span>K); unfortunately, the kinetics of this reaction are too slow at 298K for it to be industrially feasible. To achieve a workable reaction rate, we might have to run at something like <span class="math notranslate nohighlight">\(T = 873\)</span>K; unfortunately, we found that ammonia synthesis is very thermodynamically unfavorable at this temperature (<span class="math notranslate nohighlight">\(X_{N_2} \approx 8.0 \times 10^{-4}\)</span> at <span class="math notranslate nohighlight">\(T = 873\)</span>K). This prompted us to increase pressure, but we found that we would need to operate at nearly 1000 bar to allow workable nitrogen conversions at equilibrium (<span class="math notranslate nohighlight">\(X_{N_2} \approx 0.38\)</span> at <span class="math notranslate nohighlight">\(T = 873\)</span>K and <span class="math notranslate nohighlight">\(P = 1000\)</span>bar).  Materials and operating cost prevent us from running ammonia synthesis at 1000 bar at full scale, so it is essential to decrease temperature in order to get a more favorable equilibrium position; however, this must be done without reducing the reaction rate. This is where the introduction of a catalyst is critical – the Haber-Bosch process relies on a catalyst to achieve high reaction rates at moderate temperatures where the equilibrium position is still unfavorable, but not so unfavorable that we cannot work around it by increasing pressure to 100 - 200 bar (<span class="math notranslate nohighlight">\(X_{N_2} \approx 0.51\)</span> at <span class="math notranslate nohighlight">\(T = 673\)</span>K and <span class="math notranslate nohighlight">\(P = 200\)</span> bar).  These pressures are high and expensive, but they are industrially feasible.</p>
<p>Below, we recap the solution already presented in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N08.html">Notebook 08</a>.</p>
</section>
<section id="example-problem-01">
<h2>Example Problem 01<a class="headerlink" href="#example-problem-01" title="Link to this heading">#</a></h2>
<p>What is the equilibrium conversion of <span class="math notranslate nohighlight">\(N_2\)</span> during ammonia synthesis at 873K, 1 bar, and starting with a 3:1 ratio of <span class="math notranslate nohighlight">\(H_2\)</span>:<span class="math notranslate nohighlight">\(N_2\)</span>?</p>
<section id="solution-to-example-problem-01">
<h3>Solution to Example Problem 01<a class="headerlink" href="#solution-to-example-problem-01" title="Link to this heading">#</a></h3>
<p>We start by recalling the equation below, which relates the standard state change in Gibbs free energy (i.e., <em><strong>reaction thermodynamics</strong></em>) to the equilibrium composition of the reacting system.</p>
<div class="math notranslate nohighlight">
\[\exp\left(\frac{-\Delta G^\circ}{RT}\right) = K = \prod_{j = 1}^{N_S}a_j^{\nu_j}\]</div>
<section id="thermodynamic-data-and-k">
<h4>Thermodynamic data and K<a class="headerlink" href="#thermodynamic-data-and-k" title="Link to this heading">#</a></h4>
<p>We will start with the left side of the equation. Assuming that we can solve it, it allows us to calculate a numerical value of the equilibrium constant from thermodynamic data.</p>
<div class="math notranslate nohighlight">
\[K = \exp\left(\frac{-\Delta G^\circ}{RT}\right)\]</div>
<p>To find <span class="math notranslate nohighlight">\(K\)</span>, we have to calculate the standard state Gibbs Free Energy of reaction, <span class="math notranslate nohighlight">\(\Delta G^\circ\)</span>.  For gas phase reactions like this one, the standard state is pure species at 1 bar and the reaction temperature.  For this example problem, we’ve <em><strong>increased</strong></em> the reaction temperature to 873K, so we need to calculate the Gibbs free energy change at 1 bar and 873K. Previously, we only had data at 298K, but we can correct for temperature effects using heat capacities.  They are included for each species in the table below.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Species</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\({H_j}^\circ (\mathrm{kJ \ mol^{-1}})\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\({S_j}^\circ (\mathrm{J \ mol^{-1} \ K^{-1}})\)</span></p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\({C_{p_j}}^\circ (\mathrm{J \ mol^{-1} \ K^{-1}})\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(N_2\)</span> (g)</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>191.60</p></td>
<td class="text-center"><p>29.12</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(H_2\)</span> (g)</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>130.68</p></td>
<td class="text-center"><p>28.84</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(N\!H_3\)</span> (g)</p></td>
<td class="text-center"><p>-45.9</p></td>
<td class="text-center"><p>192.77</p></td>
<td class="text-center"><p>35.64</p></td>
</tr>
</tbody>
</table>
</div>
<p>Now, we can us the data at <span class="math notranslate nohighlight">\(T_0 = 298K\)</span> and the various heat capacities to calculate the enthalpy of each species at 873K using the following equation:</p>
<div class="math notranslate nohighlight">
\[H_j = H_{j,0} + \int_{T_0}^{T} C_{p_j} dT\]</div>
<p>For heat capacities that are not a function of temperature (here, we have constant heat capacities), we can solve the integral and the equation simplifies to:</p>
<div class="math notranslate nohighlight">
\[H_j = H_{j,0} + C_{p_j}(T - T_0)\]</div>
<p>Similarly, we can calculate entropies at a temperature other than <span class="math notranslate nohighlight">\(T_0 = 298K\)</span> using the following equation:</p>
<div class="math notranslate nohighlight">
\[S_j = S_{j,0} + \int_{T_0}^{T} \frac{C_{p_j}}{T} dT\]</div>
<p>For constant heat capacities like we have in this problem, we can again solve the integral giving:</p>
<div class="math notranslate nohighlight">
\[S_j = S_{j,0} + C_{p_j}\ln\left(\frac{T}{T_0}\right)\]</div>
<p>In the cell below, we build a function to calculate enthalpies and entropies at 873K based on our data at 298K and the heat capacities we have available. Just to keep the notation simple, I’ll use <span class="math notranslate nohighlight">\(N\)</span> = <span class="math notranslate nohighlight">\(N_2\)</span>, <span class="math notranslate nohighlight">\(H = H_2\)</span>, and <span class="math notranslate nohighlight">\(A\)</span> = <span class="math notranslate nohighlight">\(N\!H_3\)</span>. Within this function, we also calculate the Gibbs Free Energy of Reaction and the Equilibrium Constant at 873K. The function is pretty simple, and it returns only the equilibrium constant at a specified temperature argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################</span>
<span class="c1"># Creating a versatile function that calculates K at any T, i.e., K(T)      #</span>
<span class="c1">#############################################################################</span>

<span class="k">def</span><span class="w"> </span><span class="nf">K</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="mi">298</span>   <span class="c1">#K</span>
    <span class="n">R</span>  <span class="o">=</span> <span class="mf">8.314</span> <span class="c1">#J/mol/K</span>
    
    <span class="c1">#Enthalpies at 298K, 1 bar</span>
    <span class="n">HN0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">HH0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">HA0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">45.9</span><span class="o">*</span><span class="mi">1000</span> <span class="c1">#J/mol</span>

    <span class="c1">#Entropies at 298K, 1 bar</span>
    <span class="n">SN0</span> <span class="o">=</span> <span class="mf">191.60</span> <span class="c1">#J/mol/K</span>
    <span class="n">SH0</span> <span class="o">=</span> <span class="mf">130.68</span> <span class="c1">#J/mol/K</span>
    <span class="n">SA0</span> <span class="o">=</span> <span class="mf">192.77</span> <span class="c1">#J/mol/K</span>

    <span class="c1">#Heat capacities</span>
    <span class="n">CPN</span> <span class="o">=</span> <span class="mf">29.12</span> <span class="c1">#J/mol/K</span>
    <span class="n">CPH</span> <span class="o">=</span> <span class="mf">28.84</span> <span class="c1">#J/mol/K</span>
    <span class="n">CPA</span> <span class="o">=</span> <span class="mf">35.64</span> <span class="c1">#J/mol/K</span>

    <span class="c1">#Calculate thermodynamic state functions at T not equal to T0 = 298</span>
    <span class="n">HN</span> <span class="o">=</span> <span class="n">HN0</span> <span class="o">+</span> <span class="n">CPN</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol</span>
    <span class="n">HH</span> <span class="o">=</span> <span class="n">HH0</span> <span class="o">+</span> <span class="n">CPH</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol</span>
    <span class="n">HA</span> <span class="o">=</span> <span class="n">HA0</span> <span class="o">+</span> <span class="n">CPA</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol</span>

    <span class="n">SN</span> <span class="o">=</span> <span class="n">SN0</span> <span class="o">+</span> <span class="n">CPN</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol/K</span>
    <span class="n">SH</span> <span class="o">=</span> <span class="n">SH0</span> <span class="o">+</span> <span class="n">CPH</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol/K</span>
    <span class="n">SA</span> <span class="o">=</span> <span class="n">SA0</span> <span class="o">+</span> <span class="n">CPA</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">T0</span><span class="p">)</span> <span class="c1">#J/mol/K</span>

    <span class="n">ΔH</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">HA</span> <span class="o">-</span> <span class="n">HN</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">HH</span> <span class="c1">#J/mol</span>
    <span class="n">ΔS</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">SA</span> <span class="o">-</span> <span class="n">SN</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">SH</span> <span class="c1">#J/mol/K</span>
    <span class="n">ΔG</span> <span class="o">=</span> <span class="n">ΔH</span> <span class="o">-</span> <span class="n">T</span><span class="o">*</span><span class="n">ΔS</span>        <span class="c1">#J/mol</span>

    <span class="n">K</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ΔG</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>     <span class="c1">#Dimensionless</span>
    <span class="k">return</span> <span class="n">K</span>

<span class="n">T1</span> <span class="o">=</span> <span class="mi">298</span> <span class="c1">#K</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At T = </span><span class="si">{</span><span class="n">T1</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1">K, the thermodynamic equilibrium constant for ammonia synthesis is K = </span><span class="si">{</span><span class="n">K</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At T = 298K, the thermodynamic equilibrium constant for ammonia synthesis is K = 5.54E+05
</pre></div>
</div>
</div>
</div>
</section>
<section id="k-is-also-a-function-of-thermodynamic-activities">
<h4>K is also a function of thermodynamic activities!<a class="headerlink" href="#k-is-also-a-function-of-thermodynamic-activities" title="Link to this heading">#</a></h4>
<p>Now that we have the equilibrium constant at 873K, 1 bar, and for pure gas reference states, we can address the composition dependence by considering:</p>
<div class="math notranslate nohighlight">
\[K = \prod_{j = 1}^{N_S}a_j^{\nu_j}\]</div>
<p>Next, we need to work through the right hand side of that expression and resolve the composition dependencies within the thermodynamic activities. We can apply this equation to the specific example of ammonia synthesis to find:</p>
<div class="math notranslate nohighlight">
\[K = \frac{{a_{N\!H_3}}^{2}}{{a_{N_2}}{a_{H_2}}^3}\]</div>
<p>We recall our definitions for thermodynamic activities of gases in a mixture:</p>
<div class="math notranslate nohighlight">
\[a_j = \frac{\hat{f}_j}{f_j^\circ}\]</div>
<p>The numerator is the fugacity of species <span class="math notranslate nohighlight">\(j\)</span> under reaction conditions (<span class="math notranslate nohighlight">\(T = 873K\)</span>, <span class="math notranslate nohighlight">\(P = 1 \mathrm{bar}\)</span>, <span class="math notranslate nohighlight">\(x_j = ?\)</span>). The denominator is the fugacity of species <span class="math notranslate nohighlight">\(j\)</span> in its reference state. Our reference state for gas-phase species is a pure species at 1 bar and the reaction temperature (<span class="math notranslate nohighlight">\(T = 873K\)</span>). Our convention for calculating fugacities of gases in a mixture uses the Lewis Randall rule. With these things in mind, formally, we have:</p>
<div class="math notranslate nohighlight">
\[a_j = \frac{y_j \phi_j P}{y_j^\circ \phi_j^\circ  P^\circ}\]</div>
<p>Looking at the numerator, we are operating this reactor at 1 bar, so the fugacity coefficient for species j under reaction conditions, <span class="math notranslate nohighlight">\(\phi_j\)</span>, is 1. Looking at the denominator, the reference state is a pure species, so <span class="math notranslate nohighlight">\(y_j^\circ = 1\)</span>.  Further, that pure species is at 1 bar, so <span class="math notranslate nohighlight">\(\phi_j^\circ = 1\)</span>. This gives the usual result for low pressure gases:</p>
<div class="math notranslate nohighlight">
\[a_j = \frac{y_j P}{P^\circ}\]</div>
<p>Now we apply this equation to all of the species participating in the reaction.  Notice that I’m still retaining <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(P^\circ\)</span> in my solution:</p>
<div class="math notranslate nohighlight">
\[K = \frac{\left(\frac{y_{N\!H_3}P}{P^\circ}\right)^2}{\left(\frac{y_{N_2}P}{P^\circ}\right) \left(\frac{y_{H_2}P}{P^\circ}\right)^3}\]</div>
<p>We see multiple pressures and reference pressures that will cancel, giving:</p>
<div class="math notranslate nohighlight">
\[K = \frac{{y_{N\!H_3}}^2}{y_{N_2}{y_{H_2}}^3} \left(\frac{P^\circ}{P}\right)^2\]</div>
<p>Now we’re at a point that we can’t really go any further because we have 3 unknowns (<span class="math notranslate nohighlight">\(y_{N\!H_3}\)</span>, <span class="math notranslate nohighlight">\(y_{N_2}\)</span>, and <span class="math notranslate nohighlight">\(y_{H_2}\)</span>) and only 1 equation.  As before, we address this by solving for the molar quantity of each species using an extent of reaction, stoichiometric coefficients, and the starting quantity of each species.</p>
</section>
<section id="expressing-mole-fractions-as-functions-of-extent">
<h4>Expressing Mole Fractions as functions of Extent<a class="headerlink" href="#expressing-mole-fractions-as-functions-of-extent" title="Link to this heading">#</a></h4>
<p>In general, the mole fraction for a species in the gas phase is defined as:</p>
<div class="math notranslate nohighlight">
\[y_j = \frac{N_j}{N_{\textrm{total}}} = \frac{N_j}{\sum_j N_j}\]</div>
<p>We also remember that we can express the moles of each species at any point in the reaction, <span class="math notranslate nohighlight">\(N_j\)</span> in terms of the extent of reaction(s) that are occuring in that system.</p>
<div class="math notranslate nohighlight">
\[N_j = N_{j,0} + \nu_j \varepsilon\]</div>
<p>We want to apply this equation for all species in the reactor. We can also see that the total number of moles shows up in the definition of a mole fraction, so we need to track that quantity as well. It is usually a good idea to organize all of this information in a mole table – no matter how many equilibrium problems I solve, I still always use this simple tool to organize information. We will again relabel the compounds using N (<span class="math notranslate nohighlight">\(N_2\)</span>), H (<span class="math notranslate nohighlight">\(H_2\)</span>), and A (<span class="math notranslate nohighlight">\(NH_3\)</span>).</p>
<div class="math notranslate nohighlight">
\[N (g) + 3H (g) \leftrightharpoons 2A (g)\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Species</p></th>
<th class="head text-center"><p>In</p></th>
<th class="head text-center"><p>Change</p></th>
<th class="head text-center"><p>End</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(N_2\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{N0}\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(-1\varepsilon\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{N0} - 1\varepsilon\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(H_2\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{H0}\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(-3\varepsilon\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{H0} - 3\varepsilon\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(N\!H_3\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{A0}\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(+2\varepsilon\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{A0} + 2\varepsilon\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Total</p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{T0}\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(-2\varepsilon\)</span></p></td>
<td class="text-center"><p><span class="math notranslate nohighlight">\(N_{T0} - 2\varepsilon\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>We can make these substitutions into the definitions of mole fractions, ultimately finding:</p>
<div class="math notranslate nohighlight">
\[K = \frac{\left(N_{A,0} + 2\varepsilon\right)^2 \left(N_{T,0} - 2\varepsilon\right)^2}{\left(N_{N,0} - 1\varepsilon\right) \left(N_{H,0} - 3\varepsilon\right)^3} \left(\frac{P^\circ}{P}\right)^2\]</div>
<p>As covered previously, when writing a script to solve a problem, it is often preferable to write the equations in code and allow the script to perform the substitutions rather than doing them by hand and (1) risk making mistakes and (2) generate an objective function that has lost most connections with physically meaningful expressions and definitions.  We build this objective function below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">####################################################################################################################################</span>
<span class="c1"># Define the basis; as done here, these are global variables stored in the workspace and accessible within all functions and loops #</span>
<span class="c1">####################################################################################################################################</span>

<span class="n">NN0</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#mole of Nitrogen at start</span>
<span class="n">NH0</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#moles of Hydrogen at start</span>
<span class="n">NA0</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#moles of Ammonia at start</span>
<span class="n">NT0</span> <span class="o">=</span> <span class="n">NN0</span> <span class="o">+</span> <span class="n">NH0</span> <span class="o">+</span> <span class="n">NA0</span> <span class="c1">#total moles at start</span>

<span class="c1"># Define reference pressure; it is constant throughout all problems</span>
<span class="n">P0</span>  <span class="o">=</span> <span class="mi">1</span> <span class="c1">#bar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">obj1</span><span class="p">(</span><span class="n">ε</span><span class="p">):</span>

    <span class="c1">#Specifications for this problem</span>
    <span class="n">T</span>   <span class="o">=</span> <span class="mi">873</span> <span class="c1">#K</span>
    <span class="n">P</span>   <span class="o">=</span> <span class="mf">1.0</span> <span class="c1">#bar</span>
       
    <span class="n">NN</span>  <span class="o">=</span> <span class="n">NN0</span> <span class="o">-</span> <span class="n">ε</span>
    <span class="n">NH</span>  <span class="o">=</span> <span class="n">NH0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">ε</span>
    <span class="n">NA</span>  <span class="o">=</span> <span class="n">NA0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ε</span>
    <span class="n">NT</span>  <span class="o">=</span> <span class="n">NN</span> <span class="o">+</span> <span class="n">NH</span> <span class="o">+</span> <span class="n">NA</span>
    
    <span class="n">yN</span>  <span class="o">=</span> <span class="n">NN</span><span class="o">/</span><span class="n">NT</span>
    <span class="n">yH</span>  <span class="o">=</span> <span class="n">NH</span><span class="o">/</span><span class="n">NT</span>
    <span class="n">yA</span>  <span class="o">=</span> <span class="n">NA</span><span class="o">/</span><span class="n">NT</span>
    
    <span class="n">aN</span>  <span class="o">=</span> <span class="n">yN</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    <span class="n">aH</span>  <span class="o">=</span> <span class="n">yH</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    <span class="n">aA</span>  <span class="o">=</span> <span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    
    <span class="n">KCOMP</span> <span class="o">=</span> <span class="n">aA</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">aN</span><span class="o">/</span><span class="n">aH</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">KTHERMO</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>       

    <span class="k">return</span> <span class="n">KCOMP</span> <span class="o">-</span> <span class="n">KTHERMO</span>  <span class="c1">#We want to find the value of extent where KCOMP - Kthermo = 0</span>

<span class="c1"># T = 673 #K</span>
<span class="c1"># P = 200 #bar</span>
<span class="n">ans</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#This solves for the equilibrium extent</span>

<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#Let&#39;s make sure it converged...</span>

<span class="c1">#Solve for conversion and mole fractions.</span>
<span class="n">NN</span> <span class="o">=</span> <span class="n">NN0</span> <span class="o">-</span> <span class="n">ans</span>
<span class="n">NH</span> <span class="o">=</span> <span class="n">NH0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NA</span> <span class="o">=</span> <span class="n">NA0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NT</span> <span class="o">=</span> <span class="n">NN</span> <span class="o">+</span> <span class="n">NH</span> <span class="o">+</span> <span class="n">NA</span>
<span class="n">XN</span> <span class="o">=</span> <span class="p">(</span><span class="n">NN0</span> <span class="o">-</span> <span class="n">NN</span><span class="p">)</span><span class="o">/</span><span class="n">NN0</span>
<span class="n">yN</span> <span class="o">=</span> <span class="n">NN</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yH</span> <span class="o">=</span> <span class="n">NH</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yA</span> <span class="o">=</span> <span class="n">NA</span><span class="o">/</span><span class="n">NT</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The equilibrium conversion of N2 is </span><span class="si">{</span><span class="n">XN</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">, yN is </span><span class="si">{</span><span class="n">yN</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, yH is </span><span class="si">{</span><span class="n">yH</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, and yA is </span><span class="si">{</span><span class="n">yA</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># print(f&#39;At T = {T:0.0f}K and P = {P:0.1f}bar, the equilibrium conversion of N2 is {XN:0.2E}, yN is {yN:0.3f}, yH is {yH:0.3f}, and yA is {yA:0.2E}&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      converged: True
           flag: converged
 function_calls: 49
     iterations: 48
           root: 0.0007985377076979054
         method: secant 

The equilibrium conversion of N2 is 7.99E-04, yN is 0.250, yH is 0.750, and yA is 3.99E-04
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="passing-t-and-p-as-extra-arguments-to-opt-newton-or-opt-root">
<h2>Passing T and P as extra arguments to <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code><a class="headerlink" href="#passing-t-and-p-as-extra-arguments-to-opt-newton-or-opt-root" title="Link to this heading">#</a></h2>
<p>Wouldn’t it be nice if we could pass T and P as arguments to the objective function? That way, we wouldn’t have to hard code their values for every different scenario or store them as global variables in the workspace, which can lead to mistakes when we define global variables multiple times within the same script. We can actually do this easily in Python using either the <code class="docutils literal notranslate"><span class="pre">args</span></code> keyword or using <code class="docutils literal notranslate"><span class="pre">lambda</span></code> functions.  We will cover both ways because they are both useful and either might be “better” depending on the problem you’re trying to solve.</p>
<p>To start, we’ll write a more general function that contains our system of equations we’re trying to solve.  It is almost identical to the form we usually use for <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code>, but in this case, we relax the requirement that that function only takes one argument (e.g., “ex”), and we give it 3 arguments instead:  <code class="docutils literal notranslate"><span class="pre">(ex,</span> <span class="pre">T,</span> <span class="pre">P)</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The function below cannot be solved directly with <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> because its default configuration only allows functions that accept a single argument.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">tempfun2</span><span class="p">(</span><span class="n">ε</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>

    <span class="c1">#Specifications for this problem</span>
    <span class="c1">#Trxn = T -- we are passing this into the function as an argument.</span>
    <span class="c1">#Prxn = P -- we are passing this into the function as an argument</span>

    <span class="c1"># P0  = 1.0 #bar #These are constant parameters that are defined globally in workspace</span>
    <span class="c1"># NN0 = 1.0 #moles</span>
    <span class="c1"># NH0 = 3.0 #moles</span>
    <span class="c1"># NA0 = 0.0 #moles</span>
    
    <span class="c1">#Mole Table, this captures extent of reaction</span>
    <span class="n">NN</span>  <span class="o">=</span> <span class="n">NN0</span> <span class="o">-</span> <span class="n">ε</span>
    <span class="n">NH</span>  <span class="o">=</span> <span class="n">NH0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">ε</span>
    <span class="n">NA</span>  <span class="o">=</span> <span class="n">NA0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ε</span>
    <span class="n">NT</span>  <span class="o">=</span> <span class="n">NN</span> <span class="o">+</span> <span class="n">NH</span> <span class="o">+</span> <span class="n">NA</span>
    
    <span class="c1">#Mole fractions -- note extent is built into definitions of NA, NB, NC, NT</span>
    <span class="n">yN</span>  <span class="o">=</span> <span class="n">NN</span><span class="o">/</span><span class="n">NT</span>
    <span class="n">yH</span>  <span class="o">=</span> <span class="n">NH</span><span class="o">/</span><span class="n">NT</span>
    <span class="n">yA</span>  <span class="o">=</span> <span class="n">NA</span><span class="o">/</span><span class="n">NT</span>
       
    <span class="c1">#Activity definitions -- extents embedded in yA, yB, yC; P and P0 also show up.</span>
    <span class="n">aN</span>  <span class="o">=</span> <span class="n">yN</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    <span class="n">aH</span>  <span class="o">=</span> <span class="n">yH</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    <span class="n">aA</span>  <span class="o">=</span> <span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
    
    <span class="c1">#This is our ratio of thermodynamic activities at equiliribum, i.e., Kactivity = Product(a_j^nu_j)</span>
    <span class="n">KACTIVITY</span> <span class="o">=</span> <span class="n">aA</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">aN</span><span class="o">/</span><span class="n">aH</span><span class="o">**</span><span class="mi">3</span>
    
    <span class="c1">#Calculate the equilibrium constant at T = Trxn</span>
    <span class="n">KTHERMO</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> 
       
    <span class="k">return</span> <span class="n">KACTIVITY</span> <span class="o">-</span> <span class="n">KTHERMO</span>  <span class="c1">#We want to find the value of extent where KCOMP - Kthermo = 0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="c1"># print(tempfun2(0.5))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tempfun2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">873</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># opt.newton(tempfun2, 0.01)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.333331818210124
5.333331818210124
</pre></div>
</div>
</div>
</div>
<section id="passing-extra-parameters-with-lambda-functions">
<h3>Passing extra parameters with lambda functions<a class="headerlink" href="#passing-extra-parameters-with-lambda-functions" title="Link to this heading">#</a></h3>
<p>We can now solve this for any T and P pair by passing them as arguments to the objective function. This is a little more difficult to do than the original example because <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> still only takes a single argument (<span class="math notranslate nohighlight">\(\varepsilon\)</span>).  We can get around this in two ways.  The first we’ll illustrate is to use an anonymous or <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function to “pass extra parameters.”  This is a standard tool for doing this in most programming languages, and it is the best practice for this style of solution in Matlab and Julia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Trxn</span> <span class="o">=</span> <span class="mi">873</span><span class="c1">#673 #K</span>
<span class="n">Prxn</span> <span class="o">=</span> <span class="mi">1</span><span class="c1">#200 #bar</span>
<span class="n">obj2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ε</span><span class="p">:</span> <span class="n">tempfun2</span><span class="p">(</span><span class="n">ε</span><span class="p">,</span> <span class="n">Trxn</span><span class="p">,</span> <span class="n">Prxn</span><span class="p">)</span> <span class="c1">#Essentially converts tempfun(ex, T, P) to objective(ex)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj1</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="c1"># print(tempfun2(0.5))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.333331818210124
5.333331818210124
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Trxn</span> <span class="o">=</span> <span class="mi">673</span> <span class="c1">#K</span>
<span class="n">Prxn</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1">#bar</span>
<span class="n">obj2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ε</span><span class="p">:</span> <span class="n">tempfun2</span><span class="p">(</span><span class="n">ε</span><span class="p">,</span> <span class="n">Trxn</span><span class="p">,</span> <span class="n">Prxn</span><span class="p">)</span>
<span class="n">ans</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">obj2</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#This solves for the equilibrium extent</span>

<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="c1">#Let&#39;s make sure it converged...</span>

<span class="c1">#Solve for conversion and mole fractions.</span>
<span class="n">NN</span> <span class="o">=</span> <span class="n">NN0</span> <span class="o">-</span> <span class="n">ans</span>
<span class="n">NH</span> <span class="o">=</span> <span class="n">NH0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NA</span> <span class="o">=</span> <span class="n">NA0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NT</span> <span class="o">=</span> <span class="n">NN</span> <span class="o">+</span> <span class="n">NH</span> <span class="o">+</span> <span class="n">NA</span>
<span class="n">XN</span> <span class="o">=</span> <span class="p">(</span><span class="n">NN0</span> <span class="o">-</span> <span class="n">NN</span><span class="p">)</span><span class="o">/</span><span class="n">NN0</span>
<span class="n">yN</span> <span class="o">=</span> <span class="n">NN</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yH</span> <span class="o">=</span> <span class="n">NH</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yA</span> <span class="o">=</span> <span class="n">NA</span><span class="o">/</span><span class="n">NT</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At T = </span><span class="si">{</span><span class="n">Trxn</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1">K and P = </span><span class="si">{</span><span class="n">Prxn</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1"> bar, conversion of N2 is </span><span class="si">{</span><span class="n">XN</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, yN is </span><span class="si">{</span><span class="n">yN</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, yH is </span><span class="si">{</span><span class="n">yH</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, and yA is </span><span class="si">{</span><span class="n">yA</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged
At T = 673K and P = 200 bar, conversion of N2 is 0.512, yN is 0.164, yH is 0.492, and yA is 0.344.
</pre></div>
</div>
</div>
</div>
</section>
<section id="passing-extra-parameters-with-the-args-keyword-in-python">
<h3>Passing extra parameters with the args keyword in Python<a class="headerlink" href="#passing-extra-parameters-with-the-args-keyword-in-python" title="Link to this heading">#</a></h3>
<p>The second way to handle this is somewhat specific to Python, but it is convenient and worth knowing.  Both <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code> and <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> will accept a keyword argument called <code class="docutils literal notranslate"><span class="pre">args</span></code>.  We can use this to pass extra parameters into equations being solved by numerical methods.  It is functionally identical to what we did above with a lambda function, but the syntax is arguably a little cleaner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Trxn</span> <span class="o">=</span> <span class="mi">673</span> <span class="c1">#K</span>
<span class="n">Prxn</span>  <span class="o">=</span> <span class="mi">200</span> <span class="c1">#bar</span>
<span class="n">ans</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">tempfun2</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Trxn</span><span class="p">,</span> <span class="n">Prxn</span><span class="p">),</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1">#This solves for the equilibrium extent</span>

<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="c1">#Let&#39;s make sure it converged...</span>

<span class="c1">#Solve for conversion and mole fractions.</span>
<span class="n">NN</span> <span class="o">=</span> <span class="n">NN0</span> <span class="o">-</span> <span class="n">ans</span>
<span class="n">NH</span> <span class="o">=</span> <span class="n">NH0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NA</span> <span class="o">=</span> <span class="n">NA0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ans</span>
<span class="n">NT</span> <span class="o">=</span> <span class="n">NN</span> <span class="o">+</span> <span class="n">NH</span> <span class="o">+</span> <span class="n">NA</span>
<span class="n">XN</span> <span class="o">=</span> <span class="p">(</span><span class="n">NN0</span> <span class="o">-</span> <span class="n">NN</span><span class="p">)</span><span class="o">/</span><span class="n">NN0</span>
<span class="n">yN</span> <span class="o">=</span> <span class="n">NN</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yH</span> <span class="o">=</span> <span class="n">NH</span><span class="o">/</span><span class="n">NT</span>
<span class="n">yA</span> <span class="o">=</span> <span class="n">NA</span><span class="o">/</span><span class="n">NT</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;At T = </span><span class="si">{</span><span class="n">Trxn</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1">K and P = </span><span class="si">{</span><span class="n">Prxn</span><span class="si">:</span><span class="s1">0.0f</span><span class="si">}</span><span class="s1"> bar, conversion of N2 is </span><span class="si">{</span><span class="n">XN</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, yN is </span><span class="si">{</span><span class="n">yN</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, yH is </span><span class="si">{</span><span class="n">yH</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, and yA is </span><span class="si">{</span><span class="n">yA</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged
At T = 673K and P = 200 bar, conversion of N2 is 0.512, yN is 0.164, yH is 0.492, and yA is 0.344.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="why-go-through-the-trouble">
<h2>Why go through the trouble?<a class="headerlink" href="#why-go-through-the-trouble" title="Link to this heading">#</a></h2>
<p>We have a good reason to set up problems in a more general way like this.  At a minimum, it is clear that this format is nice for allowing us to explore the impact of changing parameters. We don’t have to write much extra code, we just pass new values of <span class="math notranslate nohighlight">\((T, P)\)</span> to our objective function and obtain a new solution. This is a nice first step in obtaining very general information about how a reaction will respond to changes in operating conditions.  We shouldn’t restrict ourselves to solving the problem at a single <span class="math notranslate nohighlight">\((T, P)\)</span> – it is much more informative if we can solve the problem at many different temperatures or pressures so that we can develop a good understanding of system behavior and also be able to quantitatively state how the system will respond to a change in operating conditions.</p>
<p>This is a good place to employ loops, which are nice tools for repeating the same operation over a set.  You could imagine writing a loop to, for example, solve the ammonia equilibrium problem at many different temperatures.  We’ll do this below. First, let’s look a little at how loops behave and how we will work with them. For these examples, we want to run iterations on a known set of temperatures, so a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop is the best tool. In contrast, you want to use a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop if you want to continue an operation until a threshold criterion is met.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">####################################################</span>
<span class="c1"># Some simple for loop examples                    #</span>
<span class="c1">####################################################</span>

<span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a
b
c
d
e

1
2
3
4
5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 b
2 c
3 d
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">**</span><span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
4
9
16
25
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">letters</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span> <span class="c1">#this is equivalent to for i in range(0, 5, 1):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 a
1 b
2 c
3 d
4 e
</pre></div>
</div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Loops will generally overwrite variables defined within a loop. If you need to store the results generated in the course of a loop, you have to deliberately build this into the loop. There are multiple ways to do this – you can append the result to an existing array, or you can store the result in pre-allocated space within an array.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">result_local</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">result_local</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 1
1 4
2 9
3 16
4 25
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_global</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_global</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">result_local</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">result_local</span><span class="p">)</span>
    <span class="n">result_global</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_local</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">result_local</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result_global</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0. 0. 0. 0. 0.]
0 1
1 4
2 9
3 16
4 25

 25
[ 1.  4.  9. 16. 25.]
</pre></div>
</div>
</div>
</div>
<p>The Cell below uses a for loop to solve for the equilibrium conversion during ammonia synthesis at 1 bar and temperatures ranging from 300K to 900K. There is one small change from prior scripts – it is hard to provide a good initial guess over such a large temperature range, so this script changes the numerical method used by opt.newton() from a secant method (default) to Brent’s Method, which does not require an initial guess and offers better stability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PRXN</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1">#bar</span>
<span class="c1"># TSET = [298]</span>
<span class="c1"># TSET = [298, 323, 523]</span>
<span class="n">TSET</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">#K</span>

<span class="n">XOUT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TSET</span><span class="p">))</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TSET</span><span class="p">))</span>
<span class="c1"># print(XOUT)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TSET</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># print(TSET[j])</span>
    <span class="n">objective</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ε</span><span class="p">:</span> <span class="n">tempfun2</span><span class="p">(</span><span class="n">ε</span><span class="p">,</span> <span class="n">TSET</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">PRXN</span><span class="p">)</span>
    <span class="c1"># ans, info = opt.newton(objective, 0.99, full_output = True)</span>
    <span class="n">ans</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">,</span> <span class="n">xtol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">full_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># print(ans, info.converged, &#39;\n&#39;)</span>
    <span class="n">XOUT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ans</span><span class="o">/</span><span class="n">NN0</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">converged</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">converged</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">XOUT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ans</span><span class="o">/</span><span class="n">NN0</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">converged</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">XOUT</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0006260199122987484
[9.65812469e-01 9.58972221e-01 9.51091063e-01 9.42064604e-01
 9.31785653e-01 9.20145549e-01 9.07035854e-01 8.92350607e-01
 8.75989066e-01 8.57859186e-01 8.37881790e-01 8.15995542e-01
 7.92162576e-01 7.66374787e-01 7.38660363e-01 7.09090216e-01
 6.77783604e-01 6.44912287e-01 6.10702164e-01 5.75431706e-01
 5.39426427e-01 5.03049176e-01 4.66686512e-01 4.30732100e-01
 3.95568580e-01 3.61549823e-01 3.28985381e-01 2.98128766e-01
 2.69170488e-01 2.42236127e-01 2.17388945e-01 1.94636166e-01
 1.73937579e-01 1.55215357e-01 1.38363942e-01 1.23259227e-01
 1.09766552e-01 9.77472301e-02 8.70636342e-02 7.75828821e-02
 6.91793690e-02 6.17363111e-02 5.51465409e-02 4.93127378e-02
 4.41472485e-02 3.95716717e-02 3.55162301e-02 3.19190990e-02
 2.87256593e-02 2.58877945e-02 2.33631875e-02 2.11146732e-02
 1.91096335e-02 1.73194698e-02 1.57190987e-02 1.42865243e-02
 1.30024575e-02 1.18499633e-02 1.08141760e-02 9.88203141e-03
 9.04203976e-03 8.28408720e-03 7.59925851e-03 6.97969486e-03
 6.41845264e-03 5.90939392e-03 5.44708937e-03 5.02671858e-03
 4.64401607e-03 4.29518646e-03 3.97685579e-03 3.68601977e-03
 3.42000023e-03 3.17640718e-03 2.95309963e-03 2.74817128e-03
 2.55990766e-03 2.38677281e-03 2.22738681e-03 2.08051437e-03
 1.94503478e-03 1.81994472e-03 1.70433760e-03 1.59739478e-03
 1.49837630e-03 1.40661262e-03 1.32149738e-03 1.24248098e-03
 1.16906000e-03 1.10078710e-03 1.03724635e-03 9.78062737e-04
 9.22893983e-04 8.71428950e-04 8.23379440e-04 7.78487891e-04
 7.36515420e-04 6.97243853e-04 6.60474347e-04 6.26019912e-04]
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1.]
</pre></div>
</div>
</div>
</div>
<p>Since we have such a large number of equilibrium solutions, it is much easier to interpret the results if we can visualize them. Below, we graph the equilibrium conversion of nitrogen at 1 bar as a function of temperature from 300K to 900K. It is important to understand that we obtained each data point on this figure by solving an equilibrium problem at a specific reaction temperature. This was accomplished using a for loop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">TSET</span><span class="p">,</span> <span class="n">XOUT</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;N2 Conversion&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;T (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">901</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/98ac6feb7cb775a6f4ec0bd58a182ebce51318c40840cd160143ea266f20cdec.png" src="../_images/98ac6feb7cb775a6f4ec0bd58a182ebce51318c40840cd160143ea266f20cdec.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="587-N08.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chemical Equilibrium IV</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ammonia-synthesis-under-industrial-conditions">Ammonia Synthesis Under Industrial Conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#thermodynamic-data-and-k">Thermodynamic data and K</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-is-also-a-function-of-thermodynamic-activities">K is also a function of thermodynamic activities!</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expressing-mole-fractions-as-functions-of-extent">Expressing Mole Fractions as functions of Extent</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-t-and-p-as-extra-arguments-to-opt-newton-or-opt-root">Passing T and P as extra arguments to <code class="docutils literal notranslate"><span class="pre">opt.newton()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-parameters-with-lambda-functions">Passing extra parameters with lambda functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-parameters-with-the-args-keyword-in-python">Passing extra parameters with the args keyword in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-go-through-the-trouble">Why go through the trouble?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>