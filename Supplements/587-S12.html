
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Solving Systems of Nonlinear Equations &#8212; Kinetics and Reaction Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Least Squares Revisited: opt.least_squares()" href="587-S13.html" />
    <link rel="prev" title="Minimization of Multivariate Functoins" href="587-S11.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/JQB.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Kinetics and Reaction Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Chapter1.html">
   Python Supplements
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="587-S01.html">
     The Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S02.html">
     Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S03.html">
     Arrays and Matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S04.html">
     For Loops, Vectorization, and Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S05.html">
     Logical Tests and Comparisons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S06.html">
     While Loops in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S07.html">
     Functions, D&amp;D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S08.html">
     The Probability of the Fall of Acererak
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S09.html">
     Root Finding: Univariate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S10.html">
     Minimizing a Univariate Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S11.html">
     Minimization of Multivariate Functoins
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Solving Systems of Nonlinear Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S13.html">
     Least Squares Revisited:
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.least_squares()
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S14.html">
     Numerical Solution of Ordinary Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-S15.html">
     Quadrature
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter2.html">
   Lectures
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L01.html">
     Lecture 01: Introduction and Stoichiometry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L02.html">
     Lecture 02: Extent and Conversion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L03.html">
     Lecture 03: Numerical methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L04.html">
     Lecture 04: Chemical Equilibrium Part 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L05.html">
     Lecture 05: Chemical Equilibrium Part 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L06.html">
     Lecture 06
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L07.html">
     Lecture 07: Ammonia Equilibrium - Part 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L08.html">
     Lecture 08: Multi-reaction equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L09.html">
     Lecture 09: Chemical and Phase equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L10.html">
     Lecture 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L11.html">
     Lecture 11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L12.html">
     Lecture 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L13.html">
     Lecture 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L14.html">
     Lecture 14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L15.html">
     Lecture 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L16.html">
     Lecture 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L17.html">
     Lecture 17
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L18.html">
     Lecture 18
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L19.html">
     Lecture 19
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L20.html">
     Lecture 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L22.html">
     Lecture 22
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L23.html">
     Lecture 23
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L24.html">
     Lecture 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L25.html">
     Lecture 25
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L26.html">
     Lecture 26
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L27.html">
     Lecture 27
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L28.html">
     Lecture 28
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L31.html">
     Lecture 31
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L32.html">
     Lecture 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L33.html">
     Lecture 33
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L34.html">
     Lecture 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L35.html">
     Lecture 35
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L36.html">
     Lecture 36
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L37.html">
     Lecture 37
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L38.html">
     Lecture 36
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L39.html">
     Lecture 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L40.html">
     Lecture 40
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L41.html">
     Lecture 41
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L42.html">
     Lecture 42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Lectures/587-L43.html">
     Lecture 43
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3.html">
   Recitations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jqbond/AICHE2022_Python/main?urlpath=tree/Supplements/587-S12.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jqbond/AICHE2022_Python"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jqbond/AICHE2022_Python/issues/new?title=Issue%20on%20page%20%2FSupplements/587-S12.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Supplements/587-S12.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-intuitive-function-definition-to-define-this-system">
   An intuitive function definition to define this system
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#note-the-incompatibility-with-scipy-s-opt-root">
   Note the incompatibility with Scipy’s
   <code class="docutils literal notranslate">
    <span class="pre">
     opt.root()
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-multivariate-vector-function-for-compatibility-with-opt-root">
     Defining a multivariate vector function for compatibility with
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.root()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confirm-that-this-function-will-accept-an-array-input-and-return-an-array-output">
     Confirm that this function will accept an array input and return an array output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solve-system-with-opt-root">
     Solve system with
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.root()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-solver-algorithms">
     Changing Solver Algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-word-of-caution">
   A Word of Caution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-final-useful-example">
   One final useful Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-function-that-encodes-the-system-of-equations">
     Define the function that encodes the system of equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-that-calculates-jacobian">
     Define a function that calculates Jacobian
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Solving Systems of Nonlinear Equations</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-intuitive-function-definition-to-define-this-system">
   An intuitive function definition to define this system
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#note-the-incompatibility-with-scipy-s-opt-root">
   Note the incompatibility with Scipy’s
   <code class="docutils literal notranslate">
    <span class="pre">
     opt.root()
    </span>
   </code>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-multivariate-vector-function-for-compatibility-with-opt-root">
     Defining a multivariate vector function for compatibility with
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.root()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confirm-that-this-function-will-accept-an-array-input-and-return-an-array-output">
     Confirm that this function will accept an array input and return an array output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solve-system-with-opt-root">
     Solve system with
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.root()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-solver-algorithms">
     Changing Solver Algorithms
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-word-of-caution">
   A Word of Caution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-final-useful-example">
   One final useful Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-function-that-encodes-the-system-of-equations">
     Define the function that encodes the system of equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-that-calculates-jacobian">
     Define a function that calculates Jacobian
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="solving-systems-of-nonlinear-equations">
<h1>Solving Systems of Nonlinear Equations<a class="headerlink" href="#solving-systems-of-nonlinear-equations" title="Permalink to this headline">#</a></h1>
<p>We have covered root finding algorithms for univariate scalar functions (Module 09), optimization algorithms for univariate scalar functions (Module 10), and optimization algoritms for multivariate scalar functions (Module 11). Now we will tacklesolving systems of equations. Broadly speaking, these are classified as sets of multivariate functions.  Our goal in “solving” them is to find the values of the complete set of variables that results in each of our equations being equal to zero.  It is high dimensional root finding.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this assignment we are covering best practices for solving systems of <strong>nonlinear equations</strong>.  You can apply these methods to a system of linear equations, but there are much more efficient, closed-form analytical solutions based on linear algebra. If you are dealing with linear systems, then you want to use linear methods since they are more efficient and stable than the iterative, numerical solutions we’ll use here.</p>
</div>
<p>As an example, consider solving the following system of nonlinear equations:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    x^2 - 3y &amp;= 14.75z - w^4 \\
    25 &amp;= x^3 - z \\ 
    0 &amp;= \ln(z) - z^2 + 2x + 3 \\
    z + xw &amp;= 74
\end{align*}\]</div>
<p>It is clear that we cannot solve any one equation above to determine the values for <code class="docutils literal notranslate"><span class="pre">w</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> that satisfy these equations. We have to solve all four of them together, as a system, to do that.  We do have analytical methods that are useful - most students default to a substitution method, for example.  In general, this is fine if you want an analytical solution but we should note two problems with the approach.  First, solving large nonlinear systems this way requires extensive algebraic manipulations, which is both extremely tedious and extremely error-prone. Second, it isn’t always possible to solve a system of nonlinear equations using analytical methods. More frequently, we will rely on numerical methods to solve nonlinear systems.  Similar to the cases we’ve already considered (e.g., a Newton-Raphson iteration), they are based on iterative solutions that proceed until the system reaches some convergence threshold. Just like with univariate equations, our convergence threshold is that we want the equations to evaluate to zero, it’s just in this case, we want each and every equation to equal zero.</p>
<p>Now that we have a basic familiarity, we’ll jump straight into the root finding algorithms available in Python. Solving nonlinear systems numerically is, in general, very difficult, and it requires both good algorithms and good initial guesses, so we’ll skip writing our own routines like we did with univariate functions, but it is important to know that the basic approach of iteratively updating variable values until reaching your convergence threshold is the same.</p>
<p>When we solve a system of equations numerically in Python (or in most softwares), we need to write that system as a set of equations that should evaluate to zero once we find our solution. So no matter how the functions are presented to me, I will convert them into a form where the left-hand-side is zero, and the right hand side specifies the function. Following this logic, I would write the above system as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    0 &amp;= -x^2 - + 3y + 14.75z - w^4 \\
    0 &amp;= x^2 - z - 25 \\
    0 &amp;= \ln(z) - z^2 + 2x + 3 \\
    0 &amp;= z + xw - 74
\end{align*}\]</div>
<p>That is the form we want to work with moving forward.</p>
<section id="an-intuitive-function-definition-to-define-this-system">
<h2>An intuitive function definition to define this system<a class="headerlink" href="#an-intuitive-function-definition-to-define-this-system" title="Permalink to this headline">#</a></h2>
<p>Just as in root finding and optimization for scalar equations, we want to construct a function that encodes this system and returns the left hand side of our equation(s). No problem, right?  We know how to create a multivariate function, so this is straightforward.  We will walk through the way we would probably do this intuitively, and then we’ll explain what that won’t work for a numerical solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">eq1</span> <span class="o">=</span>  <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mf">14.75</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">w</span><span class="o">**</span><span class="mi">4</span>
    <span class="n">eq2</span> <span class="o">=</span>   <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">25</span>
    <span class="n">eq3</span> <span class="o">=</span>   <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">eq4</span> <span class="o">=</span>   <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">w</span> <span class="o">-</span> <span class="mi">74</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">eq1</span><span class="p">,</span> <span class="n">eq2</span><span class="p">,</span> <span class="n">eq3</span><span class="p">,</span> <span class="n">eq4</span><span class="p">]</span>   <span class="c1">#Technically, this will return a list [eq1, eq2, eq3, eq4]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, I can run that function for any (w,x,y,z) set and see the LHS value returned by each equation.  There is about a 0% chance they are all equal to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[63.0, -25, -7.613705638880109, -68]
</pre></div>
</div>
</div>
</div>
</section>
<section id="note-the-incompatibility-with-scipy-s-opt-root">
<h2>Note the incompatibility with Scipy’s <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code><a class="headerlink" href="#note-the-incompatibility-with-scipy-s-opt-root" title="Permalink to this headline">#</a></h2>
<p>Technically, there is nothing wrong with our function.  It evaluates the system.  It is just not compatible with Python syntax for numerical root finding, so this function form is not approprite for a multivariate root finding algorithm.  We have to do two things to make this work:</p>
<ol class="simple">
<li><p>We have to recognize that our root finding algorithm is iterative. It is going to vary the values of <code class="docutils literal notranslate"><span class="pre">w</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> until it converges. As in the case with optimization of multivariate functions using <code class="docutils literal notranslate"><span class="pre">opt.minimize()</span></code>, when we intend to vary these values iteratively, we <em>usually</em> need to pass them as the first argument to the function as a collection (a vector, array, list, tuple, etc.). That means we will pack <code class="docutils literal notranslate"><span class="pre">w</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> into a single vector-like variable, just like we did when regressing <span class="math notranslate nohighlight">\(K_m\)</span> and <span class="math notranslate nohighlight">\(V_{max}\)</span> with the Michaelis-Menten model in Module 11.</p></li>
<li><p>Similar to the way our root finding algorithm wants all of our unknown variables input as an array-like quantity, it wants our function to return the left-hand-side solution to each equation in an array-like set of identical size to our set of variables.</p></li>
</ol>
<section id="defining-a-multivariate-vector-function-for-compatibility-with-opt-root">
<h3>Defining a multivariate vector function for compatibility with <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code><a class="headerlink" href="#defining-a-multivariate-vector-function-for-compatibility-with-opt-root" title="Permalink to this headline">#</a></h3>
<p>Taking both of these things together, we are now working with a <em><strong>multivariate vector function</strong></em>.  It is multivariate because it depends on 4 different independent variables, and it is a vector function because it returns a vector quantity instead of a scalar quantity.  It’s easy to do, we just need to understand the two above points, which is what the root finding algorithm needs from us.  With that in mind, we’ll construct our system as a multivariate vector function (with a vector argument). Python is actually pretty forgiving in terms of whether you provide inputs as lists, arrays, tuples, or a mix thereof, but in general, I prefer to use a consistent type and dimensionality for inputs and outputs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">var</span>   <span class="c1">#I like to relabel elements of the vector variable for readability</span>
    <span class="n">LHS1</span> <span class="o">=</span>  <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mf">14.75</span><span class="o">*</span><span class="n">z</span> <span class="o">-</span> <span class="n">w</span><span class="o">**</span><span class="mi">4</span>
    <span class="n">LHS2</span> <span class="o">=</span>   <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">25</span>
    <span class="n">LHS3</span> <span class="o">=</span>   <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">LHS4</span> <span class="o">=</span>   <span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">w</span> <span class="o">-</span> <span class="mi">74</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="p">[</span><span class="n">LHS1</span><span class="p">,</span> <span class="n">LHS2</span><span class="p">,</span> <span class="n">LHS3</span><span class="p">,</span> <span class="n">LHS4</span><span class="p">]</span> <span class="c1">#I&#39;m using a list, but you can return a tuple or array just as easily.</span>
    <span class="k">return</span> <span class="n">retval</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="confirm-that-this-function-will-accept-an-array-input-and-return-an-array-output">
<h3>Confirm that this function will accept an array input and return an array output<a class="headerlink" href="#confirm-that-this-function-will-accept-an-array-input-and-return-an-array-output" title="Permalink to this headline">#</a></h3>
<p>Now, if we want to run this function for the same input as last time, we need to provide a vector argument. I’ll use a list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[63.0, -25, -7.613705638880109, -68]
</pre></div>
</div>
</div>
</div>
</section>
<section id="solve-system-with-opt-root">
<h3>Solve system with <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code><a class="headerlink" href="#solve-system-with-opt-root" title="Permalink to this headline">#</a></h3>
<p>Now that we’ve constructed the function, the syntax for the root finding algorithm is straightforward.  We’ll use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.root()</span></code>. This is the multivariate analog of <code class="docutils literal notranslate"><span class="pre">scipy.optimize.root_scalar()</span></code>, which we used in Module 09. As usual, I have aliased <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> as <code class="docutils literal notranslate"><span class="pre">opt</span></code>, so my syntax is in the following cell.  At a minimum, I have to provide the function name (F) and my initial guess at the roots (w, x, y, and z) that give F = 0.  You’ll notice that it provides a solution structure similar to those given by <code class="docutils literal notranslate"><span class="pre">opt.root_scalar()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.minimize()</span></code>, and you can access attributes within that structure using the dot operator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="c1">#This is a list with my 4 initial guesses at the &quot;roots&quot; for w, x, y, and z</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">var0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    fjac: array([[-9.99999786e-01,  2.16439481e-06,  4.12394877e-08,
         6.54018117e-04],
       [-4.89864222e-04, -6.54259823e-01, -1.19090081e-01,
        -7.46834250e-01],
       [ 4.33332846e-04, -7.34506405e-01, -1.35140183e-01,
         6.65009236e-01],
       [-2.68338866e-07,  1.80123360e-01, -9.83643575e-01,
        -9.44365147e-04]])
     fun: array([ 4.63944161e-07, -2.01083594e-11,  2.87059265e-12,  9.85522774e-11])
 message: &#39;The solution converged.&#39;
    nfev: 293
     qtf: array([ 5.71880420e-05,  4.29964652e-08, -5.28577241e-08,  9.90538145e-10])
       r: array([ 8.27419961e+03,  1.09944077e+01, -2.87554327e+00, -1.47493661e+01,
       -1.67940052e+01, -1.39469538e-03,  7.99711662e-01,  1.23000526e-03,
        2.42664776e+00,  7.24858618e+00])
  status: 1
 success: True
       x: array([1.30451990e+01, 5.37463986e+00, 9.64394731e+03, 3.88675366e+00]) 

[1.30451990e+01 5.37463986e+00 9.64394731e+03 3.88675366e+00]
</pre></div>
</div>
</div>
</div>
</section>
<section id="changing-solver-algorithms">
<h3>Changing Solver Algorithms<a class="headerlink" href="#changing-solver-algorithms" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">opt.root()</span></code> is quite flexible as it includes several root finding algorithms (<code class="docutils literal notranslate"><span class="pre">hybrid</span></code>, <code class="docutils literal notranslate"><span class="pre">levenberg-marquardt</span></code>, <code class="docutils literal notranslate"><span class="pre">kyrlov</span></code>, etc.). Method selection is easy with <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code>; similar to everything we’ve seen with <code class="docutils literal notranslate"><span class="pre">opt.minimize()</span></code>, you can select the algorithm using the <code class="docutils literal notranslate"><span class="pre">method</span></code> keyword argument.  So if I wanted to change from the default <code class="docutils literal notranslate"><span class="pre">hybr</span></code> method to <code class="docutils literal notranslate"><span class="pre">Levenberg-Marquardt</span></code>, I would do so by adding the method keyword argument and passing the string <code class="docutils literal notranslate"><span class="pre">LM</span></code>, which specifies Levenberg-Marquardt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">var0</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   cov_x: array([[ 9.35903829e-02, -2.32494542e-02,  2.77010862e+02,
        -1.36618666e-02],
       [-2.32494542e-02,  9.26047878e-03, -6.88054870e+01,
         4.15265487e-03],
       [ 2.77010862e+02, -6.88054870e+01,  8.19903354e+05,
        -4.05188398e+01],
       [-1.36618666e-02,  4.15265487e-03, -4.05188398e+01,
         1.92554021e-02]])
    fjac: array([[ 8.87998432e+03, -0.00000000e+00, -0.00000000e+00,
        -6.05253303e-04],
       [ 1.07571604e+01, -1.70163000e+01,  1.17534364e-01,
         7.66247096e-01],
       [-1.47493852e+01,  7.42031699e-01,  7.61320794e+00,
        -2.39975562e-01],
       [-2.99999942e+00, -1.39132074e-03,  3.76237457e-04,
        -1.10438034e-03]])
     fun: array([7.27595761e-12, 3.55271368e-15, 1.77635684e-15, 0.00000000e+00])
    ipvt: array([1, 2, 4, 3], dtype=int32)
 message: &#39;The relative error between two consecutive iterates is at most 0.000000&#39;
    nfev: 528
     qtf: array([ 2.25658836e-04,  1.38654350e-07, -3.58586763e-08,  1.27840531e-07])
  status: 2
 success: True
       x: array([1.30451990e+01, 5.37463986e+00, 9.64394731e+03, 3.88675366e+00])
</pre></div>
</div>
</div>
</div>
<p>As with minimization routines, the algorithms are all highly configurable using various options and keyword arguments, but these n-dimensional root finding algorithms using have algorithm specific options rather than options that are universal to all algorithms.  You’ll need to consult the specific algoritm to see what options are available for that particular method, but each uses the same basic syntax of keyword arguments and/or options dictionaries, both of which are covered in Modules 09 - 11.</p>
</section>
</section>
<section id="a-word-of-caution">
<h2>A Word of Caution<a class="headerlink" href="#a-word-of-caution" title="Permalink to this headline">#</a></h2>
<p>Solving algebraic systems of nonlinear equations using numerical methods is incredibly difficult; you need a good algorithm and good-to-very good initial guesses.  Unfortunately, it can be difficult to provide good initial guesses. We should use our physical insights about the systems we are studying to make initial guesses that we think will be very close to the actual solution, otherwise, it is unlikely that our solvers will converge for difficult nonlinear systems.  In fact, the first example in this worksheet is only easily solved by the <code class="docutils literal notranslate"><span class="pre">hybr</span></code> and <code class="docutils literal notranslate"><span class="pre">LM</span></code> algorithms, whereas others won’t converge easily.</p>
</section>
<section id="one-final-useful-example">
<h2>One final useful Example<a class="headerlink" href="#one-final-useful-example" title="Permalink to this headline">#</a></h2>
<p>Providing a Jacobian is usually a good idea when you are solving systems of equations numerically. It can be essential to performance and stability for difficult systems.  Most of the algorithms available in <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code> will accept a Jacobian input.  Since it is such an essential skill, we’ll demonstrate its usage.  The Jacobian is the set of partial derivatives of each function in your system with respect to each variable. In the system above, that means my Jacobian will be a 4x4 matrix since I’d have to take a partial derivative of each equation with respect to w, x, y, and z.  It isn’t <em>hard</em>, but it is tedious (although you may want to look at symbolic, numerical, and/or automatic differentiation methods for generating Jacobians, which can make it much easier.  We won’t cover that here). We’ll go through a simpler example and create the corresponding Jacobian analytically.</p>
<p>Here’s a simple system of equations written as functions of (a,b):</p>
<div class="amsmath math notranslate nohighlight" id="equation-fa8a3461-3ebf-4f1a-a2bc-f891770cb9a1">
<span class="eqno">(3)<a class="headerlink" href="#equation-fa8a3461-3ebf-4f1a-a2bc-f891770cb9a1" title="Permalink to this equation">#</a></span>\[\begin{align}
    0 &amp;= a^3 - e^{-b} \\
    0 &amp;= ab - b^2 + 5
\end{align}\]</div>
<section id="define-the-function-that-encodes-the-system-of-equations">
<h3>Define the function that encodes the system of equations<a class="headerlink" href="#define-the-function-that-encodes-the-system-of-equations" title="Permalink to this headline">#</a></h3>
<p>We can encode that a multivariate vector function in Python.  Here, I am choosing to call it q(v) and return the left hand side of these equations in a numpy array:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">eq1</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="n">eq2</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eq1</span><span class="p">,</span> <span class="n">eq2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-a-function-that-calculates-jacobian">
<h3>Define a function that calculates Jacobian<a class="headerlink" href="#define-a-function-that-calculates-jacobian" title="Permalink to this headline">#</a></h3>
<p>Now for the Jacobian, we need to calculate partial derivatives. a is my first variable, b is my second variable.  So I need to create a matrix that is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}J = \begin{vmatrix}
\frac{df_1}{da} &amp; \frac{df_1}{db} \\
\frac{df_2}{da} &amp; \frac{df_2}{db}
\end{vmatrix}\end{split}\]</div>
<p>In other words, the first row contains the partial derivatives of the first function with respect to each variable, the second row contains the partial derivative of the second function with respect to each variable, and so forth.  For this system, that becomes:</p>
<div class="math notranslate nohighlight">
\[\begin{split}J = \begin{vmatrix}
3a^2 &amp; e^{-b}\\
b &amp; a - 2b
\end{vmatrix}\end{split}\]</div>
<p>This can be defined as a function in Python as follows (using np.arrays):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">jac11</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">jac12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="n">jac21</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">jac22</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span>
    <span class="n">jac</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">jac11</span><span class="p">,</span> <span class="n">jac12</span><span class="p">],</span> <span class="p">[</span><span class="n">jac21</span><span class="p">,</span> <span class="n">jac22</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">jac</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The reason I’m using np.arrays above functions is that they np.arrays index like a matrix, and I’m most comfortable treating a Jacobian as a matrix. But you could do this with a list or a tuple if you wanted to.</p>
</div>
<p>Then we add the jacobian to the optimization routine using the <code class="docutils literal notranslate"><span class="pre">jac</span></code> keyword argument with following syntax; this solves the problem with the optional jacobian provided to the <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code> solver using the <code class="docutils literal notranslate"><span class="pre">hybr</span></code> algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">opt</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;hybr&#39;</span><span class="p">,</span> <span class="n">jac</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    fjac: array([[-0.22118893, -0.97523098],
       [ 0.97523098, -0.22118893]])
     fun: array([-8.22536483e-14, -7.54063478e-13])
 message: &#39;The solution converged.&#39;
    nfev: 14
    njev: 1
     qtf: array([-1.69990286e-09, -1.94595797e-10])
       r: array([-2.70315945,  4.04341967,  1.03995867])
  status: 1
 success: True
       x: array([0.43946782, 2.46657235])
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Supplements"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="587-S11.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Minimization of Multivariate Functoins</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="587-S13.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Least Squares Revisited: <code class="docutils literal notranslate"><span class="pre">opt.least_squares()</span></code></p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jesse Q. Bond, Syracuse University<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>