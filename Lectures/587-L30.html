
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Kinetics III &#8212; Kinetics and Reaction Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kinetics IV" href="587-L31.html" />
    <link rel="prev" title="Kinetics II" href="587-L29.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/JQB.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Kinetics and Reaction Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter1.html">
   Python Supplements
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S01.html">
     The Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S02.html">
     Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S03.html">
     Arrays and Matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S04.html">
     For Loops and Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S05.html">
     Logical Tests and Comparisons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S06.html">
     While Loops in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S07.html">
     Functions, D&amp;D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S08.html">
     The Fall of Acererak
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S09.html">
     Root Finding: Univariate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S10.html">
     Minimizing a Univariate Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S11.html">
     Minimizing Multivariate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S12.html">
     Systems of Nonlinear Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S13.html">
     Least Squares Revisited
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S14.html">
     ODE Solvers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S15.html">
     Quadrature
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Chapter2.html">
   Lectures
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="587-L01.html">
     Introduction and Stoichiometry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L02.html">
     Extent and Conversion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L03.html">
     Algebraic and Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L04.html">
     Chemical Equilibrium I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L05.html">
     Chemical Equilibrium II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L06.html">
     Chemical Equilibrium III
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L07.html">
     Chemical Equilibrium IV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L08.html">
     Chemical Equilibrium V
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L09.html">
     Chemical and Phase Equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L10.html">
     Material Balances I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L11.html">
     Material Balances II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L12.html">
     Material Balances III
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L13.html">
     Material Balances IV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L14.html">
     Material Balances V
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L15.html">
     Material Balances VI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L16.html">
     Material Balances VII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L17.html">
     Material Balances VIII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L18.html">
     Material Balances IX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L19.html">
     Material Balances X
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L20.html">
     Material Balances XI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L21.html">
     Material Balances XII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L22.html">
     Material Balances XIII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L23.html">
     Material Balances XIV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L24.html">
     Material Balances XV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L25.html">
     Material Balances XVI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L26.html">
     Material Balances XVII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L27.html">
     Material Balances XVIII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L28.html">
     Kinetics I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L29.html">
     Kinetics II
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Kinetics III
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L31.html">
     Kinetics IV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L32.html">
     Kinetics V
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L33.html">
     Kinetics VI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L34.html">
     Kinetics VII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L35.html">
     Kinetics VIII
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L36.html">
     Kinetics IX
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L37.html">
     Kinetics X
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L38.html">
     Kinetics XI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L39.html">
     Energy Balances I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L40.html">
     Energy Balances II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L41.html">
     Energy Balances III
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L42.html">
     Energy Balances IV
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L43.html">
     Energy Balances VI
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3.html">
   Recitations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R01.html">
     Jupyter and Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R02.html">
     Solving Algebraic Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R03.html">
     Chemical Equilibrium
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R04.html">
     Solving ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R05.html">
     Chemical/Phase Equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R06.html">
     CSTRs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R07.html">
     Python tips and tricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R08.html">
     Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R09.html">
     Reactors with Recycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R10.html">
     Interpolation and Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R11.html">
     Nonlinear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R12.html">
     Parameter Estimation I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R13.html">
     Parameter Estimation II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Recitation/587-R14.html">
     Energy Balances
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jqbond/2022CEN587/main?urlpath=tree/Lectures/587-L30.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jqbond/2022CEN587"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jqbond/2022CEN587/issues/new?title=Issue%20on%20page%20%2FLectures/587-L30.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Lectures/587-L30.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-01">
   Example Problem 01
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-to-example-problem-01">
     Solution to Example Problem 01
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#differential-analysis">
     Differential Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integral-analysis-with-nonlinear-regression">
     Integral Analysis with nonlinear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-order-solution">
       First Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#second-order-solution">
       Second Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#third-order-solution">
       Third Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary-of-integrated-models">
       Summary of integrated models
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nonlinear-least-squares">
     Nonlinear Least Squares
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-order-nonlinear-regression">
     First Order Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#second-order-nonlinear-regression">
     Second Order Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linearization-of-data">
     Linearization of Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-order-linearization">
       First Order Linearization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#if-time-allows-we-can-come-back-to-this-point">
     If Time Allows, we can come back to this point
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Kinetics III</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-01">
   Example Problem 01
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-to-example-problem-01">
     Solution to Example Problem 01
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#differential-analysis">
     Differential Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integral-analysis-with-nonlinear-regression">
     Integral Analysis with nonlinear Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-order-solution">
       First Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#second-order-solution">
       Second Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#third-order-solution">
       Third Order Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary-of-integrated-models">
       Summary of integrated models
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nonlinear-least-squares">
     Nonlinear Least Squares
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-order-nonlinear-regression">
     First Order Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#second-order-nonlinear-regression">
     Second Order Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linearization-of-data">
     Linearization of Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#first-order-linearization">
       First Order Linearization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#if-time-allows-we-can-come-back-to-this-point">
     If Time Allows, we can come back to this point
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="kinetics-iii">
<h1>Kinetics III<a class="headerlink" href="#kinetics-iii" title="Permalink to this headline">#</a></h1>
<p>We continue kinetic analysis.  Now that we have a basic understanding of the methods (least squares minimization, linearization, linear regression, etc.), we will work through noisy data (i.e., real data) obtained in a constant volume batch reactor.  We introduce a few tools for managing noisy data, and we consider the method of excess. We’ll also develop some metrics that complement the sum of squares in helping us to understand goodness of fit; these include the coefficient of determination (R<sup>2</sup>) and confidence intervals on parameter estimates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<section id="example-problem-01">
<h2>Example Problem 01<a class="headerlink" href="#example-problem-01" title="Permalink to this headline">#</a></h2>
<p><strong>Analysis of “Real” Data Collected in a Constant Volume Batch Reactor.</strong></p>
<p>The following reaction is carried out in a well-mixed, constant volume batch reactor. The concentration of species A and B in the tank are initially 0.05M and 0.5M, respectively. The fluid inside of the reactor has constant density.</p>
<div class="math notranslate nohighlight">
\[A + B \longrightarrow C\]</div>
<p>You measure the concentration of species A in this reactor, monitoring how it changes with time.  The data you collect are given in the table below.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><strong>time (min)</strong></p></th>
<th class="text-align:center head"><p><strong>C<span class="math notranslate nohighlight">\(_A\)</span> <span class="math notranslate nohighlight">\(\times 10^{2}\)</span> (mol/L)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>4.81</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>25</p></td>
<td class="text-align:center"><p>4.52</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>50</p></td>
<td class="text-align:center"><p>3.86</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>75</p></td>
<td class="text-align:center"><p>3.30</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>100</p></td>
<td class="text-align:center"><p>3.21</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>125</p></td>
<td class="text-align:center"><p>2.73</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>150</p></td>
<td class="text-align:center"><p>2.53</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>175</p></td>
<td class="text-align:center"><p>2.43</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>200</p></td>
<td class="text-align:center"><p>2.31</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>225</p></td>
<td class="text-align:center"><p>2.01</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>250</p></td>
<td class="text-align:center"><p>1.96</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>275</p></td>
<td class="text-align:center"><p>1.88</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>300</p></td>
<td class="text-align:center"><p>1.70</p></td>
</tr>
</tbody>
</table>
<p>Assuming the rate law is described by power law kinetics,</p>
<div class="math notranslate nohighlight">
\[r = kC_A^{\alpha}C_B^{\beta}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is an integer and <span class="math notranslate nohighlight">\(\beta = 1\)</span>, determine the reaction order in A and the rate constant for this reaction.</p>
<section id="solution-to-example-problem-01">
<h3>Solution to Example Problem 01<a class="headerlink" href="#solution-to-example-problem-01" title="Permalink to this headline">#</a></h3>
<p>Before we start, it’s important to point out something about regression and parameter estimation.  Here, we are looking for the order with respect to species A.  If we’re trying to extract that order from data, this is easiest to do if we’ve performed an experiment where we are only varying the concentration of species A and watching how the system responds.  In a batch reactor, this is tricky because the concentration of species A and species B will both generally change as a function of time since both species are reactants.</p>
<p>The way we usually handle this is by performing the experiment in such a way that the only the concentration of interest varies (in this case, species A) while the other remains fixed.  A common way to do this is using the <em><strong>method of excess</strong></em>. This  entails having one reactant present in a large excess so that its concentration does not significantly change over the course of the experiment.  Here, that is done with species B. It’s initial concentration is 0.5M, whereas the initial concentration of A is 0.05M.  Clearly, A is the limiting reactant, and if we convert 100% of A, we would only decrease the concentration of species B by 10% to 0.45M.  This is typical of method of excess. The change in concentration of species B over the course of the experiment is insignificant compared to the change in concentration of species A.  This allows us to extract the dependence on species A from our data.</p>
<p>In this case, we start with the following general rate expression:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_B}^\beta\]</div>
<p>We know that <span class="math notranslate nohighlight">\(\beta\)</span> = 1, so:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_B}\]</div>
<p>Since in this experiment <span class="math notranslate nohighlight">\(C_B \approx C_{B0}\)</span>:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_{B0}}\]</div>
<p>Since <span class="math notranslate nohighlight">\(C_{B0}\)</span> is constant, we lump it it with the rate constant to get:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime{C_A}^\alpha\]</div>
<p>i.e., a rate expression that only depends on the concentration of A.  We just have to recall that the rate constate we estimate from this model, <span class="math notranslate nohighlight">\(k^\prime\)</span> is actually defined as:</p>
<div class="math notranslate nohighlight">
\[k^\prime = kC_{B0}\]</div>
<p>So if we want to get the true rate constant, <span class="math notranslate nohighlight">\(k\)</span>, we have to account for that dependence in the lumped constant in our final analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
<span class="n">CAdata</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                
<span class="c1">#Concentrations in moles per liter</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Noisy data for A + B --&gt; C&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_4_0.png" src="../_images/587-L30_4_0.png" />
</div>
</div>
<p>Now we attempt to extract the rate constant, k, and reaction order in A, <span class="math notranslate nohighlight">\(\alpha\)</span>, from our experimental data. We are working with a power law model based on a lumped rate constant:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime{C_A}^\alpha\]</div>
<p>For a constant volume batch reactor, the balance on species A is therefore:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime{C_A}^\alpha\]</div>
<p>We have options as usual.  Let’s start with a differential analysis and then go to an integral analysis.</p>
</section>
<section id="differential-analysis">
<h3>Differential Analysis<a class="headerlink" href="#differential-analysis" title="Permalink to this headline">#</a></h3>
<p>The beauty of the differential analysis is that I can use it to estimate the reaction order when I really don’t know one.  We know that it can introduce some imprecision because of limitations in finite difference approximations, but it is a useful way to start an analysis.  So let’s go ahead and approximate the derivative in the above material balance using a forward difference method.</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt}\bigg|_{C_{A_n}} \approx \frac{C_{A_{n+1}} - C_{A_{n}}}{t_{n+1} - t_n}\]</div>
<p>With that, we would have a set of reaction rates at a corresponding set of CA values, and so we can consider how rate scales with concentration:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha\]</div>
<p>Which can be linearized using logarithms:</p>
<div class="math notranslate nohighlight">
\[\ln(r) = \ln(k) + \alpha \ln(C_A)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DCA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">Dt</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">DCADT</span> <span class="o">=</span> <span class="n">DCA</span><span class="o">/</span><span class="n">Dt</span>
<span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">DCADT</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.16e-04 2.64e-04 2.24e-04 3.60e-05 1.92e-04 8.00e-05 4.00e-05 4.80e-05
 1.20e-04 2.00e-05 3.20e-05 7.20e-05]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12
</pre></div>
</div>
</div>
</div>
<p>Recall that we have to use two data points to estimate a derivative, so our set of 13 measurments gives us 12 estimated derivatives using a forward difference method only.</p>
<p>Now let’s plot those rates against the corresponding concentrations on logarithmic axes to get a sense of the reaction order…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(rate (mol/L/min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_9_0.png" src="../_images/587-L30_9_0.png" />
</div>
</div>
<p>Yikes!  Let’s see what linear regression gets us in terms of the reaction order and rate constant…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;α = </span><span class="si">{</span><span class="n">order</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">, k = </span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(rate (mol/L/min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>α = 1.75, k = 0.040
</pre></div>
</div>
<img alt="../_images/587-L30_11_1.png" src="../_images/587-L30_11_1.png" />
<img alt="../_images/587-L30_11_2.png" src="../_images/587-L30_11_2.png" />
</div>
</div>
<p>Clearly, that is a <em>rough</em> fit.  It suggests that my reaction order is 1.75 and that the rate constant is 0.04…but the data is all over the place. Let’s add a bit more quantitative information information to this.  One thing that might be useful to us is knowing the residual sum of squares for this fit.  We have already seen how to calculate residual sum of squares in L29 and R10:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i \left(y_i - \hat{y}_i\right)^2\]</div>
<p>As with many Python tools, <code class="docutils literal notranslate"><span class="pre">np.polyfit()</span></code> is more fully featured than the default usage we implemented above.  If we request full output, it will return the minimum sum of squares (among other things).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;α = </span><span class="si">{</span><span class="n">order</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">, k = </span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, Minimum SSE = </span><span class="si">{</span><span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, ydata, marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.plot(xdata, np.polyval(A, xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;ln(CA (M))&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;ln(rate (mol/L/min))&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.5, -2.5)</span>
<span class="c1"># plt.xticks(np.arange(-4.5, -2.49, 0.5))</span>
<span class="c1"># plt.minorticks_on()</span>
<span class="c1"># plt.ylim(-11, -8)</span>
<span class="c1"># plt.show()</span>

<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, (ydata - np.polyval(A, xdata)), marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.hlines(0, min(xdata), max(xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;CA&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;Residual)&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.0, -3.0)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>α = 1.75, k = 0.040, Minimum SSE = 4.19
</pre></div>
</div>
</div>
</div>
<p>One issue with the Residual Sum of Squares as presented here is that it is an “extensive” quantity of sorts: it will generally get larger as a) we make more measurements and b) we measure larger quantities.  So the absolute value of SSE is hard to interpret.  Some complementary metrics include the Mean Square Error (MSE), which captures the average error in an individual measurement:</p>
<div class="math notranslate nohighlight">
\[MSE = \frac{1}{N}\sum_i(y_i - \hat{y}_i)^2\]</div>
<p>The MSE still will depend on the size of measurements that we are making, but it at least is normalized to an individual measurement. If we take the square root of the MSE, then we have the root mean square error, which gives us an estimate of the average absolute error in each measurement; it is also dependent on the size of the measurement that we are making, but it is informative as to goodness of fit as it is relatively easy to relate it to the magnitude of the measurements.</p>
<div class="math notranslate nohighlight">
\[RMSE = \sqrt{\frac{1}{N}\sum_i(y_i - \hat{y}_i)^2}\]</div>
<p>A similar concept is the Mean Absolute Error, which gives us a sense of average displacement between the model and the measurements. MAE is defined as:</p>
<div class="math notranslate nohighlight">
\[MAE = \frac{1}{N}\sum_i |y_i - \hat{y}_i|\]</div>
<p>Another thing of interest would be the coefficient of determination (<span class="math notranslate nohighlight">\(R^2\)</span>), which is intensive in that it conveys the same information (goodness of fit) no matter how many measurements we take or how large (or small) those measurements are.  Most of us are used to getting an <span class="math notranslate nohighlight">\(R^2\)</span> directly alongside a trendline in Excel; they are straightforward to calculate. The general formula for the coefficient of determination is:</p>
<div class="math notranslate nohighlight">
\[R^2 = 1 - \frac{\textrm{SSE}}{\textrm{SST}}\]</div>
<p>We calculate the residual sum of squares (SSE) using the standard formula:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i \left(y_i - \hat{y}_i\right)^2\]</div>
<p>The total sum of squares (SST) is a related metric that evaluates the amount of error between the measured values and the mean of the measured values:</p>
<div class="math notranslate nohighlight">
\[SST = \sum_i \left(y_i - \bar{y}\right)^2\]</div>
<p>In the expressions above, <span class="math notranslate nohighlight">\(\hat{y}_i\)</span> is the model prediction for the observable <span class="math notranslate nohighlight">\(y\)</span> at condition <span class="math notranslate nohighlight">\(t_i\)</span>.  <span class="math notranslate nohighlight">\(\bar{y}\)</span> is the mean of all measured values for the observable <span class="math notranslate nohighlight">\(y\)</span>.</p>
<p>Now that we have these definitions, let’s go ahead and add the MSE and Coefficient of Determination to our output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">α</span>     <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, ydata, marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.plot(xdata, np.polyval(A, xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;ln(CA (M))&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;ln(rate (mol/L/min))&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.5, -2.5)</span>
<span class="c1"># plt.xticks(np.arange(-4.5, -2.49, 0.5))</span>
<span class="c1"># plt.minorticks_on()</span>
<span class="c1"># plt.ylim(-11, -8)</span>
<span class="c1"># plt.show()</span>

<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, (ydata - np.polyval(A, xdata)), marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.hlines(0, min(xdata), max(xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;CA&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;Residual)&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.0, -3.0)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k    = 0.04
α    = 1.75
SSE  = 4.19
MSE  = 0.35
RMSE = 0.59
MAE  = 0.53
R2   = 0.45
</pre></div>
</div>
</div>
</div>
<p>There is one more useful piece of information we can get out of the linear regression routine from polyfit – we can use it to estimate the confidence intervals on the parameters that we have estimated (<span class="math notranslate nohighlight">\(\alpha\)</span>, and k).  Confidence intervals give us a sense of how much we trust the parameters that we have estracted from the data. You may recall the calculation of confidence intervals from your statistics course.  The first step is to caculate the standard error in the slope and intercept of our regression – this requires us to estimate the covariance matrix.</p>
<p>The standard error in our regressed parameters is given by the diagonal elements in the covariance matrix:</p>
<div class="math notranslate nohighlight">
\[se = \sqrt{COV}\]</div>
<p>Noting that this may throw a warning if off-diagonal elements of the covariance matrix are negative. From that, we get the standard error in the slope from se[0,0] and the standard error in the intercept from se[1,1], i.e., the diagonal elements.</p>
<p>If you want to calculate confidence intervals, they are given by:</p>
<div class="math notranslate nohighlight">
\[CI = t(q, DOF)\times SE\]</div>
<p><code class="docutils literal notranslate"><span class="pre">np.polyfit()</span></code> will return the Covariance matrix if we request it (though we have to turn off full output.  See below; we now generate a covariance matrix and use it to get confidence intervals on the parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">COV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">α</span>     <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>
<span class="n">DOF</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">SEm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">SEb</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">tval</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIm</span>   <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>
<span class="n">CIb</span>   <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>
<span class="n">llb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CIb</span>
<span class="n">ulb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CIb</span>
<span class="n">kll</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">llb</span><span class="p">)</span>
<span class="n">kul</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ulb</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">kll</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">kul</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> but I</span><span class="se">\&#39;</span><span class="s1">m sure it is </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;α&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, ydata, marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.plot(xdata, np.polyval(A, xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;ln(CA (M))&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;ln(rate (mol/L/min))&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.5, -2.5)</span>
<span class="c1"># plt.xticks(np.arange(-4.5, -2.49, 0.5))</span>
<span class="c1"># plt.minorticks_on()</span>
<span class="c1"># plt.ylim(-11, -8)</span>
<span class="c1"># plt.show()</span>

<span class="c1"># plt.figure(1, figsize = (5, 5))</span>
<span class="c1"># plt.scatter(xdata, (ydata - np.polyval(A, xdata)), marker = &#39;s&#39;, color = &#39;none&#39;, edgecolor = &#39;black&#39;, label = &#39;CA&#39;)</span>
<span class="c1"># plt.hlines(0, min(xdata), max(xdata), color = &#39;black&#39;, linestyle = &#39;dashed&#39;)</span>
<span class="c1"># plt.xlabel(&#39;CA&#39;, fontsize = 12)</span>
<span class="c1"># plt.ylabel(&#39;Residual)&#39;, fontsize = 12)</span>
<span class="c1"># plt.xlim(-4.0, -3.0)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k is between 3.12E-04 and 5.11 but I&#39;m sure it is 0.04...
α    = 1.75 +/- 1.35
SSE  = 4.19
MSE  = 0.35
RMSE = 0.59
MAE  = 0.53
R2   = 0.45
</pre></div>
</div>
</div>
</div>
<p>This is terrible!!!</p>
<p>What’s going on here?  As we saw in L28, taking finite differences introduces imprecision even in perfect data.  Here, we have real (well, simulated real) data, where there is actual uncertainty and noise in the measurements. Sometimes our measurements are higher or lower than the “true” value at that time, and this compounds the uncertainty in the approximation that derivatives are constant when we use finite difference approximations.</p>
<p>Still, a differential analysis can be very useful…we can do a little better if we smooth the data before we estimate the derivative of that data.  One way that we can do that by fitting a polynomial to the data set.  We have to recognize that this polynomial fit is meaningless in a physical sense, it is just a way for us to develop a continuous, well-behaved function that empirically captures how concentration decreases with time.  Once we have that, we can take the true derivative of the polynomial (not a finite difference of data), and we can use that to estimate rate of reaction and thus reaction orders.  First, we fit the polynomial.  I’ll use polyfit here because it makes it easy to adjust the order of the fit and display the results.  Note that this below is mimicing what you’d get by “increasing polynomial order” in an Excel trendline.</p>
<p>I find a third order polynomial does a good job of smoothing out the trend without fitting the noise, so we’ll use that to provide a polynomial approximation of how concentration changes with time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
<span class="n">CAdata</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                
<span class="c1">#Concentrations in moles per liter</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (mol/L)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_19_0.png" src="../_images/587-L30_19_0.png" />
</div>
</div>
<p>Numpy has some nice tools that allow us to take the derivative of a polynomial once we’ve generated it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derivatives</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rate_estimates</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">derivatives</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have estimated the rates by taking a derivative of the polynomial approximation, let’s try our linearization and regression again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rate_estimates</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>

<span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">COV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">α</span>     <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>
<span class="n">DOF</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">SEm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">SEb</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">tval</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIm</span>   <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>
<span class="n">CIb</span>   <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>
<span class="n">llb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CIb</span>
<span class="n">ulb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CIb</span>
<span class="n">kll</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">llb</span><span class="p">)</span>
<span class="n">kul</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ulb</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">kll</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">kul</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> but I</span><span class="se">\&#39;</span><span class="s1">m sure it is </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;α&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(rate (mol/L/min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k is between 2.45E-02 and 0.10 but I&#39;m sure it is 0.05...
α    = 1.75 +/- 0.20
SSE  = 0.12
MSE  = 0.01
RMSE = 0.10
MAE  = 0.08
R2   = 0.97
</pre></div>
</div>
<img alt="../_images/587-L30_23_1.png" src="../_images/587-L30_23_1.png" />
<img alt="../_images/587-L30_23_2.png" src="../_images/587-L30_23_2.png" />
</div>
</div>
<p>OK, so, the take home: the estimates of our order and rate constant didn’t change much but their precision did improve, which greatly increases my confidence. It is easier to accept the trend we see here because the fit is so much better.  Based on that and the confidence intervals, we find that the reaction order estimate is:</p>
<div class="math notranslate nohighlight">
\[\alpha = 1.8 \pm 0.2\]</div>
<p>If we’re restricting to integer orders, I’m going to guess these are probably second order kinetics, but let’s work through an integral analysis and see if that bears out.</p>
<p>Based on this approach, the rate constant is obtained from the y-intercept, and we get a value of:</p>
<p><span class="math notranslate nohighlight">\(k^\prime = 0.05\)</span></p>
<p>But the confidence intervals are such that it probably is somewhere between 0.02 and 0.1 L/mol/min.</p>
</section>
<section id="integral-analysis-with-nonlinear-regression">
<h3>Integral Analysis with nonlinear Regression<a class="headerlink" href="#integral-analysis-with-nonlinear-regression" title="Permalink to this headline">#</a></h3>
<p>We’ll start with the balance</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime{C_A}^\alpha\]</div>
<p>And we’ll guess integer orders for <span class="math notranslate nohighlight">\(\alpha\)</span> and see what shakes out.  I’m going to try <span class="math notranslate nohighlight">\(\alpha\)</span> = 1, 2, and 3 in this example.</p>
<section id="first-order-solution">
<h4>First Order Solution<a class="headerlink" href="#first-order-solution" title="Permalink to this headline">#</a></h4>
<p>For a first order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime C_A\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{C_A}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[C_A = C_{A0}\exp\left(-k^\prime t\right)\]</div>
</section>
<section id="second-order-solution">
<h4>Second Order Solution<a class="headerlink" href="#second-order-solution" title="Permalink to this headline">#</a></h4>
<p>For a second order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime {C_A}^2\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^2}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\]</div>
<p>We can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{C_{A0}} + k^\prime t\right)^{-1}\]</div>
</section>
<section id="third-order-solution">
<h4>Third Order Solution<a class="headerlink" href="#third-order-solution" title="Permalink to this headline">#</a></h4>
<p>For a third order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime {C_A}^3\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^3}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{{C_A}^2} = \frac{1}{{C_{A0}}^2} + 2k^\prime t\]</div>
<p>We can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{{C_{A0}}^2} + 2k^\prime t\right)^{-\frac{1}{2}}\]</div>
</section>
<section id="summary-of-integrated-models">
<h4>Summary of integrated models<a class="headerlink" href="#summary-of-integrated-models" title="Permalink to this headline">#</a></h4>
<p>To summarize, we have 3 models to compare to our data:</p>
<p><strong>First Order</strong>: <span class="math notranslate nohighlight">\(C_A = C_{A0}\exp\left(-k^\prime t\right)\)</span></p>
<p><strong>Second Order</strong>: <span class="math notranslate nohighlight">\(\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\)</span></p>
<p><strong>Third Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{{C_{A0}}^2} + 2k^\prime t\right)^{-\frac{1}{2}}\)</span></p>
<p>Now let’s overlay those models with our data and run an optimization (nonlinear least squares) to find the best value of the lumped rate constant.  Then, we’ll take a look at how well the model fits our data.</p>
</section>
</section>
<section id="nonlinear-least-squares">
<h3>Nonlinear Least Squares<a class="headerlink" href="#nonlinear-least-squares" title="Permalink to this headline">#</a></h3>
<p>As we considered in L29, the mathematically rigorous way to find the best value of the rate constant is to find the one that gives the “line of best fit” by minimizing the residual sum of squares:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i \left(y_i - \hat{y}_i\right)^2\]</div>
<p>Mean square error is defined as:</p>
<div class="math notranslate nohighlight">
\[MSE = \frac{1}{N}\sum_i (y_i - \hat{y}_i)^2\]</div>
<p>It allows us to normalize error to the number of measurments made. The root mean square is defined as:</p>
<div class="math notranslate nohighlight">
\[RMSE = \sqrt{\frac{1}{N}\sum_i (y_i - \hat{y}_i)^2}\]</div>
<p>And the Mean Absolute Error is defined as:</p>
<div class="math notranslate nohighlight">
\[MAE = \frac{1}{N}\sum_i |y_i - \hat{y}_i|\]</div>
<p>In addition to the SSE, we can also calculate the total sum of squares:</p>
<div class="math notranslate nohighlight">
\[SST = \sum_i \left(y_i - \bar{y}_i\right)^2\]</div>
<p>This can be used to get a coefficient of determination:</p>
<div class="math notranslate nohighlight">
\[R^2 = 1 - \frac{SSE}{SST}\]</div>
<p>If you want to obtain estimates of standard error in the slope and y intercept that you regress, you need to estimate the covariance matrix.  First, we estimate the variance, <span class="math notranslate nohighlight">\(\sigma^2\)</span> with the following:</p>
<div class="math notranslate nohighlight">
\[\sigma^2 \approx s^2\]</div>
<p>and:</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{n_m - n_p}\]</div>
<p>Where <span class="math notranslate nohighlight">\(n_m\)</span> is the number of measurements and <span class="math notranslate nohighlight">\(n_p\)</span> is the number of regressed parameters.  This is also known as the “degrees of freedom” in our regression.</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{DOF}\]</div>
<p>With that, we can estimate the covariance matrix from the Jacobian Matrix:</p>
<div class="math notranslate nohighlight">
\[COV = s^2(J'J)^{-1}\]</div>
<p>The standard error in our regressed parameters is given by the diagonal elements in the following matrix:</p>
<div class="math notranslate nohighlight">
\[se = \sqrt{COV}\]</div>
<p>Noting that this may throw a warning if off-diagonal elements of the covariance matrix are negative.</p>
<p>From that, we get the standard error in the slope from se[0,0] and the standard error in the intercept from se[1,1], i.e., the diagonal elements.</p>
<p>If you want to calculate confidence intervals, they are given by:</p>
<div class="math notranslate nohighlight">
\[CI = t(q, DOF)\times SE\]</div>
</section>
<section id="first-order-nonlinear-regression">
<h3>First Order Nonlinear Regression<a class="headerlink" href="#first-order-nonlinear-regression" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OBJONE</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>     <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">CAFIRST</span> <span class="o">=</span> <span class="n">CA0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">tDATA</span><span class="p">)</span>
    <span class="n">RESID</span>   <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CAFIRST</span>
    <span class="n">SSE</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span> <span class="nf">JACONE</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>     <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">JAC</span>     <span class="o">=</span> <span class="o">-</span><span class="n">CA0</span><span class="o">*</span><span class="n">tdata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">tDATA</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ans1</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJONE</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Brent&#39;</span><span class="p">,</span> <span class="n">bracket</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
<span class="n">SSE1</span> <span class="o">=</span> <span class="n">ans1</span><span class="o">.</span><span class="n">fun</span>
<span class="n">k1</span>   <span class="o">=</span> <span class="n">ans1</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#Calculate result for best fit first order model</span>
<span class="n">tsmooth</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">CA0</span>       <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
<span class="n">CAPRED1</span>   <span class="o">=</span> <span class="n">CA0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">CMOD1</span>     <span class="o">=</span> <span class="n">CA0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">tsmooth</span><span class="p">)</span>
<span class="n">JAC1</span>      <span class="o">=</span> <span class="n">JACONE</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>

<span class="n">Ndata</span>      <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">MSE1</span>  <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE1</span><span class="p">)</span>
<span class="n">MAE1</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED1</span><span class="p">))</span>
<span class="n">COV1</span>        <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC1</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC1</span><span class="p">)</span>
<span class="n">SEk1</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV1</span><span class="p">)</span> 
<span class="n">tval</span>       <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk1</span>        <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk1</span>

<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST1</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R21</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ans_first</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SSE1</span><span class="p">,</span> <span class="n">MSE1</span><span class="p">,</span> <span class="n">RMSE1</span><span class="p">,</span> <span class="n">MAE1</span><span class="p">,</span> <span class="n">R21</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#Overlay best fit model with data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;First order nonlinear regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED1</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for First order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">~\AppData\Local\Temp\ipykernel_5040\3841581823.py</span> in <span class="ni">&lt;cell line: 26&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="n">R21</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST1</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> 
<span class="ne">---&gt; </span><span class="mi">26</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ans_first</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> 
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;ans_first&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Now we have some quantitative assessments of goodness of fit.  For real data, an <span class="math notranslate nohighlight">\(R^2\)</span> of 0.96 or so is pretty good, so for the moment, we’ll call this an acceptable fit.</p>
</section>
<section id="second-order-nonlinear-regression">
<h3>Second Order Nonlinear Regression<a class="headerlink" href="#second-order-nonlinear-regression" title="Permalink to this headline">#</a></h3>
<p>Now let’s see how a second order model fits the data.  We’ll go ahead and regress the best fit rate constant, plot the result, and calculate some basic statistical data about goodness of fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OBJTWO</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>      <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">CASECOND</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">tDATA</span><span class="p">)</span>
    <span class="n">RESID</span>    <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CASECOND</span>
    <span class="n">SSE</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span> <span class="nf">JACTWO</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>     <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">JAC</span>     <span class="o">=</span> <span class="o">-</span><span class="n">tdata</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ans2</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTWO</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Brent&#39;</span><span class="p">,</span> <span class="n">bracket</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
<span class="n">SSE2</span> <span class="o">=</span> <span class="n">ans2</span><span class="o">.</span><span class="n">fun</span>
<span class="n">k2</span>   <span class="o">=</span> <span class="n">ans2</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#Calculate result for best fit first order model</span>
<span class="n">tsmooth</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">CA0</span>       <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
<span class="n">CAPRED2</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">CMOD2</span>     <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">tsmooth</span><span class="p">)</span>
<span class="n">JAC2</span>      <span class="o">=</span> <span class="n">JACTWO</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>

<span class="n">Ndata</span>      <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">MSE2</span>  <span class="o">=</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE2</span><span class="p">)</span>
<span class="n">MAE2</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED2</span><span class="p">))</span>
<span class="n">COV2</span>        <span class="o">=</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC2</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC2</span><span class="p">)</span>
<span class="n">SEk2</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV2</span><span class="p">)</span> 
<span class="n">tval</span>       <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk2</span>        <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk2</span>

<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST2</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R22</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">SST2</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ans2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SSE2</span><span class="p">,</span> <span class="n">MSE2</span><span class="p">,</span> <span class="n">RMSE2</span><span class="p">,</span> <span class="n">MAE2</span><span class="p">,</span> <span class="n">R22</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk2</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#Overlay best fit model with data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Second Order Nonlinear Regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED2</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for Second Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      fun: 1.3014231460548578e-05
    nfev: 17
     nit: 11
 success: True
       x: 0.12389199399645329 

k    = 1.24E-01 +/- 7.16E-03
α    = 2.00E+00
SSE  = 1.30E-05
MSE  = 1.00E-06
RMSE = 1.00E-03
MAE  = 8.29E-04
R2   = 9.89E-01
</pre></div>
</div>
<img alt="../_images/587-L30_31_1.png" src="../_images/587-L30_31_1.png" />
<img alt="../_images/587-L30_31_2.png" src="../_images/587-L30_31_2.png" />
</div>
</div>
<p>OK, by all metrics–visual, SSE, and <span class="math notranslate nohighlight">\(R^2\)</span>, the second order model improves on the first order model.  Is it the best?  It’s hard to say for sure…let’s try the third order model and see how that goes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OBJTHREE</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>      <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">CATHIRD</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">tDATA</span><span class="p">))</span>
    <span class="n">RESID</span>    <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CATHIRD</span>
    <span class="n">SSE</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span> <span class="nf">JACTHREE</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">CA0</span>     <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
    <span class="n">tDATA</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
    <span class="n">CADATA</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span>                    
    <span class="n">JAC</span>     <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">tdata</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">tdata</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ans3</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTHREE</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Brent&#39;</span><span class="p">,</span> <span class="n">bracket</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
<span class="n">SSE3</span> <span class="o">=</span> <span class="n">ans3</span><span class="o">.</span><span class="n">fun</span>
<span class="n">k3</span>   <span class="o">=</span> <span class="n">ans3</span><span class="o">.</span><span class="n">x</span>

<span class="c1">#Calculate result for best fit first order model</span>
<span class="n">tsmooth</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">CA0</span>       <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>
<span class="n">CAPRED3</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">CMOD3</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">tsmooth</span><span class="p">))</span>
<span class="n">JAC3</span>      <span class="o">=</span> <span class="n">JACTHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">)</span>

<span class="n">Ndata</span>      <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">MSE3</span>  <span class="o">=</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE3</span><span class="p">)</span>
<span class="n">MAE3</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED3</span><span class="p">))</span>
<span class="n">COV3</span>        <span class="o">=</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC3</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC3</span><span class="p">)</span>
<span class="n">SEk3</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV3</span><span class="p">)</span> 
<span class="n">tval</span>       <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk3</span>        <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk3</span>

<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST3</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R23</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">SST3</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ans3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SSE3</span><span class="p">,</span> <span class="n">MSE3</span><span class="p">,</span> <span class="n">RMSE3</span><span class="p">,</span> <span class="n">MAE3</span><span class="p">,</span> <span class="n">R23</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk3</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#Overlay best fit model with data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Third Order Nonlinear Regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="c1"># plt.xticks(np.arange(-4.5, -2.49, 0.5))</span>
<span class="c1"># plt.minorticks_on()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPRED3</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for Third Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="c1"># plt.xticks(np.arange(-4.5, -2.49, 0.5))</span>
<span class="c1"># plt.minorticks_on()</span>
<span class="c1">#plt.ylim(0, 0.06)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      fun: 4.6162100913375796e-05
    nfev: 22
     nit: 9
 success: True
       x: 3.6669266010142807 

k    = 3.67E+00 +/- 5.10E-01
α    = 3.00E+00
SSE  = 4.62E-05
MSE  = 3.55E-06
RMSE = 1.88E-03
MAE  = 1.52E-03
R2   = 9.63E-01
</pre></div>
</div>
<img alt="../_images/587-L30_34_1.png" src="../_images/587-L30_34_1.png" />
<img alt="../_images/587-L30_34_2.png" src="../_images/587-L30_34_2.png" />
</div>
</div>
<p>Alright…looks like we’ve gone a little too far.  The third order model is slightly better than the first order model and slightly worse than the second order model.  Any of them probably do an OK job of fitting the data, but quantitatively, the second order model is probably just a bit better.</p>
<p>As we discussed during Lecture 29, it can be really hard to tell whether or not a model is “correct” just by visual inspection.  All of the above, in isolation, seem to fit the data prett well. We’ll overlay all three where you can start to see that the second order model does the best.  Then, we’ll look at linearized models if we can to see if we can see some deviation from linearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Overlay best fit models with data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD1</span><span class="p">,</span>  <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>  <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;First Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Second Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">CMOD3</span><span class="p">,</span>  <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>   <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Third Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_36_0.png" src="../_images/587-L30_36_0.png" />
</div>
</div>
</section>
<section id="linearization-of-data">
<h3>Linearization of Data<a class="headerlink" href="#linearization-of-data" title="Permalink to this headline">#</a></h3>
<section id="first-order-linearization">
<h4>First Order Linearization<a class="headerlink" href="#first-order-linearization" title="Permalink to this headline">#</a></h4>
<p>For the first order model, we have:</p>
<div class="math notranslate nohighlight">
\[C_A = C_{A0}\exp(-k^\prime t)\]</div>
<p>This is a nonlinear function of, essentially kt; however, if we take the natural logarithm of both sides, we convert it to the following, which is much more useful:</p>
<div class="math notranslate nohighlight">
\[\ln\left(C_A\right) = \ln\left(C_{A0}\right) - k^\prime t\]</div>
<p>If we plot <span class="math notranslate nohighlight">\(C_A\)</span> against time, that should be linear if the first order model is correct.  The slope would be equal to -k, and the y-intercept would be ln(CA0).</p>
<p>This is plotted in the cell below, where you observe linearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;First Order Linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_38_0.png" src="../_images/587-L30_38_0.png" />
</div>
</div>
<p>It looks pretty linear in isolation, but if we regress the line of best fit, we start to see systematic deviations; we’ll use <code class="docutils literal notranslate"><span class="pre">np.polyfit()</span></code> and also calculate all of the relevant meta statistical information.  It’s a little more convenient here because you can automate some of the calculations, and it will also return things like the minimum SSE (this is enabled by switching the option full to True).  I’ll use the SSE and SST to calculate the R2 for this fit.  Note that SST is going to be based on <span class="math notranslate nohighlight">\(\ln(CA)\)</span> and the mean value of <span class="math notranslate nohighlight">\(\ln(CA)\)</span> for this linearized model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">COV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">CAs</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>
<span class="n">DOF</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">SEm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">SEb</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">tval</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIm</span>   <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>
<span class="n">CIb</span>   <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>
<span class="n">llb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CIb</span>
<span class="n">ulb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CIb</span>
<span class="n">Cll</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">llb</span><span class="p">)</span>
<span class="n">Cul</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ulb</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;CAs&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">CAs</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;CAs&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">Cll</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">Cul</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> with a regressed value of </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;First Order Linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln (CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for First order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k    = 3.43E-03 +/- 3.63E-04
CAs is between 4.26E-02 and 4.84E-02 with a regressed value of 4.54E-02...
SSE  = 0.03
MSE  = 0.00
RMSE = 0.05
MAE  = 0.04
R2   = 0.98
</pre></div>
</div>
<img alt="../_images/587-L30_40_1.png" src="../_images/587-L30_40_1.png" />
<img alt="../_images/587-L30_40_2.png" src="../_images/587-L30_40_2.png" />
</div>
</div>
<p><strong>Second Order Model</strong></p>
<p>For the second order model, we have:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + kt\]</div>
<p>We should see linearity here if we plot <span class="math notranslate nohighlight">\(\frac{1}{C_A}\)</span> vs <span class="math notranslate nohighlight">\(t\)</span>.  See below; this model clearly shows less deviation from linearity than the first order linearization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;second order linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1/CA (M^-1)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_42_0.png" src="../_images/587-L30_42_0.png" />
</div>
</div>
<p>Below, I regress the coefficients for the linearized second order model using polyfit and overlay it with the “linearized” data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span>
<span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">COV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k2</span>    <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">CAs</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>
<span class="n">DOF</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">SEm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">SEb</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">tval</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIm</span>   <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>
<span class="n">CIb</span>   <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>
<span class="n">llb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CIb</span>
<span class="n">ulb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CIb</span>
<span class="n">Cll</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">llb</span>
<span class="n">Cul</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">ulb</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;CAs&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">CAs</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;CAs&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">Cll</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">Cul</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> with a regressed value of </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Second Order Linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln (CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for Second order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k    = 1.26E-01 +/- 7.70E-03
CAs is between 5.39E-02 and 4.70E-02 with a regressed value of 5.02E-02...
SSE  = 15.30
MSE  = 1.18
RMSE = 1.08
MAE  = 1.00
R2   = 0.99
</pre></div>
</div>
<img alt="../_images/587-L30_44_1.png" src="../_images/587-L30_44_1.png" />
<img alt="../_images/587-L30_44_2.png" src="../_images/587-L30_44_2.png" />
</div>
</div>
<p>I like the second order fit!  I can see scatter around the line of best fit instead of a systematic deviation like in the first order model. Let’s check the third order linearization just to see if the second order model still looks better.</p>
<p>For the third order model, we have a slightly different linearization that is based on this form of the integrated model:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{{C_A}^2} = \frac{1}{{C_{A0}}^2} + 2k^\prime t\]</div>
<p>If we plot <span class="math notranslate nohighlight">\(\frac{1}{{C_A}^2}\)</span> vs time, we should see linearity if the third order model is correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ydata</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span><span class="o">**</span><span class="mi">2</span>
<span class="n">A</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">sing</span><span class="p">,</span> <span class="n">rcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">COV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">ypred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
<span class="n">SSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">k</span>     <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
<span class="n">CAs</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">MSE</span>   <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>
<span class="n">MAE</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">))</span>
<span class="n">ybar</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
<span class="n">SST</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">R2</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>
<span class="n">DOF</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">SEm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">SEb</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">tval</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIm</span>   <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span><span class="o">/</span><span class="mi">2</span>
<span class="n">CIb</span>   <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>
<span class="n">llb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CIb</span>
<span class="n">ulb</span>   <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">CIb</span>
<span class="n">Cll</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">llb</span><span class="p">)</span>
<span class="n">Cul</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ulb</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;CAs&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">CAs</span><span class="p">,</span> <span class="n">SSE</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">R2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;CAs&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">Cll</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">Cul</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> with a regressed value of </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Third Order Linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln (CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">ypred</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot for Third order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k    = 4.88E+00 +/- 5.84E-01
CAs is between NAN and 5.12E-02 with a regressed value of 7.55E-02...
SSE  = 351988.52
MSE  = 27076.04
RMSE = 164.55
MAE  = 123.52
R2   = 0.97
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\jqbon\AppData\Local\Temp\ipykernel_4548\3405713205.py:24: RuntimeWarning: invalid value encountered in sqrt
  Cll   = np.sqrt(1/llb)
</pre></div>
</div>
<img alt="../_images/587-L30_46_2.png" src="../_images/587-L30_46_2.png" />
<img alt="../_images/587-L30_46_3.png" src="../_images/587-L30_46_3.png" />
</div>
</div>
<p>From everything we’ve done to this point, I am fairly confident in concluding that our reaction is second order in species A, so our rate law is:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime {C_A}^2\]</div>
<p>Remember, way back when we started this problem, that we defined <span class="math notranslate nohighlight">\(k^\prime\)</span> as a lumped rate constant:</p>
<div class="math notranslate nohighlight">
\[k^\prime = kC_{B0}\]</div>
<p>We know that the starting concentration of B in this system was 0.5M, so we can calculate the true rate constant as:</p>
<div class="math notranslate nohighlight">
\[k = \frac{k^\prime}{C_{B0}}\]</div>
<p>And our final rate law is:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^2{C_B}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Our most precise estimate of the lumped rate constant is </span><span class="si">{</span><span class="n">k2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> L/mol/min&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The true rate constant is </span><span class="si">{</span><span class="n">k2</span><span class="o">/</span><span class="mf">0.5</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> L^2 mol^-2 min^-1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our most precise estimate of the lumped rate constant is 0.126 L/mol/min
The true rate constant is 0.251 L^2 mol^-2 min^-1
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="if-time-allows-we-can-come-back-to-this-point">
<h3>If Time Allows, we can come back to this point<a class="headerlink" href="#if-time-allows-we-can-come-back-to-this-point" title="Permalink to this headline">#</a></h3>
<p>Considering all of the analysis, the second order model seems to fit the data best.  Since we know that the initial value of <span class="math notranslate nohighlight">\(C_{A0}\)</span> is 0.05M, we can improve our precision on the rate constant estimation slightly by choosing to not regress the y-intercept.  We can do that by rearranging our linearization slightly:</p>
<p>Instead of working with:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\]</div>
<p>And plotting <span class="math notranslate nohighlight">\(\frac{1}{C_A}\)</span> vs. time, we will work with this form:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} - \frac{1}{C_{A0}} = k^\prime t\]</div>
<p>And we will plot <span class="math notranslate nohighlight">\(\frac{1}{C_A} - \frac{1}{C_{A0}}\)</span> vs time. Alternatively, you could work with this form; either should give you a linear model with a zero y intercept:</p>
<div class="math notranslate nohighlight">
\[\frac{(C_{A0} - C_A)}{C_{A0}C_A} = k^\prime t\]</div>
<p>I’ll use the first form to construct the matrix form of our linear least squares problem:</p>
<div class="math notranslate nohighlight">
\[\alpha_1t = \frac{1}{C_A} - \frac{1}{C_{A0}}\]</div>
<div class="math notranslate nohighlight">
\[XA = Y\]</div>
<p>Where X is a vandermonde matrix created from tdata; however, we only keep the first order powers of time here (since there is no zero order coefficient in the model).  Y, in this case, is <span class="math notranslate nohighlight">\(\frac{1}{C_A} - \frac{1}{C_{A0}}\)</span>, and A is only a single coefficient, namely the slope of the line.  See below for implementation.  We can’t use polyfit here, but if we know how to work with the vandermonde matrix, we have a lot of flexibility in regressions.  This is similar to what you can do with the LINEST function in Excel.</p>
<p>We’ll leave the discussion of calculating standard error and confidence intervals for another day (or maybe explore sklearn utilities a bit).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#I&#39;m reshaping to make a 2D column instead of a 1D array; I have to do this to get dimensions correct for matrix product below</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">CA0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">A</span><span class="o">*</span><span class="n">tsmooth</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;second order linearization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1/(CA)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Our most precise estimate of the lumped rate constant is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> inverse minutes&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The true rate constant is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">0.5</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> M^-1 min^-1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L30_50_0.png" src="../_images/587-L30_50_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our most precise estimate of the lumped rate constant is 0.125 inverse minutes
The true rate constant is 0.250 M^-1 min^-1
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="587-L29.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Kinetics II</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="587-L31.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Kinetics IV</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jesse Q. Bond, Syracuse University<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>