

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>ODE Solvers &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Supplements/587-S14';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="../_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1.html">Python Supplements</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="587-S01.html">The Basics</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2.html">Lectures</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Lectures/587-L01.html">Introduction and Stoichiometry</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/CEN587/main?urlpath=tree/Supplements/587-S14.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/CEN587" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/CEN587/issues/new?title=Issue%20on%20page%20%2FSupplements/587-S14.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Supplements/587-S14.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ODE Solvers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-euler-method">The Euler Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-01-a-first-order-ode">Example 01: A first order ODE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-solution">Analytical Solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-approximate-solution-with-the-euler-method">An approximate solution with the Euler Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-breakdown-of-the-method">A breakdown of the method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-order-methods-runge-kutta">Higher Order Methods (Runge-Kutta)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scipy-integrate"><code class="docutils literal notranslate"><span class="pre">Scipy.integrate</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#function-formatting-for-use-with-scipy-integrate">Function formatting for use with <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-scipy-s-solve-ivp">Using Scipy’s <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-size-in-solvers">Step size in solvers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-precision">Increasing Precision</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-the-solution-at-specific-times">Returning the solution at specific times</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-a-polynomial-approximation-for-the-ode-solution">Returning a polynomial approximation for the ODE solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-continuous-approximation-to-the-ode-solution">Accessing the continuous approximation to the ODE solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-pass-arrays-to-the-interpolating-polynomial-approximation">You can pass arrays to the interpolating polynomial approximation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#options-in-solve-ivp">Options in <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-02-coupled-systems-of-odes">Example 02: Coupled Systems of ODES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-solution-structure-for-systems-of-odes">The solution structure for Systems of ODEs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-arguments-with-solve-ivp">Passing Extra Arguments with <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ode-solvers">
<h1>ODE Solvers<a class="headerlink" href="#ode-solvers" title="Permalink to this heading">#</a></h1>
<p>It is very common that we need to solve differential equations in science and engineering. The broad class of “differential equations” comprises many types of initial value problems and boundary value problems, both of which might involve ordinary or partial differential equations.  Here, we will focus only on numerical solutions of initial value problems in the form of ordinary differential equations or systems of ordinary differential equations.</p>
<p>The general idea with an initial value problem is that we have information about the rate of change of a quantity of interest (i.e., we know the derivative of a function), we know the starting value of that quantity of interest, and we would like to, based only on information about starting value and the derivative, predict the quantity of interest at some future time, position, Temperature, or other independent variable that describes our system.</p>
<p>We’ll do a very basic demonstration of how this works, but it is based on the idea that if you know the derivative, you can use the value of the deriviative to estimate how much your dependent variable (e.g., “y”) will change over a small step in the independent variable (e.g., “x”).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
</div>
</div>
<section id="the-euler-method">
<h2>The Euler Method<a class="headerlink" href="#the-euler-method" title="Permalink to this heading">#</a></h2>
<p>The most basic approach is the Euler method, which is basically just an algebraic rearrangement of the classic definition of a slope (m) of a function:</p>
<div class="math notranslate nohighlight">
\[m = \frac{dy}{dx} \approx \frac{\Delta y}{\Delta x}\]</div>
<p>Rearranging:</p>
<div class="math notranslate nohighlight">
\[\Delta y = m\cdot \Delta x\]</div>
<p>Substituting discrete values of y and x in for the deltas:</p>
<div class="math notranslate nohighlight">
\[y_1 - y_0 = \frac{dy}{dx} \cdot(x_1 - x_0)\]</div>
<p>We start at our initial value of (x0,y0); then, we take a small, numerical step in <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(\Delta x\)</span> (let’s call it <span class="math notranslate nohighlight">\(x_{step}\)</span>), and we update our value of the variable of interest, y, based on the derivative at <span class="math notranslate nohighlight">\(x_i\)</span>, which we assume is constant over the step h and thus extrapolate over the whole step:</p>
<div class="math notranslate nohighlight">
\[y_1 = y_0 + \frac{dy}{dx} \cdot x_{step}\]</div>
<p>Generally, we’ll write it as an iterative loop in terms of <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(x_{i+1}\)</span></p>
<div class="math notranslate nohighlight">
\[y_{i+1} = y_i + \frac{dy}{dx} \cdot x_{step}\]</div>
</section>
<section id="example-01-a-first-order-ode">
<h2>Example 01: A first order ODE<a class="headerlink" href="#example-01-a-first-order-ode" title="Permalink to this heading">#</a></h2>
<p>Let’s test this method on a first order ordinary differential equation:</p>
<div class="math notranslate nohighlight">
\[\frac{dy}{dx} = -y \ \ \textrm{with} \ \ y(0) = 10\]</div>
<section id="analytical-solution">
<h3>Analytical Solution<a class="headerlink" href="#analytical-solution" title="Permalink to this heading">#</a></h3>
<p>We know that the analytical solution to this initial value problem is the following exponential function:</p>
<div class="math notranslate nohighlight">
\[y(x) = 10 e^{-x}\]</div>
<p>Plot the solution to this IVP, y(x), over the domain x = [0, 6] in order to visualize how y changes as a function of x. Note, I called my function “ytrue(x)”, and I evaluated it on a numpy array of x-values from 0 to 6 called “xtrue.”  If you see those labels subsequently in this worksheet, it just means that I am using the analytical solution to this initial value problem, <span class="math notranslate nohighlight">\(y(x) = 10e^{-x}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ytrue</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
<span class="n">xtrue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1">## Plot solution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/73846a821015446a420fd5fac16f048e1e890e522245b9f6fc3b84e1abe19604.png" src="../_images/73846a821015446a420fd5fac16f048e1e890e522245b9f6fc3b84e1abe19604.png" />
</div>
</div>
</section>
<section id="an-approximate-solution-with-the-euler-method">
<h3>An approximate solution with the Euler Method<a class="headerlink" href="#an-approximate-solution-with-the-euler-method" title="Permalink to this heading">#</a></h3>
<p>Now, if we <em>didn’t</em> know how to solve that equation, or if we could otherwise could not solve it analytically, we would need to use a numerical method. The Euler method is the most simple way to numerically solve a differential equation. We’ll implement it to solve this example using a while loop.  I’ve also added in a bit of visualization to show how the Euler step works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xstep</span> <span class="o">=</span> <span class="mf">0.75</span>               <span class="c1">#I get to choose the size of the step for the independent variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>                      <span class="c1">#initial x</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1">#initial y</span>
<span class="n">xlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c1">#I&#39;m going to store all x values in a list; initializing that list here</span>
<span class="n">ylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>               <span class="c1">#Initialize a list containing y values for each x value</span>

<span class="k">while</span> <span class="n">xlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>       <span class="c1">#I want to continue iterating until I reach x = 6</span>
    <span class="n">dydx</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>              <span class="c1">#derivative of y with respect to x   </span>
    <span class="n">y</span>    <span class="o">=</span>  <span class="n">y</span> <span class="o">+</span> <span class="n">xstep</span><span class="o">*</span><span class="n">dydx</span> <span class="c1">#update y value using an Euler step</span>
    <span class="n">x</span>    <span class="o">=</span>  <span class="n">x</span> <span class="o">+</span> <span class="n">xstep</span>      <span class="c1">#update x value using step size</span>
    <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>        <span class="c1">#append new value of x</span>
    <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>        <span class="c1">#append new value of y</span>
<span class="c1">#     plt.plot(xtrue, ytrue(xtrue)) #plot true solution</span>
<span class="c1">#     for i in range(0, len(xlist)-1):</span>
<span class="c1">#         plt.plot([xlist[i], xlist[i+1]], [ylist[i], ylist[i+1]],&#39;:&#39;, color = &#39;k&#39;) #illustrate numerical steps in y</span>
<span class="c1">#     plt.show()             #show plot</span>
<span class="c1">#     time.sleep(2)          #pause for 2 seconds before next iteration</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xlist</span><span class="p">,</span> <span class="n">ylist</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler solution&#39;</span><span class="p">)</span>      <span class="c1">#plot full set of numerical estimates of y for values in xlist</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9d5ed706ddecedbfdc421cd494c11496eae7e4338579ea7cfad1139089a67f62.png" src="../_images/9d5ed706ddecedbfdc421cd494c11496eae7e4338579ea7cfad1139089a67f62.png" />
</div>
</div>
</section>
<section id="a-breakdown-of-the-method">
<h3>A breakdown of the method<a class="headerlink" href="#a-breakdown-of-the-method" title="Permalink to this heading">#</a></h3>
<p>Generally speaking, this is how a numerical differential equation solver works. It calculates the slope(s) at the current values for all function arguments, it takes a step in independent variable, and it predicts the value of the function based on the slope. With the step size I chose above (xstep = 0.75), you can see that the Euler method does a very bad job of approximating the true solution. You can probably already see the reason for this:  the Euler Method calculates the value of the derivative at <span class="math notranslate nohighlight">\(x_i\)</span>, and then it tacitly assumes that this derivative value is constant over the entire step in x, but we know this isn’t true here (nor for most differential equations that we need to use numerical methods for). You can improve the accuracy of the Euler Method by taking smaller steps; go ahead and experiment to figure out how small of a step you need to make before you are satisified that the numerical solution is roughly the same as the analytical solution.  Supress the looped plotting to keep it a bit more tidy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xstep</span> <span class="o">=</span> <span class="mf">0.05</span>               <span class="c1">#I get to choose the size of the step for the independent variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>                      <span class="c1">#initial x</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1">#initial y</span>
<span class="n">xlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c1">#I&#39;m going to store all x values in a list; initializing that list here</span>
<span class="n">ylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>               <span class="c1">#Initialize a list containing y values for each x value</span>

<span class="k">while</span> <span class="n">xlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>       <span class="c1">#I want to continue iterating until I reach x = 6</span>
    <span class="n">dydx</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>              <span class="c1">#derivative of y with respect to x   </span>
    <span class="n">y</span>    <span class="o">=</span>  <span class="n">y</span> <span class="o">+</span> <span class="n">xstep</span><span class="o">*</span><span class="n">dydx</span> <span class="c1">#update y value using an Euler step</span>
    <span class="n">x</span>    <span class="o">=</span>  <span class="n">x</span> <span class="o">+</span> <span class="n">xstep</span>      <span class="c1">#update x value using step size</span>
    <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>        <span class="c1">#append new value of x</span>
    <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>        <span class="c1">#append new value of y</span>
<span class="c1">#     plt.plot(xtrue, ytrue(xtrue)) #plot true solution</span>
<span class="c1">#     for i in range(0, len(xlist)-1):</span>
<span class="c1">#         plt.plot([xlist[i], xlist[i+1]], [ylist[i], ylist[i+1]],&#39;:&#39;, color = &#39;k&#39;) #illustrate numerical steps in y</span>
<span class="c1">#     plt.show()             #show plot</span>
<span class="c1">#     time.sleep(2)          #pause for 2 seconds before next iteration</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xlist</span><span class="p">,</span> <span class="n">ylist</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Euler solution&#39;</span><span class="p">)</span>      <span class="c1">#plot full set of numerical estimates of y for values in xlist</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/55160483c9fe1f54a9651cc03f6cd37b7c8462dd3df764bc9e4425ead793172f.png" src="../_images/55160483c9fe1f54a9651cc03f6cd37b7c8462dd3df764bc9e4425ead793172f.png" />
</div>
</div>
</section>
</section>
<section id="higher-order-methods-runge-kutta">
<h2>Higher Order Methods (Runge-Kutta)<a class="headerlink" href="#higher-order-methods-runge-kutta" title="Permalink to this heading">#</a></h2>
<p>The Euler method is the simplest numerical method for solving differential equations, and it is generally limited because it needs such a small step size. There are far more sophisticated algorithms for numerical solution of differential equations, but they are all based on iterative steps in independent variable and updating the dependent variable at each step.  It would be worth your time to at least read up on Explicit Runge Kutta Methods - these are very commonly used for numerical solution of ODEs. Higher order Runge-Kutta methods are available, and they do a good job at forecasting how the deriviate will change over the <span class="math notranslate nohighlight">\(x_{step}\)</span>, and so they can approximate the true solution much more accurately and with much larger step sizes than an Euler method.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">https://en.wikipedia.org/wiki/Runge–Kutta_methods</a></p>
</section>
<section id="scipy-integrate">
<h2><code class="docutils literal notranslate"><span class="pre">Scipy.integrate</span></code><a class="headerlink" href="#scipy-integrate" title="Permalink to this heading">#</a></h2>
<p>As usual, the methods in Python are more sophisticated than what we would usually write. They are flexible and powerful, and they can handle almost any type of differential equation you’d throw at them. Beyond writing your own loops to learn more about how the numerical method works, I would always defer to using the <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code> package for numerical solution of ODEs.</p>
<section id="function-formatting-for-use-with-scipy-integrate">
<h3>Function formatting for use with <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code><a class="headerlink" href="#function-formatting-for-use-with-scipy-integrate" title="Permalink to this heading">#</a></h3>
<p>To perform a numerical solution of an ODE or system of ODEs in Python, we need to write a function. This will be a multivariate, vector function, very similar to what we did with <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code>. It should be of the form <code class="docutils literal notranslate"><span class="pre">f(independent</span> <span class="pre">variable,</span> <span class="pre">dependent</span> <span class="pre">variable)</span></code>, where “dependent variable” is an array of all dependent or “state” variables in the ODE system, and it should return a vector of derivatives for each state variable with respect to the independent variable.</p>
<p>The basic rules:</p>
<ol class="arabic simple">
<li><p>The first argument to the function should be a scalar representing the <em><strong>independent</strong></em> variable that describes your system. As far as the ODE solver is concerned, it is always a scalar. Remember that these loops work iteratively, and at any given time, there is only a single value of the independent variable that you are considering.</p></li>
<li><p>The second argument to the function should be an array-like structure (array, tuple, list) that contains all of the dependent variables in the system of ODEs that you are solving. For a single ODE, that argument will be a scalar.</p></li>
<li><p>The function should return the deriviative of each depedent variable with respect to the single independent variable in a vector-like structure (array, tuple, list). If it is a single ODE, simply return a scalar.</p></li>
</ol>
<p>For the simple first order example above, this would be an appropriate way to format your function to pass to the ODE solver; you’ll see that it adhere’s to the rules above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>        <span class="c1">#function declaration - function should be of form f(independent variable, dependent variable)</span>
    <span class="n">dydx</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>       <span class="c1">#Calculate the value of the derivative of y at the current value of x</span>
    <span class="k">return</span> <span class="n">dydx</span>     <span class="c1">#return the value of the derivative of y at the current value of x</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-scipy-s-solve-ivp">
<h3>Using Scipy’s <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code><a class="headerlink" href="#using-scipy-s-solve-ivp" title="Permalink to this heading">#</a></h3>
<p>To solve this <em>initial value problem</em> numerically, we’ll call solve_ivp from the scipy.integrate package. It’s basic syntax is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">function</span> <span class="n">name</span><span class="p">,</span> <span class="n">span</span> <span class="n">of</span> <span class="n">independent</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">integrate</span> <span class="n">over</span><span class="p">,</span> <span class="n">initial</span> <span class="n">values</span> <span class="n">of</span> <span class="n">dependent</span> <span class="n">variables</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp">https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp</a></p>
<p>It has a few particulars.</p>
<ol class="arabic simple">
<li><p>The function must be of the form f(independent, dependent, *args); it can have additional arguments, but you will need to pass them using the args keyword in the <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> options.</p></li>
<li><p>The span for the independent variable needs to be in the form of a 2-element array that contains the starting point and the ending point only. If you need to get a different set of (independent, dependent) value pairs out, we’ll handle that later using the <code class="docutils literal notranslate"><span class="pre">t_eval</span></code> keyword argument using <code class="docutils literal notranslate"><span class="pre">solve_ivp</span></code> options.</p></li>
<li><p>The initial value(s) for the dependent variables must be in a 1-D array like structure, even if you are only solving 1 ODE.</p></li>
<li><p>The function should return an array-like structure containing the derivatives of each dependent variable with respect to the independent variable</p></li>
</ol>
<p>For this specific example, we are starting at y(0) = 10, and we are integrating from x = 0 to x = 6. Putting that into a format that works with <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code>, we would say <code class="docutils literal notranslate"><span class="pre">y0</span> <span class="pre">=</span> <span class="pre">[10]</span></code> and <code class="docutils literal notranslate"><span class="pre">xspan</span> <span class="pre">=(0,</span> <span class="pre">6)</span></code>. We can then pass our function, integration span, and initial value for y to <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code>, which will solve the differential equation numerically: <code class="docutils literal notranslate"><span class="pre">solve_ivp(D,</span> <span class="pre">xspan,</span> <span class="pre">y0)</span></code>.</p>
<p>Running this bit of code, you’ll see that <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> returns a solution structure, similar to what we would get from <code class="docutils literal notranslate"><span class="pre">opt.root()</span></code> or <code class="docutils literal notranslate"><span class="pre">opt.minimize()</span></code>.  You can access any attribute from that structure using the dot operator.  Probably the most interesting parts are <code class="docutils literal notranslate"><span class="pre">.t</span></code>, which contains your independent variable values, and <code class="docutils literal notranslate"><span class="pre">.y</span></code>, which contains your dependent variable values. No matter the decisions you make about inputs, these are formatted as numpy arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="n">xspan</span> <span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  message: The solver successfully reached the end of the integration interval.
  success: True
   status: 0
        t: [ 0.000e+00  1.000e-01  1.032e+00  1.907e+00  2.786e+00
             3.665e+00  4.545e+00  5.424e+00  6.000e+00]
        y: [[ 1.000e+01  9.048e+00  3.567e+00  1.487e+00  6.175e-01
              2.565e-01  1.065e-01  4.423e-02  2.487e-02]]
      sol: None
 t_events: None
 y_events: None
     nfev: 50
     njev: 0
      nlu: 0
</pre></div>
</div>
</div>
</div>
<p>Often, I save the output, which enables convenient post-analysis (plotting, etc.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>  <span class="c1">#numerical solution of ODE</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>                   <span class="c1">#print independent variable values, loosely called &quot;t&quot; in many solvers</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>                   <span class="c1">#print dependent variable values, loosely called &quot;y&quot; in many solvers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Solve_ivp solution&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.         0.100002   1.03168058 1.90730319 2.78642162 3.66539161
 4.5445371  5.4240714  6.        ]
[[10.          9.04835609  3.56669733  1.48659323  0.61745564  0.25649777
   0.10653333  0.04423023  0.02486609]]
</pre></div>
</div>
<img alt="../_images/f21252df9163698dde856c8734a2d9b38104da7fe81218621c03f3cfc715c843.png" src="../_images/f21252df9163698dde856c8734a2d9b38104da7fe81218621c03f3cfc715c843.png" />
</div>
</div>
</section>
<section id="step-size-in-solvers">
<h3>Step size in solvers<a class="headerlink" href="#step-size-in-solvers" title="Permalink to this heading">#</a></h3>
<p>You may notice from the plot that the solver did not take even steps in x.  That is fine - some solvers use adaptive step sizes.  In general, they are far better at deciding on a good step size than we are.  This is why we only specify the starting and ending point for integration.  The solver decides on the intermediate points, not us.  That said, you may wish to get higher resolution and view the solution to the differential equation at additional points in the domain where you solved it.  You can do this in a few ways by adjusting options in <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code>.</p>
</section>
<section id="increasing-precision">
<h3>Increasing Precision<a class="headerlink" href="#increasing-precision" title="Permalink to this heading">#</a></h3>
<p>Sometimes we don’t care so much about specific time steps as we care about having closely space time steps; the easiest way to force more closely spaced time steps is to adjust the precision of our solution using the <code class="docutils literal notranslate"><span class="pre">atol</span></code> and <code class="docutils literal notranslate"><span class="pre">rtol</span></code> keyword arguments, which respectively set absolute and relative tolerances on the state variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Solve_ivp solution&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/13572d4fe657c304f67a43c3f262ff067fb8f3eae180eb1300ff00ee0847e43e.png" src="../_images/13572d4fe657c304f67a43c3f262ff067fb8f3eae180eb1300ff00ee0847e43e.png" />
</div>
</div>
</section>
<section id="returning-the-solution-at-specific-times">
<h3>Returning the solution at specific times<a class="headerlink" href="#returning-the-solution-at-specific-times" title="Permalink to this heading">#</a></h3>
<p>Alternatively, Let’s say I wanted to plot the numerical solution on an evenly spaced set of x-values using a step size of 0.1.  I can do that using the <code class="docutils literal notranslate"><span class="pre">t_eval</span></code> keyword argument, which allows me to specify where I want to see the solution. You’ll see that this returns the values at the specified x-values (even though it does not affect the steps taken by the ode solver).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">61</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">xgrid</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">ytrue</span><span class="p">(</span><span class="n">xtrue</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;analytical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Solve_ivp solution&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to a First order ODE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fc50b1af40ff967a93e189a5b64979e7afc978b410e6a941d2a06fb290957521.png" src="../_images/fc50b1af40ff967a93e189a5b64979e7afc978b410e6a941d2a06fb290957521.png" />
</div>
</div>
</section>
<section id="returning-a-polynomial-approximation-for-the-ode-solution">
<h3>Returning a polynomial approximation for the ODE solution<a class="headerlink" href="#returning-a-polynomial-approximation-for-the-ode-solution" title="Permalink to this heading">#</a></h3>
<p>It is important to recognize that these step-based ODE solvers will provide a discrete set of y-values for a discrete set of t-values; they are not a continuous function y(t).  Another nice feature of <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> is that you can get it to generate a continuous function that approximates the true solution for y(x). It does this by fitting an interpolating polynomial to the ODE solution.using interpolating polynomials. You do this with the <code class="docutils literal notranslate"><span class="pre">dense_output</span></code> keyword argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dense_output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  message: The solver successfully reached the end of the integration interval.
  success: True
   status: 0
        t: [ 0.000e+00  1.000e-01  1.032e+00  1.907e+00  2.786e+00
             3.665e+00  4.545e+00  5.424e+00  6.000e+00]
        y: [[ 1.000e+01  9.048e+00  3.567e+00  1.487e+00  6.175e-01
              2.565e-01  1.065e-01  4.423e-02  2.487e-02]]
      sol: &lt;scipy.integrate._ivp.common.OdeSolution object at 0x00000148C687B7A0&gt;
 t_events: None
 y_events: None
     nfev: 50
     njev: 0
      nlu: 0
</pre></div>
</div>
</div>
</div>
</section>
<section id="accessing-the-continuous-approximation-to-the-ode-solution">
<h3>Accessing the continuous approximation to the ODE solution<a class="headerlink" href="#accessing-the-continuous-approximation-to-the-ode-solution" title="Permalink to this heading">#</a></h3>
<p>Once you print out the solution, you’ll see it returns a sneaky attribute also called “sol,” which makes my choice of “sol” as the name of the solution structure unfortunate.  In any event, just like <code class="docutils literal notranslate"><span class="pre">sol.t</span></code> or <code class="docutils literal notranslate"><span class="pre">sol.y</span></code>, you can call <code class="docutils literal notranslate"><span class="pre">sol.sol</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sol.sol</span></code> is a <em>function</em> that returns the value of your dependent variable(s) for any value(s) of your independent variable.  This is a really great add-on for a numerical ode solver as it saves you from having to create your own function using interpolating polynomials.  For example, let’s say I wanted to know y at x = 3:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">sol</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.49856278])
</pre></div>
</div>
</div>
</div>
</section>
<section id="you-can-pass-arrays-to-the-interpolating-polynomial-approximation">
<h3>You can pass arrays to the interpolating polynomial approximation<a class="headerlink" href="#you-can-pass-arrays-to-the-interpolating-polynomial-approximation" title="Permalink to this heading">#</a></h3>
<p>Let’s say I wanted data at x = 1, 2.6, 3.175, and 4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">sol</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.175</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[3.68139827, 0.74365091, 0.41842251, 0.18346332]])
</pre></div>
</div>
</div>
</div>
<p>When might you use this?  Let’s say you had a set of experimentally measured values of y for several values of x, and you want to regress parameters for your model…but you have to solve a differential equation in order to figure out your model prediction, and you have no control over the steps taken by the solver.  No problem - get it to output a continuous function, and you can then solve for the value of y at all of your experimental values of x and use it to generate an objective function.</p>
</section>
<section id="options-in-solve-ivp">
<h3>Options in <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code><a class="headerlink" href="#options-in-solve-ivp" title="Permalink to this heading">#</a></h3>
<p>The options available for solve_ivp are <em>extensive</em>.  We will not cover all of them for a few reasons.  First, we don’t have the time and space to devote to this.  Second, generally speaking, the default options on things like function tolerance or maximum step sizes are pretty good.  Changing them requires a good understanding of how they work and why they are important.  Changing them haphazardly can be dangerous.  I would suggest researching the options available and putting serious thought into the ones that are relevant to your problem and <em>might</em> be worth changing.</p>
<p>The only other one that we’ll mention is the method keyword.  Most of the time, the default method will be fine for you.  Sometimes, you will encounter <em>stiff</em> systems of differential equations. In high level terms, what that means is you have two or more coupled dependent variables that are changing as functions of the indepdendent variable. If those two variables change on extremely different scales, then you have what is called a stiff system, and they require specialized solvers.  When might you see this?  When the derivative of one variable is much, much larger than the derivative of the other variable.  In these cases, you will probably want to adjust your solver using the method keyword.  For example, the default solver in <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> is RK45, an explicit Runge–Kutta–Fehlberg method (4th order method, 5th order error estimate). It is not efficient for stiff systems, so you would want to change to Radau, BDF, or LSODA methods if you need to solve a stiff system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Radau&#39;</span><span class="p">)</span>
<span class="c1"># solve_ivp(D, xspan, y0, method = &#39;BDF&#39;)</span>
<span class="c1"># solve_ivp(D, xspan, y0, method = &#39;LSODA&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  message: The solver successfully reached the end of the integration interval.
  success: True
   status: 0
        t: [ 0.000e+00  5.624e-02 ...  5.680e+00  6.000e+00]
        y: [[ 1.000e+01  9.453e+00 ...  3.414e-02  2.479e-02]]
      sol: None
 t_events: None
 y_events: None
     nfev: 92
     njev: 2
      nlu: 6
</pre></div>
</div>
</div>
</div>
<p>How can you tell when you need to change solvers?  Usually the default option (RK45) is a good choice.  If you notice that it is taking a long time to run, making an unusually large number of steps, or failing to converge altogether, you probably are solving a stiff system.  Try one of the stiff ODE solvers instead.</p>
</section>
</section>
<section id="example-02-coupled-systems-of-odes">
<h2>Example 02: Coupled Systems of ODES<a class="headerlink" href="#example-02-coupled-systems-of-odes" title="Permalink to this heading">#</a></h2>
<p>We covered a lot of ground in terms of how to use the solvers above, but all of the examples we have considered so far deal with one ODE that we can easily solve by hand. Numerical ODE solvers really shine when you have a very complex differential equation that does not have an analytical solution, or when you have coupled systems of nonlinear differential equations, which are generally either very difficult or impossible to solve analytically. By “coupled” differential equations, I mean that the derivatives of the dependent variables are functions of each other (see system below).</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{dx}{dt} &amp;= -x^2 + y^2 \\
\frac{dy}{dt} &amp;= -xy \\
x(0) &amp;= 0 \\
y(0) &amp;= 3 \\
\end{align*}\]</div>
<p>A typical question we might ask about this system is <strong>what are the values of x and y at t = 10?</strong></p>
<p>I see that dx/dt is a function of x and y, and dy/dt is also a function of x and y.  I cannot solve one without solving the other. Though it is sometimes possible to solve a coupled system analytically, the vast majority of cases must be handled with numerical methods.  Fortunately, the framework we established above for solving a single differential equation is very general, and it is super easy to extend it to systems of differential equations.</p>
<p>We just need to formulate our system of differential equations as multivariate vector functions of the form f(t,y) or, in other words, f(independent variable, dependent variable). Both of our dependent variables, (x and y in this case), need to be passed to the function in a single, vector-like structure. The function also needs to return dx/dt and dy/dt in a vector-like structure (tuple, array, list). For this example, the following is an acceptable way to define that function using lists:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">var</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span>
    <span class="n">dxdt</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dydt</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">y</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dxdt</span><span class="p">,</span> <span class="n">dydt</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now that the function is defined, we can integrate it on the domain t = [0, 10].  We follow the same conventions as above.  The span of the independent variable must be a two-element array, and the initial values of x and y must be passed to the function as an array-like structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>   <span class="c1">#Integration span</span>
<span class="n">x0</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">y0</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="n">var0</span>  <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span>  <span class="c1">#initial values for x and y, using a list</span>
<span class="n">solve_ivp</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">var0</span><span class="p">)</span> <span class="c1">#use solve_ivp to solve the system of ODEs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  message: The solver successfully reached the end of the integration interval.
  success: True
   status: 0
        t: [ 0.000e+00  1.111e-04 ...  9.403e+00  1.000e+01]
        y: [[ 0.000e+00  9.997e-04 ...  1.272e-01  1.192e-01]
            [ 3.000e+00  3.000e+00 ...  4.396e-02  4.085e-02]]
      sol: None
 t_events: None
 y_events: None
     nfev: 86
     njev: 0
      nlu: 0
</pre></div>
</div>
</div>
</div>
<section id="the-solution-structure-for-systems-of-odes">
<h3>The solution structure for Systems of ODEs<a class="headerlink" href="#the-solution-structure-for-systems-of-odes" title="Permalink to this heading">#</a></h3>
<p>You can see the solution structure has a lot of useful information, exactly as in the case of a single ODE.  The only major difference here is that the <code class="docutils literal notranslate"><span class="pre">.y</span></code> values are now a larger array where the first row is values of x, and the second row is values of y at each time point in <code class="docutils literal notranslate"><span class="pre">.t</span></code>.  We can plot them as a function of t easily.  To illustrate the way things are stored, I’ll extract x and y values from <code class="docutils literal notranslate"><span class="pre">sol.y</span></code>. I’ll also request a much higher resolution in the output, taking 100 steps between 0 and 10 for making a nice, smooth plot. I’ve also added labels and a legend so we can easily distinguish between the graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">var0</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">tgrid</span><span class="p">)</span>
<span class="n">t</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span>
<span class="n">x</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="n">y</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x, y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to Coupled ODEs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2adaad972854f6eedbfbbc743c305057dffbcf85be55e223cee938bf30039c59.png" src="../_images/2adaad972854f6eedbfbbc743c305057dffbcf85be55e223cee938bf30039c59.png" />
</div>
</div>
</section>
<section id="passing-extra-arguments-with-solve-ivp">
<h3>Passing Extra Arguments with <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code><a class="headerlink" href="#passing-extra-arguments-with-solve-ivp" title="Permalink to this heading">#</a></h3>
<p>It may often be useful to you to pass extra parameters into your differential equation model.  The solver will only operate on the independent variable and dependent variable (i.e., the first two arguments).  You can add as many additional arguments as you like thereafter, and you pass them to <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> using the usual <code class="docutils literal notranslate"><span class="pre">args</span></code> keyword.  So let’s change that system just a bit to illustrate this concept:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{dx}{dt} &amp;= -ax^2 + by^2 \\
\frac{dy}{dt} &amp;= -cxy \\
x(0) &amp;= 0 \\
y(0) &amp;= 3 \\
\end{align*}\]</div>
<p>Where a, b, and c are constant coefficients.  For the values (a,b,c) = (0.2, 1.3, 8), what are the values of x and y at t = 10?  What about for (a,b,c) = (1.5, 0.3, -0.1)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">var</span>
    <span class="n">dxdt</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dydt</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dxdt</span><span class="p">,</span> <span class="n">dydt</span><span class="p">]</span>

<span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>   <span class="c1">#Integration span</span>
<span class="n">x0</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">y0</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="n">var0</span>  <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span>  <span class="c1">#initial values for x and y</span>
<span class="n">a</span>     <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">b</span>     <span class="o">=</span> <span class="mf">1.3</span>
<span class="n">c</span>     <span class="o">=</span> <span class="mi">8</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">var0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">)</span>
<span class="n">t</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span>
<span class="n">x</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="n">y</span>   <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x, y&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solutions to Coupled ODEs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d5b1a0df1067203d551e8ae2adf1bf7c03b0c96f25fbbb7f8b39c3eb2d8d71ae.png" src="../_images/d5b1a0df1067203d551e8ae2adf1bf7c03b0c96f25fbbb7f8b39c3eb2d8d71ae.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Supplements"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-euler-method">The Euler Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-01-a-first-order-ode">Example 01: A first order ODE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-solution">Analytical Solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-approximate-solution-with-the-euler-method">An approximate solution with the Euler Method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-breakdown-of-the-method">A breakdown of the method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-order-methods-runge-kutta">Higher Order Methods (Runge-Kutta)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scipy-integrate"><code class="docutils literal notranslate"><span class="pre">Scipy.integrate</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#function-formatting-for-use-with-scipy-integrate">Function formatting for use with <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-scipy-s-solve-ivp">Using Scipy’s <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-size-in-solvers">Step size in solvers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#increasing-precision">Increasing Precision</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-the-solution-at-specific-times">Returning the solution at specific times</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-a-polynomial-approximation-for-the-ode-solution">Returning a polynomial approximation for the ODE solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-continuous-approximation-to-the-ode-solution">Accessing the continuous approximation to the ODE solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#you-can-pass-arrays-to-the-interpolating-polynomial-approximation">You can pass arrays to the interpolating polynomial approximation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#options-in-solve-ivp">Options in <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-02-coupled-systems-of-odes">Example 02: Coupled Systems of ODES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-solution-structure-for-systems-of-odes">The solution structure for Systems of ODEs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passing-extra-arguments-with-solve-ivp">Passing Extra Arguments with <code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>