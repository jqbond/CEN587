
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Kinetics IV &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebooks/587-N42';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kinetics IV" href="587-N43.html" />
    <link rel="prev" title="Lectures" href="../Chapter2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="../_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../Chapter2.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Kinetics IV</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N43.html">Kinetics IV</a></li>
<li class="toctree-l2"><a class="reference internal" href="587-N44.html">Kinetics V</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/CEN587/main?urlpath=tree/Notebooks/587-N42.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/CEN587" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/CEN587/issues/new?title=Issue%20on%20page%20%2FNotebooks/587-N42.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Notebooks/587-N42.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Kinetics IV</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differential-analysis">Differential Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integral-analysis-with-nonlinear-regression">Integral Analysis with nonlinear Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-solution">First Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-solution">Second Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-order-solution">Third Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-integrated-models">Summary of integrated models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-least-squares">Nonlinear Least Squares</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-nonlinear-regression">First Order Nonlinear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-nonlinear-regression">Second Order Nonlinear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linearization-of-data">Linearization of Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-linearization">First Order Linearization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-time-allows-we-can-come-back-to-this-point">If Time Allows, we can come back to this point</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="kinetics-iv">
<h1>Kinetics IV<a class="headerlink" href="#kinetics-iv" title="Link to this heading">#</a></h1>
<p>This Notebook continues with the analysis of kinetic data obtained in a constant volume batch reactor. Now that we have a basic understanding of the methods (least squares minimization, linearization, linear regression, etc.), we will work through noisy data (i.e., real data). We will introduce a few concepts and techniques for managing noisy data, and we will consider the method of excess, which can be useful for determining reaction orders on individual reactants for reactions that involve multiple reactants. We will again leverage various statistical metrics that complement the residual sum of squares to help quantify goodness of fit; these include the coefficient of determination, <span class="math notranslate nohighlight">\(R^2\)</span>, and confidence intervals on parameter estimates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">opt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span>
</pre></div>
</div>
</div>
</div>
<section id="example-problem-01">
<h2>Example Problem 01<a class="headerlink" href="#example-problem-01" title="Link to this heading">#</a></h2>
<p>The following reaction is carried out in a well-mixed, constant volume batch reactor. The concentration of species <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> in the tank are initially <span class="math notranslate nohighlight">\(C_{A0} = 0.05 \ \mathrm{M}\)</span> and <span class="math notranslate nohighlight">\(C_{B0} = 0.5 \ \mathrm{M}\)</span>, respectively. The fluid inside of the reactor has constant density.</p>
<div class="math notranslate nohighlight">
\[A + B \longrightarrow C\]</div>
<p>You measure the concentration of species <span class="math notranslate nohighlight">\(A\)</span> in this reactor, monitoring how it changes with time. The data you collect are given in the table below.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>time (min)</p></th>
<th class="head text-center"><p><span class="math notranslate nohighlight">\(C_A \times 10^{2} \ (\mathrm{mol \ L^{-1}})\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>0</p></td>
<td class="text-center"><p>4.81</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>25</p></td>
<td class="text-center"><p>4.52</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>50</p></td>
<td class="text-center"><p>3.86</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>75</p></td>
<td class="text-center"><p>3.30</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>100</p></td>
<td class="text-center"><p>3.21</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>125</p></td>
<td class="text-center"><p>2.73</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>150</p></td>
<td class="text-center"><p>2.53</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>175</p></td>
<td class="text-center"><p>2.43</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>200</p></td>
<td class="text-center"><p>2.31</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>225</p></td>
<td class="text-center"><p>2.01</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>250</p></td>
<td class="text-center"><p>1.96</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>275</p></td>
<td class="text-center"><p>1.88</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>300</p></td>
<td class="text-center"><p>1.70</p></td>
</tr>
</tbody>
</table>
</div>
<p>You may assume that the rate law is described by power law kinetics,</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^{\alpha}{C_B}^{\beta}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is an <em><strong>unknown integer</strong></em> and <span class="math notranslate nohighlight">\(\beta = 1\)</span>. Determine the reaction order in <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(\alpha\)</span>, and the rate constant for this reaction.</p>
<section id="solution-to-example-problem-01">
<h3>Solution to Example Problem 01<a class="headerlink" href="#solution-to-example-problem-01" title="Link to this heading">#</a></h3>
<p>Before we start, it’s important to point out something about regression and parameter estimation.  Here, we are looking for the order with respect to species <span class="math notranslate nohighlight">\(A\)</span>. If we’re trying to extract that order from data, it is easiest to do if we’ve performed an experiment <em><strong>where we are only varying the concentration of species <span class="math notranslate nohighlight">\(A\)</span> and watching how the system responds</strong></em>. If the concentration of <span class="math notranslate nohighlight">\(B\)</span> also varies, this generally will impact the reaction rate, so it is difficult for us to isolate the relationship between <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(C_A\)</span>. In a batch reactor, it can be tricky to hold the concentration of one reactant constant while varying the other because both species are consumed in the reaction, and there is no avoiding the fact that the concentrations of species <span class="math notranslate nohighlight">\(A\)</span> and species <span class="math notranslate nohighlight">\(B\)</span> will both change as a function of time.</p>
<p>One was to handle this is by performing the experiment in such a way that the only the concentration of interest varies <em><strong>significantly</strong></em> (in this case, species A) while the other remains <em><strong>approximately constant</strong></em>. This is commonly known as the <em><strong>method of excess</strong></em>. It entails having one reactant present in a large excess so that its concentration does not <em><strong>significantly change</strong></em> over the course of the experiment.  Here, that is done with species <span class="math notranslate nohighlight">\(B\)</span>. Its initial concentration is 0.5M, whereas the initial concentration of <span class="math notranslate nohighlight">\(A\)</span> is <span class="math notranslate nohighlight">\(C_{A0} = 0.05 \ \mathrm{M}\)</span>. Clearly, species <span class="math notranslate nohighlight">\(A\)</span> is the limiting reactant! We can calculate that even if we convert 100% of species <span class="math notranslate nohighlight">\(A\)</span>, concentration of species <span class="math notranslate nohighlight">\(B\)</span> will only decrease 10% to <span class="math notranslate nohighlight">\(C_B = 0.45 \ \mathrm{M}\)</span>. A 10% change in the concentration of species <span class="math notranslate nohighlight">\(B\)</span> alongside a 100% change in the concentration of species <span class="math notranslate nohighlight">\(A\)</span> is relatively insignificant, and it will not meaningfully impact our estimates of reaction rate. This allows us to extract the dependence on species A from our data.</p>
<p>We can simplify the rate law to account for an approximately constant concentration of <span class="math notranslate nohighlight">\(B\)</span>. This is not necessary, but it makes the symbolic manipulations a bit cleaner. We start with the general rate expression:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_B}^\beta\]</div>
<p>We know that <span class="math notranslate nohighlight">\(\beta\)</span> = 1, so:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_B}\]</div>
<p>Since in this experiment <span class="math notranslate nohighlight">\(C_B \approx C_{B0}\)</span>:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha{C_{B0}}\]</div>
<p>Since <span class="math notranslate nohighlight">\(C_{B0}\)</span> is constant, we lump it it with the rate constant to get:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime{C_A}^\alpha\]</div>
<p>This is a rate expression that only depends on the concentration of <span class="math notranslate nohighlight">\(A\)</span>. We just have to remain mindful that the rate constant we estimate from this model, <span class="math notranslate nohighlight">\(k^\prime\)</span> is actually defined as:</p>
<div class="math notranslate nohighlight">
\[k^\prime = kC_{B0}\]</div>
<p>So if we want to get the true rate constant, <span class="math notranslate nohighlight">\(k\)</span>, we have to account for that dependence in the lumped constant in our final analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##########################################################################################################</span>
<span class="c1"># Store experimental time and concentration data in numpy arrays                                         #</span>
<span class="c1">##########################################################################################################</span>

<span class="n">tdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span> <span class="c1">#time in minutes</span>
<span class="n">tDATA</span> <span class="o">=</span> <span class="n">tdata</span>
<span class="n">tfine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">CAdata</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0481</span><span class="p">,</span> <span class="mf">0.0452</span><span class="p">,</span> <span class="mf">0.0386</span><span class="p">,</span> <span class="mf">0.0330</span><span class="p">,</span> <span class="mf">0.0321</span><span class="p">,</span> <span class="mf">0.0273</span><span class="p">,</span> <span class="mf">0.0253</span><span class="p">,</span> <span class="mf">0.0243</span><span class="p">,</span> <span class="mf">0.0231</span><span class="p">,</span> <span class="mf">0.0201</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mf">0.0188</span><span class="p">,</span> <span class="mf">0.0170</span><span class="p">])</span> <span class="c1">#Concentrations in moles per liter</span>
<span class="n">CADATA</span> <span class="o">=</span> <span class="n">CAdata</span>

<span class="c1">##########################################################################################################</span>
<span class="c1"># Create scatterplot to visualize CA vs. t shape/profile/time scale                                      #</span>
<span class="c1">##########################################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;A + B --&gt; C&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9fea758f4f49c78c5e1ba189c8fec61d48bccc81f9048e8dec22020611f3a4f0.png" src="../_images/9fea758f4f49c78c5e1ba189c8fec61d48bccc81f9048e8dec22020611f3a4f0.png" />
</div>
</div>
<p>Now we begin the analyis of this data in our attempt to extract the rate constant, <span class="math notranslate nohighlight">\(k\)</span>, and the reaction order in <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(\alpha\)</span>. We are working with a power law model that includes a lumped rate constant:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime{C_A}^\alpha\]</div>
<p>Recall that our data set comprises the concentration of species <span class="math notranslate nohighlight">\(A\)</span> measured at various points in time. It is fundamentally a <span class="math notranslate nohighlight">\(C_A\)</span> vs. <span class="math notranslate nohighlight">\(t\)</span> data set. Our rate law is a model that describes how <span class="math notranslate nohighlight">\(r\)</span> changes as a function of <span class="math notranslate nohighlight">\(C_A\)</span>, but we have no data (yet) where rates are measured as a function of <span class="math notranslate nohighlight">\(C_A\)</span>. We can begin to describe the relationship between <span class="math notranslate nohighlight">\(C_A\)</span> and <span class="math notranslate nohighlight">\(t\)</span> by writing a material balance on species <span class="math notranslate nohighlight">\(A\)</span>. For a constant volume batch reactor, the balance on species <span class="math notranslate nohighlight">\(A\)</span> is:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = R_A\]</div>
<p>Here, we have a single reaction where the production rate of <span class="math notranslate nohighlight">\(A\)</span> is <span class="math notranslate nohighlight">\(R_A = -r\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -r\]</div>
<p>Finally, we can substitute the lumped power law rate expression to get:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime{C_A}^\alpha\]</div>
<p>Now we have a differential equation that we can use to either</p>
<ol class="arabic simple">
<li><p>Relate <span class="math notranslate nohighlight">\(r\)</span> to <span class="math notranslate nohighlight">\(C_A\)</span> using a differential analysis.</p></li>
<li><p>Relate <span class="math notranslate nohighlight">\(C_A\)</span> to <span class="math notranslate nohighlight">\(t\)</span> using integral analysis.</p></li>
</ol>
<p>We might recall that a differential analysis is fast and easy to apply – a major reason for this is that it does not require us to assume a reaction order and solve the resultant differential equation. Differential analysis is generally useful when we have an unknown reaction order, as is the case here.  For these reasons, it makes sense to start with a differential analysis. This will give us some idea of the reaction order and rate constant, and then we can proceed to an integral analysis to improve precision in our parameter estimates.</p>
</section>
<section id="differential-analysis">
<h3>Differential Analysis<a class="headerlink" href="#differential-analysis" title="Link to this heading">#</a></h3>
<p>The beauty of the differential analysis is that we can use it to estimate the reaction order when we really don’t know one. We should be aware that a differential analysis of data can introduce imprecision and amplify noise because of limitations in finite difference approximations, but it remains a useful way to start our analysis.</p>
<p>From our material balance, we know that, in a constant volume batch reactor, the reaction rate can be inferred from the time derivative of species concentration. For example, the balance on species A tells us:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -r\]</div>
<p>In other words, if we can calculate the time derivative of concentration of <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(dC_A/dt\)</span>, we would essentially be calculating the reaction rate. We have discrete data, not a <span class="math notranslate nohighlight">\(C_A(t)\)</span> function, so we cannot take an analytical derivative; however, we can proceed as we did in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N40.html">Notebook 40</a> by approximating the time derivative of <span class="math notranslate nohighlight">\(C_A\)</span> using a forward difference approximation.</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt}\bigg|_{C_{A_n}} \approx \frac{C_{A_{n+1}} - C_{A_{n}}}{t_{n+1} - t_n}\]</div>
<p>This approximation gives us a set of approximate reaction rate estimated at a corresponding set of <span class="math notranslate nohighlight">\(C_A\)</span> values. This is enough information for us to begin testing the relationship between reaction rate and concentration of <span class="math notranslate nohighlight">\(A\)</span>. Starting with the proposed rate law:</p>
<div class="math notranslate nohighlight">
\[r = k^{\prime}{C_A}^\alpha\]</div>
<p>Which can be linearized using logarithms:</p>
<div class="math notranslate nohighlight">
\[\ln(r) = \ln(k^\prime) + \alpha \ln(C_A)\]</div>
<p>We can use this first order model to regress coefficients (slope and y-intercept), which inform us about the reaction order and rate constant.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Recall that we have to use two data points to estimate a derivative, so our set of 13 measurments gives us 12 estimated derivatives using a forward difference method only. Now let’s plot those rates against the corresponding concentrations on logarithmic axes to get a sense of the reaction order…</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###################################################################################################</span>
<span class="c1"># Calculate finite differences in CA and t; use to estimate rate of reaction                      #</span>
<span class="c1">###################################################################################################</span>

<span class="n">ΔCA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">Δt</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">r</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">ΔCA</span><span class="o">/</span><span class="n">Δt</span>
<span class="c1"># print(len(CAdata))</span>
<span class="c1"># print(len(r))</span>

<span class="c1">##################################################################################################</span>
<span class="c1"># Define ydata and xdata for linearized power law expression                                     #</span>
<span class="c1">##################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">##################################################################################################</span>
<span class="c1"># Create a scatterplot of ydata vs xdata to assess linearity                                     #</span>
<span class="c1">##################################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA (M))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(rate (mol/L/min))&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2957b1ce0148f2817b5d96ecc7194a78acc8da01c5f50d8c2fb57c5432aca014.png" src="../_images/2957b1ce0148f2817b5d96ecc7194a78acc8da01c5f50d8c2fb57c5432aca014.png" />
</div>
</div>
<p>Yikes! It’s really hard to say whether that trend is linear. Let’s work through the linear regression analysis and calculation of statistical metrics to get a quantitative sense of the fit as well as the reaction order and rate constant suggested by differential analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#This creates the X matrix shown above, truncating at 1st order</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">b</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1] </span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">SEb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the intercept is the second diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">CIb</span>    <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on intercept</span>
<span class="n">α</span>      <span class="o">=</span> <span class="n">m</span>                            <span class="c1">#slope is equal to the reaction order α</span>
<span class="n">k</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>                    <span class="c1">#y intercept is equal to ln(k)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span> <span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;α&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> (but really is between </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">CIb</span><span class="p">)</span><span class="si">:</span><span class="s1">0.2e</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">CIb</span><span class="p">)</span><span class="si">:</span><span class="s1">0.2e</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln (CA) mol/L&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r) mol/L/min&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in ln (r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = 1.75 +/- 1.35
b    = -3.22 +/- 4.85
SSE  = 4.19
SST  = 7.68
MSE  = 0.35
RMSE = 0.59
R2   = 0.45
α    = 1.75 +/- 1.35
k    = 0.04 (but really is between 3.12e-04 and 5.11e+00)
</pre></div>
</div>
<img alt="../_images/84dcd7fcd74c345d92ee111c77a43402e6ba7051c1784e8ecd11be8dfde4fd86.png" src="../_images/84dcd7fcd74c345d92ee111c77a43402e6ba7051c1784e8ecd11be8dfde4fd86.png" />
<img alt="../_images/8d645ef5abe9d447cf476ea765e790572ac61d779e17d5eb7ca3002e3f1fb33a.png" src="../_images/8d645ef5abe9d447cf476ea765e790572ac61d779e17d5eb7ca3002e3f1fb33a.png" />
</div>
</div>
<p>Clearly, this is a pretty rough fit to noisy data – the coefficient of determination is far from 1 <span class="math notranslate nohighlight">\((R^2 = 0.45)\)</span>, and we see large confidence intervals on the parameter estimates. That said, the measurements do scatter uniformly around the prediction line, and the absolute residual errors are not terrible. Although we don’t have high confidence in any parameter, the data fit suggests that the reaction order is <span class="math notranslate nohighlight">\(\alpha = 1.75 \pm 1.3\)</span> and that the rate constant is <span class="math notranslate nohighlight">\(k = 0.04\)</span> with large confidence intervals.</p>
<p>Let’s see if we can do a little better – it helps if we understand the origin(s) of imprecision here. First, as we saw in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N39.html">Notebook 39</a>, taking finite differences introduces imprecision – even in perfect data.  Here, we have real (simulated real) data, where there is actual uncertainty and noise in the measurements. Sometimes our measurements are higher or lower than the “true” value at that time, and this compounds the uncertainty in the approximation that derivatives are constant when we use finite difference approximations.</p>
<p>We can do a little better if we smooth the data before we estimate the derivative of that data. One way that we can do this is regressing a polynomial that captures the behavior of the data set (<span class="math notranslate nohighlight">\(C_A\)</span> vs. <span class="math notranslate nohighlight">\(t\)</span>), but excludes the noise in the data set. Before we proceed, we should recognize that this polynomial fit is meaningless in a physical sense. It will do an adequate job of describing how <span class="math notranslate nohighlight">\(C_A\)</span> changes as a function of <span class="math notranslate nohighlight">\(t\)</span>, but it does not contain any physical insight into the system, and it has no relation to the material balance on a batch reactor. It is simply a way for us to develop a continuous, well-behaved function that empirically captures how concentration decreases with time. Once we have this regression polynomial, it is a well-defined <span class="math notranslate nohighlight">\(C_A(t)\)</span> function, which means we can take an analytical derivative instead of using finite differences to approximate derivatives. We can then use this analytical derivative to estimate rate of reaction and thus reaction orders.</p>
<p>First, we need to fit a polynomial to data. We have options for doing this, but they are all an implementation of linear least squares as discussed in <a class="reference external" href="https://jqbond.github.io/CEN587/Notebooks/587-N37.html">Notebook 37</a>. For convenience, we will use <code class="docutils literal notranslate"><span class="pre">numpy.polyfit()</span></code> here. We do not have a good sense of the order of the polynomial that we should use at the start of the regession analysis, and it is easy to adjust this value with <code class="docutils literal notranslate"><span class="pre">numpy.polyfit()</span></code>.</p>
<p>We have 13 data points, which means we <em><strong>could</strong></em> fit up to a 12th order polynomial. We can test a few possibilities between first order and fifth order, and we find that a third order polynomial does a good job of smoothly capturing the overall trend in data without fitting the noise, so we’ll use that to provide a polynomial approximation of how concentration changes with time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">############################################################################################</span>
<span class="c1"># Fit a 3rd order polynomial to CA vs t using np.polyfit()                                 #</span>
<span class="c1"># np.polyfit() returns an array of coefficients describing the polynomial                  #</span>
<span class="c1">############################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># We can pass the array of coefficients to np.polyval(A, t)                                #</span>
<span class="c1"># This evaluates the polynomial approximation for CA(t) at times specified by 2nd arg      #</span>
<span class="c1">############################################################################################</span>

<span class="n">CApoly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Overlay regressed polynomial with data; you can see that it describes trend w/o noise    #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CApoly</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;polyfit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (mol/L)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-9.30536131e-10  7.46493506e-07 -2.46443390e-04  4.90969780e-02]
</pre></div>
</div>
<img alt="../_images/61c59bb1d503c662be94cc935e6e3982de978410bb650c7d9be1d3a17080d6c9.png" src="../_images/61c59bb1d503c662be94cc935e6e3982de978410bb650c7d9be1d3a17080d6c9.png" />
</div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">numpy.polyval()</span></code>, there are nice tools in <code class="docutils literal notranslate"><span class="pre">numpy</span></code> that we can use once we have polynomial coefficients. For example, <code class="docutils literal notranslate"><span class="pre">numpy.polyder(A,</span> <span class="pre">m)</span></code> will calculate the analytical derivative of the polynomimal defined by the coefficients in <code class="docutils literal notranslate"><span class="pre">A</span></code>. The order of the derivative (first derivative, second derivative, etc.) is specified by the second argument, <code class="docutils literal notranslate"><span class="pre">m</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Remember: the time derivative of <span class="math notranslate nohighlight">\(C_A\)</span> is equal to <span class="math notranslate nohighlight">\(-r\)</span>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#################################################################################################################</span>
<span class="c1"># print the array of coefficients generated by numpy.polyder(); order of t is implied by number of coefficients #</span>
<span class="c1"># Here we have 4 coefficients, which means we have a 3rd order polynomial                                       #</span>
<span class="c1"># The first coefficient is multiplied by the highest order, the second coefficient by the second highest order  #</span>
<span class="c1"># This pattern proceeds until the last coefficient, which is multiplied by t^0                                  #</span>
<span class="c1">################################################################################################################# </span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

<span class="c1">#################################################################################################################</span>
<span class="c1"># The next line prints the coefficients of the analytical derivative of the 3rd order polynomial                #</span>
<span class="c1">#################################################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="mi">3</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">15.8E</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">15.8E</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="mi">1</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">15.8E</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="mi">0</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s1">15.8E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="c1">#, &#39; &#39;, 2*A[1], &#39; &#39;, 1*A[2], 0*A[3])</span>

<span class="c1">#################################################################################################################</span>
<span class="c1"># Next line prints the coefficients of the derivative of the 3rd order polynomial calculated by numpy.polyder() #</span>
<span class="c1">#################################################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">#should be identical to those calculated by us above</span>

<span class="c1">#################################################################################################################</span>
<span class="c1"># Store the coefficients in a new array -- they themselves define a 2nd order polynomial that describes dCAdt   #</span>
<span class="c1">#################################################################################################################</span>

<span class="n">derivatives</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#################################################################################################################</span>
<span class="c1"># Evaluate the derivative at time points in tdata; these are estimates of the rate of reaction at each t        #</span>
<span class="c1">#################################################################################################################</span>

<span class="n">rate_estimates</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">derivatives</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-9.30536131e-10  7.46493506e-07 -2.46443390e-04  4.90969780e-02]
[-2.79160839E-09  1.49298701E-06 -2.46443390E-04  0.00000000E+00
[-2.79160839e-09  1.49298701e-06 -2.46443390e-04]
</pre></div>
</div>
</div>
</div>
<p>Now that we have estimated the rates by taking a derivative of the polynomial approximation, let’s try our linearization and regression again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rate_estimates</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span> <span class="c1">#we did not use finite differences, so there is 1 rate estimate at each CA</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#This creates the X matrix shown above, truncating at 1st order</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">b</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1] </span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">SEb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the intercept is the second diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">CIb</span>    <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on intercept</span>
<span class="n">α</span>      <span class="o">=</span> <span class="n">m</span>                            <span class="c1">#slope is equal to the reaction order α</span>
<span class="n">k</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>                    <span class="c1">#y intercept is equal to ln(k)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span> <span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;α&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> (but really is between </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">CIb</span><span class="p">)</span><span class="si">:</span><span class="s1">0.2e</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">CIb</span><span class="p">)</span><span class="si">:</span><span class="s1">0.2e</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln (CA) mol/L&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r) mol/L/min&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in ln (r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = 1.75 +/- 0.20
b    = -2.99 +/- 0.72
SSE  = 0.12
SST  = 4.30
MSE  = 0.01
RMSE = 0.10
R2   = 0.97
α    = 1.75 +/- 0.20
k    = 0.05 (but really is between 2.45e-02 and 1.03e-01)
</pre></div>
</div>
<img alt="../_images/23f5407fc30a7db563589e3178be361120eb9fbc6e959d3d536566156910235f.png" src="../_images/23f5407fc30a7db563589e3178be361120eb9fbc6e959d3d536566156910235f.png" />
<img alt="../_images/c87082f03752dfd2ad7e142bd962bc99b6e69d8981f4e8d3755170be41e27fb8.png" src="../_images/c87082f03752dfd2ad7e142bd962bc99b6e69d8981f4e8d3755170be41e27fb8.png" />
</div>
</div>
<p>The estimates of our order and rate constant didn’t change too much, but their precision has improved. It is easier to accept the trend we see here because the fit is so much better.This increases our confidence in the value of each estimate. Based on this revised analysis, we conclude that the reaction order is:</p>
<div class="math notranslate nohighlight">
\[\alpha = 1.8 \pm 0.2\]</div>
<p>If we are restricting ourselves to integer orders (as suggested in the problem statement), we would probably conclude that the rate of reaction is <span class="math notranslate nohighlight">\(2^{nd}\)</span> order in <span class="math notranslate nohighlight">\(A\)</span>. We also would estimate the lumped rate constant from the value of the y-intercept and conclude that it is</p>
<p><span class="math notranslate nohighlight">\(k^\prime = 0.05 \ \mathrm{L \ mol^{-1} \ min^{-1}}\)</span></p>
<p>We have transformed confidence intervals on the y-intercept to an upper bound and lower bound on the rate constant, and a more accurate statement would be that the lumped rate constant is  somewhere between 0.02 and 0.1 L/mol/min. This provides us with a solid foundation and some expectations about parameter estimates, even if they are not extremely precise. Next, we will work through integral analysis (mindful of these insights) and see if our conclusions hold.</p>
</section>
<section id="integral-analysis-with-nonlinear-regression">
<h3>Integral Analysis with nonlinear Regression<a class="headerlink" href="#integral-analysis-with-nonlinear-regression" title="Link to this heading">#</a></h3>
<p>We’ll start with the balance</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime{C_A}^\alpha\]</div>
<p>And we’ll guess integer orders for <span class="math notranslate nohighlight">\(\alpha\)</span> and see what shakes out.  I’m going to try <span class="math notranslate nohighlight">\(\alpha\)</span> = 1, 2, and 3 in this example.</p>
<section id="first-order-solution">
<h4>First Order Solution<a class="headerlink" href="#first-order-solution" title="Link to this heading">#</a></h4>
<p>For a first order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime C_A\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{C_A}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[C_A = C_{A0}\exp\left(-k^\prime t\right)\]</div>
</section>
<section id="second-order-solution">
<h4>Second Order Solution<a class="headerlink" href="#second-order-solution" title="Link to this heading">#</a></h4>
<p>For a second order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime {C_A}^2\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^2}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\]</div>
<p>We can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{C_{A0}} + k^\prime t\right)^{-1}\]</div>
</section>
<section id="third-order-solution">
<h4>Third Order Solution<a class="headerlink" href="#third-order-solution" title="Link to this heading">#</a></h4>
<p>For a third order reaction, the material balance on A in a constant volume reactor becomes:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_A}{dt} = -k^\prime {C_A}^3\]</div>
<p>This is a separable ODE, so we’ll solve it by hand.</p>
<div class="math notranslate nohighlight">
\[\int_{C_{A0}}^{C_A}\frac{1}{{C_A}^3}dC_A = \int_0^t-k^\prime dt\]</div>
<p>Which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{{C_A}^2} = \frac{1}{{C_{A0}}^2} + 2k^\prime t\]</div>
<p>We can rearrange to get:</p>
<div class="math notranslate nohighlight">
\[C_A = \left(\frac{1}{{C_{A0}}^2} + 2k^\prime t\right)^{-\frac{1}{2}}\]</div>
</section>
<section id="summary-of-integrated-models">
<h4>Summary of integrated models<a class="headerlink" href="#summary-of-integrated-models" title="Link to this heading">#</a></h4>
<p>To summarize, we have 3 models to compare to our data:</p>
<p><strong>First Order</strong>: <span class="math notranslate nohighlight">\(C_A = C_{A0}\exp\left(-k^\prime t\right)\)</span></p>
<p><strong>Second Order</strong>: <span class="math notranslate nohighlight">\(\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\)</span></p>
<p><strong>Third Order</strong>: <span class="math notranslate nohighlight">\(C_A = \left(\frac{1}{{C_{A0}}^2} + 2k^\prime t\right)^{-\frac{1}{2}}\)</span></p>
<p>Now let’s overlay those models with our data and run an optimization (nonlinear least squares) to find the best value of the lumped rate constant.  Then, we’ll take a look at how well the model fits our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># The initial concentrations are well-defined and can be set as global constants            #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CA0</span>   <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#mol/L</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for first order kinetics                                             #</span>
<span class="c1">#############################################################################################</span>
<span class="n">CAONE</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k1</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">CA0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for second order kinetics                                            #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CATWO</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k2</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Define CA vs t model for third order kinetics                                             #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CATHREE</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k3</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="nonlinear-least-squares">
<h3>Nonlinear Least Squares<a class="headerlink" href="#nonlinear-least-squares" title="Link to this heading">#</a></h3>
<p>As we considered in L29, the mathematically rigorous way to find the best value of the rate constant is to find the one that gives the “line of best fit” by minimizing the residual sum of squares:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i \left(y_i - \hat{y}_i\right)^2\]</div>
<p>Mean square error is defined as:</p>
<div class="math notranslate nohighlight">
\[MSE = \frac{1}{N}\sum_i (y_i - \hat{y}_i)^2\]</div>
<p>It allows us to normalize error to the number of measurments made. The root mean square is defined as:</p>
<div class="math notranslate nohighlight">
\[RMSE = \sqrt{\frac{1}{N}\sum_i (y_i - \hat{y}_i)^2}\]</div>
<p>And the Mean Absolute Error is defined as:</p>
<div class="math notranslate nohighlight">
\[MAE = \frac{1}{N}\sum_i |y_i - \hat{y}_i|\]</div>
<p>In addition to the SSE, we can also calculate the total sum of squares:</p>
<div class="math notranslate nohighlight">
\[SST = \sum_i \left(y_i - \bar{y}_i\right)^2\]</div>
<p>This can be used to get a coefficient of determination:</p>
<div class="math notranslate nohighlight">
\[R^2 = 1 - \frac{SSE}{SST}\]</div>
<p>If you want to obtain estimates of standard error in the slope and y intercept that you regress, you need to estimate the covariance matrix.  First, we estimate the variance, <span class="math notranslate nohighlight">\(\sigma^2\)</span> with the following:</p>
<div class="math notranslate nohighlight">
\[\sigma^2 \approx s^2\]</div>
<p>and:</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{n_m - n_p}\]</div>
<p>Where <span class="math notranslate nohighlight">\(n_m\)</span> is the number of measurements and <span class="math notranslate nohighlight">\(n_p\)</span> is the number of regressed parameters.  This is also known as the “degrees of freedom” in our regression.</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{DOF}\]</div>
<p>With that, we can estimate the covariance matrix from the Jacobian Matrix:</p>
<div class="math notranslate nohighlight">
\[COV = s^2(J'J)^{-1}\]</div>
<p>The standard error in our regressed parameters is given by the diagonal elements in the following matrix:</p>
<div class="math notranslate nohighlight">
\[se = \sqrt{COV}\]</div>
<p>Noting that this may throw a warning if off-diagonal elements of the covariance matrix are negative.</p>
<p>From that, we get the standard error in our parameter values from the diagonal elements.</p>
<p>If you want to calculate confidence intervals, they are given by:</p>
<div class="math notranslate nohighlight">
\[CI = t(q, DOF)\times SE\]</div>
</section>
<section id="first-order-nonlinear-regression">
<h3>First Order Nonlinear Regression<a class="headerlink" href="#first-order-nonlinear-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">OBJONE</span><span class="p">(</span><span class="n">k1</span><span class="p">):</span>
    <span class="n">CAMOD</span>   <span class="o">=</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">tDATA</span><span class="p">)</span>
    <span class="n">RESID</span>   <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CAMOD</span>
    <span class="n">SSE</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span><span class="w"> </span><span class="nf">JACONE</span><span class="p">(</span><span class="n">k1</span><span class="p">):</span>
    <span class="n">JAC</span>     <span class="o">=</span> <span class="o">-</span><span class="n">CA0</span><span class="o">*</span><span class="n">tDATA</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">k1</span><span class="o">*</span><span class="n">tDATA</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k1 that minimizes the objective function using opt.minimize_scalar()    #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_one</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJONE</span><span class="p">)</span><span class="c1">#, method = &#39;Brent&#39;, bracket = [0.01, 10])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE1</span> <span class="o">=</span> <span class="n">ans_one</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_one</span> <span class="o">=</span> <span class="n">ans_one</span><span class="o">.</span><span class="n">x</span>
<span class="n">k1</span>   <span class="o">=</span> <span class="n">k_one</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k1 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_one</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE1</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 1st order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDONE</span> <span class="o">=</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k_one</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate Jacobian for confidence interval calculations                                   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">JAC1</span>      <span class="o">=</span> <span class="n">JACONE</span><span class="p">(</span><span class="n">k_one</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Statistics                                                                                #</span>
<span class="c1">#############################################################################################</span>

<span class="n">Ndata</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST1</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">MSE1</span>      <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE1</span><span class="p">)</span>
<span class="n">MAE1</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDONE</span><span class="p">))</span>
<span class="n">R21</span>       <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST1</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">s2</span>        <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV1</span>      <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC1</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC1</span><span class="p">)</span>
<span class="n">SEk1</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV1</span><span class="p">)</span> 
<span class="n">tval</span>      <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk1</span>      <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk1</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">SSE1</span><span class="p">,</span> <span class="n">MSE1</span><span class="p">,</span> <span class="n">RMSE1</span><span class="p">,</span> <span class="n">MAE1</span><span class="p">,</span> <span class="n">R21</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk1</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k_one</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, First Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1"># Converting the error to a percentage is not necessary                                     #</span>
<span class="c1"># I chose to convert to a percentage so that residuals for all models are on same y-scale   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDONE</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k =  4.10E-03, SSE = 5.00E-05
k    = 4.10E-03 +/- 3.40E-04
SSE  = 5.00E-05
MSE  = 3.85E-06
RMSE = 1.96E-03
MAE  = 1.65E-03
R2   = 9.59E-01
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\jqbon\AppData\Local\Temp\ipykernel_17992\669969681.py:4: RuntimeWarning: overflow encountered in square
  SSE     = np.sum(RESID**2)
</pre></div>
</div>
<img alt="../_images/27febd69d10b724ed8e667956ebeec70bf26060ae7b9b58031dd2703176527a8.png" src="../_images/27febd69d10b724ed8e667956ebeec70bf26060ae7b9b58031dd2703176527a8.png" />
<img alt="../_images/b3970de2e1fd842346aae39340ef7a3c0edf06d87aac2ff716cc49a7f868e594.png" src="../_images/b3970de2e1fd842346aae39340ef7a3c0edf06d87aac2ff716cc49a7f868e594.png" />
</div>
</div>
<p>Now we have some quantitative assessments of goodness of fit.  For real data, an <span class="math notranslate nohighlight">\(R^2\)</span> of 0.96 or so is pretty good, so for the moment, we’ll call this an acceptable fit.</p>
</section>
<section id="second-order-nonlinear-regression">
<h3>Second Order Nonlinear Regression<a class="headerlink" href="#second-order-nonlinear-regression" title="Link to this heading">#</a></h3>
<p>Now let’s see how a second order model fits the data.  We’ll go ahead and regress the best fit rate constant, plot the result, and calculate some basic statistical data about goodness of fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">OBJTWO</span><span class="p">(</span><span class="n">k2</span><span class="p">):</span>
    <span class="n">CAMOD</span>   <span class="o">=</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">tDATA</span><span class="p">)</span>
    <span class="n">RESID</span>    <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CAMOD</span>
    <span class="n">SSE</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span><span class="w"> </span><span class="nf">JACTWO</span><span class="p">(</span><span class="n">k2</span><span class="p">):</span>     
    <span class="n">JAC</span>     <span class="o">=</span> <span class="o">-</span><span class="n">tdata</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span> <span class="o">+</span> <span class="n">k2</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k2 that minimizes the OBJTWO using opt.minimize_scalar()                #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_two</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTWO</span><span class="p">)</span><span class="c1">#, method = &#39;Brent&#39;, bracket = [0.01, 10])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE2</span>     <span class="o">=</span> <span class="n">ans_two</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_two</span>   <span class="o">=</span> <span class="n">ans_two</span><span class="o">.</span><span class="n">x</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">k_two</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k2 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_two</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE2</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 2nd order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDTWO</span> <span class="o">=</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k_two</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate Jacobian for confidence interval calculations                                   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">JAC2</span>      <span class="o">=</span> <span class="n">JACTWO</span><span class="p">(</span><span class="n">k_two</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Statistics                                                                                #</span>
<span class="c1">#############################################################################################</span>

<span class="n">Ndata</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST2</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">MSE2</span>      <span class="o">=</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE2</span><span class="p">)</span>
<span class="n">MAE2</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTWO</span><span class="p">))</span>
<span class="n">R22</span>       <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">SST2</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">s2</span>        <span class="o">=</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV2</span>      <span class="o">=</span> <span class="n">SSE2</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC2</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC2</span><span class="p">)</span>
<span class="n">SEk2</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV2</span><span class="p">)</span> 
<span class="n">tval</span>      <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk2</span>      <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk2</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k2</span><span class="p">,</span> <span class="n">SSE2</span><span class="p">,</span> <span class="n">MSE2</span><span class="p">,</span> <span class="n">RMSE2</span><span class="p">,</span> <span class="n">MAE2</span><span class="p">,</span> <span class="n">R22</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk2</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k_two</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, Second Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTWO</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k =  1.24E-01, SSE = 1.30E-05
k    = 1.24E-01 +/- 7.16E-03
SSE  = 1.30E-05
MSE  = 1.00E-06
RMSE = 1.00E-03
MAE  = 8.29E-04
R2   = 9.89E-01
</pre></div>
</div>
<img alt="../_images/ee132e91f18ca19f0115a00de9ce07b22257539986b238e95a5fb1fe3b3a835b.png" src="../_images/ee132e91f18ca19f0115a00de9ce07b22257539986b238e95a5fb1fe3b3a835b.png" />
<img alt="../_images/5fe1ca8f48f75caab38bbc00819296f06d85a4159ad26e4987766be50c6e0d9f.png" src="../_images/5fe1ca8f48f75caab38bbc00819296f06d85a4159ad26e4987766be50c6e0d9f.png" />
</div>
</div>
<p>OK, by all metrics–visual, SSE, and <span class="math notranslate nohighlight">\(R^2\)</span>, the second order model improves on the first order model.  Is it the best?  It’s hard to say for sure…let’s try the third order model and see how that goes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">OBJTHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">):</span>
    <span class="n">CAMOD</span>    <span class="o">=</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">,</span> <span class="n">tDATA</span><span class="p">)</span>
    <span class="n">RESID</span>    <span class="o">=</span> <span class="n">CADATA</span> <span class="o">-</span> <span class="n">CAMOD</span>
    <span class="n">SSE</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RESID</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SSE</span>

<span class="k">def</span><span class="w"> </span><span class="nf">JACTHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">):</span>            
    <span class="n">JAC</span>     <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">tdata</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">tdata</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">CA0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">JAC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################################</span>
<span class="c1"># Find the value of k3 that minimizes the OBJTHREE using opt.minimize_scalar()              #</span>
<span class="c1">#############################################################################################</span>

<span class="n">ans_three</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="n">OBJTHREE</span><span class="p">)</span><span class="c1"># Test this; it will throw a warning and not find an optiumum</span>
<span class="c1"># ans_three = opt.minimize_scalar(OBJTHREE, method = &#39;Bounded&#39;, bounds = [0.00001, 1])</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .fun field in the solution structure is the minimum value of the objective function   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">SSE3</span>      <span class="o">=</span> <span class="n">ans_three</span><span class="o">.</span><span class="n">fun</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># the .x field in the solution structure is the value of k that minimizes the obj function  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">k_three</span>   <span class="o">=</span> <span class="n">ans_three</span><span class="o">.</span><span class="n">x</span>
<span class="n">k3</span> <span class="o">=</span> <span class="n">k_three</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># print the optimum k3 and SSE                                                              #</span>
<span class="c1">#############################################################################################</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">k = </span><span class="si">{</span><span class="n">k_three</span><span class="si">:</span><span class="s1">9.2E</span><span class="si">}</span><span class="s1">, SSE = </span><span class="si">{</span><span class="n">SSE3</span><span class="si">:</span><span class="s1">7.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Pass optimum rate constant to a 2nd order model to generate CA_pred at tdata values       #</span>
<span class="c1">#############################################################################################</span>

<span class="n">CAPREDTHREE</span> <span class="o">=</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k_three</span><span class="p">,</span> <span class="n">tdata</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Calculate Jacobian for confidence interval calculations                                   #</span>
<span class="c1">#############################################################################################</span>

<span class="n">JAC3</span>      <span class="o">=</span> <span class="n">JACTHREE</span><span class="p">(</span><span class="n">k_three</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Statistics                                                                                #</span>
<span class="c1">#############################################################################################</span>

<span class="n">Ndata</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
<span class="n">CAbar</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">SST3</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAbar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">MSE3</span>      <span class="o">=</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">Ndata</span>
<span class="n">RMSE3</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE3</span><span class="p">)</span>
<span class="n">MAE3</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Ndata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTHREE</span><span class="p">))</span>
<span class="n">R23</span>       <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">SST3</span>
<span class="n">DOF</span>       <span class="o">=</span> <span class="n">Ndata</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">s2</span>        <span class="o">=</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV3</span>      <span class="o">=</span> <span class="n">SSE3</span><span class="o">/</span><span class="n">DOF</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">JAC3</span><span class="o">.</span><span class="n">T</span><span class="nd">@JAC3</span><span class="p">)</span>
<span class="n">SEk3</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV3</span><span class="p">)</span> 
<span class="n">tval</span>      <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>
<span class="n">CIk3</span>      <span class="o">=</span> <span class="n">tval</span><span class="o">*</span><span class="n">SEk3</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">k3</span><span class="p">,</span> <span class="n">SSE3</span><span class="p">,</span> <span class="n">MSE3</span><span class="p">,</span> <span class="n">RMSE3</span><span class="p">,</span> <span class="n">MAE3</span><span class="p">,</span> <span class="n">R23</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk3</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.2E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Overlay best fit model with data                                                          #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k_three</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Best Fit, Third Order&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#############################################################################################</span>
<span class="c1"># Generate plot of residual errors -- calculate residuals as percent error                  #</span>
<span class="c1">#############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAdata</span> <span class="o">-</span> <span class="n">CAPREDTHREE</span><span class="p">)</span><span class="o">/</span><span class="n">CAdata</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Residual Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Zero Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k =  3.67E+00, SSE = 4.62E-05
k    = 3.67E+00 +/- 5.10E-01
SSE  = 4.62E-05
MSE  = 3.55E-06
RMSE = 1.88E-03
MAE  = 1.52E-03
R2   = 9.63E-01
</pre></div>
</div>
<img alt="../_images/7ba2d46b2a85790eed7871a54ee0747762c0ac605ded6691f96632540cc06cda.png" src="../_images/7ba2d46b2a85790eed7871a54ee0747762c0ac605ded6691f96632540cc06cda.png" />
<img alt="../_images/396297dccffdbc5c19476dbfc01ece707f32682436902cb4c163c0bf752b6a89.png" src="../_images/396297dccffdbc5c19476dbfc01ece707f32682436902cb4c163c0bf752b6a89.png" />
</div>
</div>
<p>Alright…looks like we’ve gone a little too far.  The third order model is slightly better than the first order model and slightly worse than the second order model.  Any of them probably do an OK job of fitting the data, but quantitatively, the second order model is probably just a bit better.</p>
<p>As we discussed during Lecture 29, it can be really hard to tell whether or not a model is “correct” just by visual inspection.  All of the above, in isolation, seem to fit the data pretty well. We’ll overlay all three where you can start to see that the second order model does the best.  Then, we’ll look at linearized models if we can to see if we can see some deviation from linearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Overlay best fit models with data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tdata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CAONE</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span>  <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>  <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;First Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATWO</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Second Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">CATHREE</span><span class="p">(</span><span class="n">k3</span><span class="p">,</span> <span class="n">tfine</span><span class="p">),</span>  <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>   <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Third Order Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (min)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tdata</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dae506affb83eaa41765b46431087f3c520251154df6403543ba9c8982986b2a.png" src="../_images/dae506affb83eaa41765b46431087f3c520251154df6403543ba9c8982986b2a.png" />
</div>
</div>
</section>
<section id="linearization-of-data">
<h3>Linearization of Data<a class="headerlink" href="#linearization-of-data" title="Link to this heading">#</a></h3>
<section id="first-order-linearization">
<h4>First Order Linearization<a class="headerlink" href="#first-order-linearization" title="Link to this heading">#</a></h4>
<p>For the first order model, we have:</p>
<div class="math notranslate nohighlight">
\[C_A = C_{A0}\exp(-k^\prime t)\]</div>
<p>This is a nonlinear function of, essentially kt; however, if we take the natural logarithm of both sides, we convert it to the following, which is much more useful:</p>
<div class="math notranslate nohighlight">
\[\ln\left(C_A\right) = \ln\left(C_{A0}\right) - k^\prime t\]</div>
<p>If we plot <span class="math notranslate nohighlight">\(C_A\)</span> against time, that should be linear if the first order model is correct.  The slope would be equal to -k, and the y-intercept would be ln(CA0).</p>
<p>This is plotted in the cell below, where you observe linearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">tdata</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#This creates the X matrix shown above, truncating at 1st order</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">b</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1] </span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">SEb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the intercept is the second diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">CIb</span>    <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on intercept</span>
<span class="n">k1</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">m</span>                         <span class="c1">#slope is equal to the -k</span>
<span class="n">CA0e</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>                    <span class="c1">#y intercept is equal to ln(CA0)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;k1&#39;</span><span class="p">,</span> <span class="s1">&#39;CA0&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span><span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">CA0e</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(CA) mol/L&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="c1"># plt.ylim(-0.08, 0.08)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in ln (CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = -0.0034 +/- 0.0004
b    = -3.0924 +/- 0.0642
SSE  = 0.0340
SST  = 1.3711
MSE  = 0.0026
RMSE = 0.0512
R2   = 0.9752
k1   = 0.0034
CA0  = 0.0454
</pre></div>
</div>
<img alt="../_images/23c02a19abf635e7228d911e780c901cd5e4dfc8f616d2da303320a4198637af.png" src="../_images/23c02a19abf635e7228d911e780c901cd5e4dfc8f616d2da303320a4198637af.png" />
<img alt="../_images/e756ace92f3689bd95b1af26ced72860f87478772561ef911cf58f8ca843c417.png" src="../_images/e756ace92f3689bd95b1af26ced72860f87478772561ef911cf58f8ca843c417.png" />
</div>
</div>
<p><strong>Second Order Model</strong></p>
<p>For the second order model, we have:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + kt\]</div>
<p>We should see linearity here if we plot <span class="math notranslate nohighlight">\(\frac{1}{C_A}\)</span> vs <span class="math notranslate nohighlight">\(t\)</span>.  See below; this model clearly shows less deviation from linearity than the first order linearization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">CAdata</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">tdata</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#This creates the X matrix shown above, truncating at 1st order</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">b</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1] </span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">SEb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the intercept is the second diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">CIb</span>    <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on intercept</span>
<span class="n">k2</span>     <span class="o">=</span> <span class="n">m</span>                            <span class="c1">#slope is equal to k</span>
<span class="n">CA0e</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">b</span>                          <span class="c1">#y intercept is equal to 1/CA0</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">,</span> <span class="s1">&#39;CA0&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span><span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">CA0e</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k2&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1/CA L/mol&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in 1/CA&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = 0.1255 +/- 0.0077
b    = 19.9145 +/- 1.3604
SSE  = 15.2968
SST  = 1807.5804
MSE  = 1.1767
RMSE = 1.0847
R2   = 0.9915
k2   = 1.2552E-01
CA0  = 0.0502
</pre></div>
</div>
<img alt="../_images/2844fb2e2f04af42cbd51ce93f27fd94a8598b8a648e88edc6f585919252941e.png" src="../_images/2844fb2e2f04af42cbd51ce93f27fd94a8598b8a648e88edc6f585919252941e.png" />
<img alt="../_images/20d1a864e2295d04811375971b488146afcb3e268c3cd044f2d06e036c0f7bee.png" src="../_images/20d1a864e2295d04811375971b488146afcb3e268c3cd044f2d06e036c0f7bee.png" />
</div>
</div>
<p>I like the second order fit!  I can see scatter around the line of best fit instead of a systematic deviation like in the first order model. Let’s check the third order linearization just to see if the second order model still looks better.</p>
<p>For the third order model, we have a slightly different linearization that is based on this form of the integrated model:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{{C_A}^2} = \frac{1}{{C_{A0}}^2} + 2k^\prime t\]</div>
<p>If we plot <span class="math notranslate nohighlight">\(\frac{1}{{C_A}^2}\)</span> vs time, we should see linearity if the third order model is correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">CAdata</span><span class="o">**</span><span class="mi">2</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">tdata</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#This creates the X matrix shown above, truncating at 1st order</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">b</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1] </span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">SEb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the intercept is the second diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">CIb</span>    <span class="o">=</span> <span class="n">SEb</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on intercept</span>
<span class="n">k3</span>     <span class="o">=</span> <span class="n">m</span>                            <span class="c1">#slope is equal to k</span>
<span class="n">CIk3</span>   <span class="o">=</span> <span class="n">CIm</span>                          <span class="c1">#confidence interval on k3</span>
<span class="n">CA0e</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>               <span class="c1">#y intercept is equal to 1/2CA0^2</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;k3&#39;</span><span class="p">,</span> <span class="s1">&#39;CA0&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span><span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">CA0e</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k3&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk3</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="c1"># plt.ylim(0, 0.5)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1/2/CA^2&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in 1/2/CA^2&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = 4.8818E+00 +/- 5.8369E-01
b    = 8.7767E+01 +/- 1.0318E+02
SSE  = 87997.1295
SST  = 2798897.9361
MSE  = 6769.0100
RMSE = 82.2740
R2   = 0.9686
k3   = 4.8818E+00 +/- 5.8369E-01
CA0  = 0.0755
</pre></div>
</div>
<img alt="../_images/cceda85903e0428480669cf7d67dc135676e3bfe167facf88311b1c27d202641.png" src="../_images/cceda85903e0428480669cf7d67dc135676e3bfe167facf88311b1c27d202641.png" />
<img alt="../_images/f02b5db93af2b2d855fdf522e3c3748d17d015d41736243f5cdd95adb4db8cb9.png" src="../_images/f02b5db93af2b2d855fdf522e3c3748d17d015d41736243f5cdd95adb4db8cb9.png" />
</div>
</div>
<p>From everything we’ve done to this point, we can be fairly confident in concluding that our reaction is second order in species <span class="math notranslate nohighlight">\(A\)</span>, so our rate law is:</p>
<div class="math notranslate nohighlight">
\[r = k^\prime {C_A}^2\]</div>
<p>Remember, way back when we started this problem, that we defined <span class="math notranslate nohighlight">\(k^\prime\)</span> as a lumped rate constant:</p>
<div class="math notranslate nohighlight">
\[k^\prime = kC_{B0}\]</div>
<p>We know that the starting concentration of <span class="math notranslate nohighlight">\(B\)</span> in this system was <span class="math notranslate nohighlight">\(C_{B0} = 0.5 \ \mathrm{M}\)</span>, so we can calculate the true rate constant as:</p>
<div class="math notranslate nohighlight">
\[k = \frac{k^\prime}{C_{B0}}\]</div>
<p>And our final rate law is:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^2{C_B}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Our most precise estimate of the lumped rate constant is </span><span class="si">{</span><span class="n">k2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> L/mol/min&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The true rate constant is </span><span class="si">{</span><span class="n">k2</span><span class="o">/</span><span class="mf">0.5</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> L^2 mol^-2 min^-1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our most precise estimate of the lumped rate constant is 0.126 L/mol/min
The true rate constant is 0.251 L^2 mol^-2 min^-1
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="if-time-allows-we-can-come-back-to-this-point">
<h3>If Time Allows, we can come back to this point<a class="headerlink" href="#if-time-allows-we-can-come-back-to-this-point" title="Link to this heading">#</a></h3>
<p>Considering all of the analysis, the second order model seems to fit the data best.  Since we know that the initial value of <span class="math notranslate nohighlight">\(C_{A0}\)</span> is 0.05M, we can improve our precision on the rate constant estimation slightly by choosing to not regress the y-intercept.  We can do that by rearranging our linearization slightly:</p>
<p>Instead of working with:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} = \frac{1}{C_{A0}} + k^\prime t\]</div>
<p>And plotting <span class="math notranslate nohighlight">\(\frac{1}{C_A}\)</span> vs. time, we will work with this form:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{C_A} - \frac{1}{C_{A0}} = k^\prime t\]</div>
<p>And we will plot <span class="math notranslate nohighlight">\(\frac{1}{C_A} - \frac{1}{C_{A0}}\)</span> vs time. Alternatively, you could work with this form; either should give you a linear model with a zero y intercept:</p>
<div class="math notranslate nohighlight">
\[\frac{(C_{A0} - C_A)}{C_{A0}C_A} = k^\prime t\]</div>
<p>I’ll use the first form to construct the matrix form of our linear least squares problem:</p>
<div class="math notranslate nohighlight">
\[\alpha_1t = \frac{1}{C_A} - \frac{1}{C_{A0}}\]</div>
<div class="math notranslate nohighlight">
\[XA = Y\]</div>
<p>Where X is a vandermonde matrix created from tdata; however, we only keep the first order powers of time here (since there is no zero order coefficient in the model).  Y, in this case, is <span class="math notranslate nohighlight">\(\frac{1}{C_A} - \frac{1}{C_{A0}}\)</span>, and A is only a single coefficient, namely the slope of the line.  See below for implementation.  We can’t use polyfit here, but if we know how to work with the vandermonde matrix, we have a lot of flexibility in regressions.  This is similar to what you can do with the LINEST function in Excel.</p>
<p>We’ll leave the discussion of calculating standard error and confidence intervals for another day (or maybe explore sklearn utilities a bit).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#####################################################################################################</span>
<span class="c1"># Make sure that we have the correct definition for CA0                                             #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">CA0</span>   <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#M</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the xdata array and ydata array                                                            #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">ydata</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">CADATA</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">CA0</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Define the X matrix and Y array                                                                   #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Y</span>     <span class="o">=</span> <span class="n">ydata</span>
<span class="n">X</span>     <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#####################################################################################################</span>
<span class="c1"># Solve the least squares problem to find the best fit coefficients                                 #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> 

<span class="c1">#####################################################################################################</span>
<span class="c1"># Workup and analysis for quantifying and visualizing goodness of fit                               #</span>
<span class="c1">#####################################################################################################</span>

<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>                          <span class="c1">#Calculate discrete array of predicted y values at each x value</span>
<span class="n">Ybar</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>               <span class="c1">#Calculate the mean of the measured y values, use for SST calculation</span>
<span class="n">Ndata</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>                   <span class="c1">#Calculate the number of data points/measurementws</span>
<span class="n">SSE1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1">#Calculate residual sum of squares using intuitive summation formula</span>
<span class="n">SSE2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>        <span class="c1">#Calculate residual sum of squares using matrix multiplication; equivalent to SSE1</span>
<span class="n">SST</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ybar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>        <span class="c1">#Calculate total sum of squares; assumes model is just y_pred = mean(ydata)</span>
<span class="n">MSE</span>    <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">Ndata</span>                   <span class="c1">#Calculate mean square error</span>
<span class="n">RMSE</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                 <span class="c1">#Calculate root mean square error</span>
<span class="n">R2</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">SST</span>                 <span class="c1">#Calculate R2 (coefficient of determination)</span>
<span class="n">DOF</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>          <span class="c1">#Count degrees of freedom</span>
<span class="n">s2</span>     <span class="o">=</span> <span class="n">SSE1</span><span class="o">/</span><span class="n">DOF</span>                     <span class="c1">#Estimate variance</span>
<span class="n">COV</span>    <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">)</span>      <span class="c1">#Generate the covariance matrix for this fit</span>
<span class="n">m</span>      <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1">#This is a linear model; with the way we define the X matrix, slope is A[0], intercept is A[1]</span>
<span class="n">SEm</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">COV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>           <span class="c1">#For our definition of the X matrix, standard error in the slope is the first diagonal element in COV</span>
<span class="n">tval</span>   <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">DOF</span><span class="p">)</span>      <span class="c1">#t distribution for 95% confidence interval t(1 - α/2, DOF), α = 0.05 for 95% confidence interval</span>
<span class="n">CIm</span>    <span class="o">=</span> <span class="n">SEm</span><span class="o">*</span><span class="n">tval</span>                     <span class="c1">#confidence interval on slope</span>
<span class="n">k2b</span>    <span class="o">=</span> <span class="n">m</span>                            <span class="c1">#slope is equal to k</span>
<span class="n">CIk2b</span>  <span class="o">=</span> <span class="n">CIm</span>                          <span class="c1">#Confidence interval on k3   </span>

<span class="c1">############################################################################################</span>
<span class="c1"># Printing results using f strings; create arrays of labels and values                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="s1">&#39;SST&#39;</span><span class="p">,</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span>  <span class="p">,</span>  <span class="n">b</span> <span class="p">,</span>  <span class="n">SSE1</span><span class="p">,</span>  <span class="n">SST</span> <span class="p">,</span> <span class="n">MSE</span> <span class="p">,</span> <span class="n">RMSE</span> <span class="p">,</span>  <span class="n">R2</span> <span class="p">,</span>  <span class="n">k2b</span><span class="p">]</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIm</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIb</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;k2&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">CIk2b</span><span class="si">:</span><span class="s1">0.4E</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s1">4s</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; overlay data and regressed y(x)                                     #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;experimental rates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1/CA&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">############################################################################################</span>
<span class="c1"># Visualizing results; plot of residual errors                                             #</span>
<span class="c1">############################################################################################</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Ypred</span><span class="p">)</span><span class="o">/</span><span class="n">Y</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;residual error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;zero error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Residual Error in 1/CA&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>m    = 1.2511E-01 +/- 3.8629E-03
b    = 8.7767E+01 +/- 1.0318E+02
SSE  = 15.3234
SST  = 1807.5804
MSE  = 1.1787
RMSE = 1.0857
R2   = 0.9915
k2   = 1.2511E-01 +/- 3.8629E-03
</pre></div>
</div>
<img alt="../_images/73aa2a8cf7169d6a1f71fc7ddc683d3e7e39e1f20a2b2db60071a120806e6ae0.png" src="../_images/73aa2a8cf7169d6a1f71fc7ddc683d3e7e39e1f20a2b2db60071a120806e6ae0.png" />
<img alt="../_images/9109d55e66750f0f055afbf0ba630b7125d6422e02599f4c73e1fcf5905802c4.png" src="../_images/9109d55e66750f0f055afbf0ba630b7125d6422e02599f4c73e1fcf5905802c4.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../Chapter2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lectures</p>
      </div>
    </a>
    <a class="right-next"
       href="587-N43.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Kinetics IV</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-problem-01">Example Problem 01</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-to-example-problem-01">Solution to Example Problem 01</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differential-analysis">Differential Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integral-analysis-with-nonlinear-regression">Integral Analysis with nonlinear Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-solution">First Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-solution">Second Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-order-solution">Third Order Solution</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-integrated-models">Summary of integrated models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-least-squares">Nonlinear Least Squares</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-nonlinear-regression">First Order Nonlinear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#second-order-nonlinear-regression">Second Order Nonlinear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linearization-of-data">Linearization of Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-order-linearization">First Order Linearization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-time-allows-we-can-come-back-to-this-point">If Time Allows, we can come back to this point</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>