
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lecture 31 &#8212; Kinetics and Reaction Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 32" href="587-L32.html" />
    <link rel="prev" title="Lecture 28" href="587-L28.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/JQB.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Kinetics and Reaction Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to CEN 587!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter1.html">
   Python Supplements
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S01.html">
     The Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S02.html">
     Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S03.html">
     Arrays and Matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S04.html">
     For Loops, Vectorization, and Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S05.html">
     Logical Tests and Comparisons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S06.html">
     While Loops in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S07.html">
     Functions, D&amp;D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S08.html">
     The Probability of the Fall of Acererak
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S09.html">
     Root Finding: Univariate Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S10.html">
     Minimizing a Univariate Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S11.html">
     Minimization of Multivariate Functoins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S12.html">
     Solving Systems of Nonlinear Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S13.html">
     Least Squares Revisited:
     <code class="docutils literal notranslate">
      <span class="pre">
       opt.least_squares()
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S14.html">
     Numerical Solution of Ordinary Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Supplements/587-S15.html">
     Quadrature
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../Chapter2.html">
   Lectures
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="587-L01.html">
     Lecture 01: Introduction and Stoichiometry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L02.html">
     Lecture 02: Extent and Conversion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L03.html">
     Lecture 03: Numerical methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L04.html">
     Lecture 04: Chemical Equilibrium Part 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L05.html">
     Lecture 05: Chemical Equilibrium Part 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L06.html">
     Lecture 06
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L07.html">
     Lecture 07: Ammonia Equilibrium - Part 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L08.html">
     Lecture 08: Multi-reaction equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L09.html">
     Lecture 09: Chemical and Phase equilibria
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L10.html">
     Lecture 10
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L11.html">
     Lecture 11
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L12.html">
     Lecture 12
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L13.html">
     Lecture 13
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L14.html">
     Lecture 14
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L15.html">
     Lecture 15
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L16.html">
     Lecture 16
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L17.html">
     Lecture 17
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L18.html">
     Lecture 18
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L19.html">
     Lecture 19
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L20.html">
     Lecture 20
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L22.html">
     Lecture 22
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L23.html">
     Lecture 23
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L24.html">
     Lecture 24
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L25.html">
     Lecture 25
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L26.html">
     Lecture 26
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L27.html">
     Lecture 27
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L28.html">
     Lecture 28
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Lecture 31
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L32.html">
     Lecture 32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L33.html">
     Lecture 33
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L34.html">
     Lecture 34
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L35.html">
     Lecture 35
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L36.html">
     Lecture 36
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L37.html">
     Lecture 37
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L38.html">
     Lecture 36
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L39.html">
     Lecture 39
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L40.html">
     Lecture 40
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L41.html">
     Lecture 41
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L42.html">
     Lecture 42
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="587-L43.html">
     Lecture 43
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3.html">
   Recitations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jqbond/AICHE2022_Python/main?urlpath=tree/Lectures/587-L31.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jqbond/AICHE2022_Python"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jqbond/AICHE2022_Python/issues/new?title=Issue%20on%20page%20%2FLectures/587-L31.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Lectures/587-L31.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-01">
   Example Problem 01
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-to-example-problem-01">
     Solution to Example Problem 01
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#estimation-of-reaction-rates-in-a-cstr-at-steady-state">
       Estimation of reaction rates in a CSTR at Steady State
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analysis-of-perfect-data">
       Analysis of Perfect Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assessing-linearity-in-rate-data">
       Assessing linearity in rate data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analysis-of-more-realistic-data">
       Analysis of more realistic data…
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-regression-on-data-rounded-to-instrument-precision">
       Linear Regression on Data Rounded to Instrument Precision
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adding-noise-to-the-data-simulating-a-real-experiment">
       Adding Noise to the Data (simulating a real experiment)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-02">
   Example Problem 02
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameter-estimation-using-nonlinear-regression">
     Parameter Estimation Using Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-linear-regression">
     Multiple Linear Regression
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Lecture 31</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-01">
   Example Problem 01
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-to-example-problem-01">
     Solution to Example Problem 01
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#estimation-of-reaction-rates-in-a-cstr-at-steady-state">
       Estimation of reaction rates in a CSTR at Steady State
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analysis-of-perfect-data">
       Analysis of Perfect Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assessing-linearity-in-rate-data">
       Assessing linearity in rate data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analysis-of-more-realistic-data">
       Analysis of more realistic data…
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-regression-on-data-rounded-to-instrument-precision">
       Linear Regression on Data Rounded to Instrument Precision
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adding-noise-to-the-data-simulating-a-real-experiment">
       Adding Noise to the Data (simulating a real experiment)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-problem-02">
   Example Problem 02
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameter-estimation-using-nonlinear-regression">
     Parameter Estimation Using Nonlinear Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-linear-regression">
     Multiple Linear Regression
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-31">
<h1>Lecture 31<a class="headerlink" href="#lecture-31" title="Permalink to this headline">#</a></h1>
<p>Today, we’ll discuss analysis of kinetic data obtained in a CSTR.  We’ll consider the impacts of measurement error and how it can be managed, and we’ll also discuss how to work with a maddening set of data that were not obtained very systematically…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
</pre></div>
</div>
</div>
</div>
<section id="example-problem-01">
<h2>Example Problem 01<a class="headerlink" href="#example-problem-01" title="Permalink to this headline">#</a></h2>
<p>Analysis of Data obtained in a CSTR</p>
<p>The following reaction is carried out in a 0.275L CSTR at steady state.  The experiment is performed by varying the inlet volumetric flowrate (Q<span class="math notranslate nohighlight">\(_f\)</span>) of a solution that always has a concentration <span class="math notranslate nohighlight">\(C_{A_f}\)</span> = 10 mol L<span class="math notranslate nohighlight">\(^{-1}\)</span>.  You may assume the fluid density is constant so that <span class="math notranslate nohighlight">\(Q = Q_f\)</span>.</p>
<div class="math notranslate nohighlight">
\[A \longrightarrow B\]</div>
<p>You measure the concentration of species A and species B in the effluent stream from the reactor.  The data are compiled in the table below. For now, we’ll look at essentially perfect data just to get a feel for the way that we handle the analysis without also dealing with precision and measurement uncertainty.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><strong>Q<span class="math notranslate nohighlight">\(_f\)</span> (L/sec)</strong></p></th>
<th class="text-align:center head"><p><strong>C<span class="math notranslate nohighlight">\(_A\)</span> (mol/L)</strong></p></th>
<th class="text-align:center head"><p><strong>C<span class="math notranslate nohighlight">\(_B\)</span> (mol/L)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>2.750</p></td>
<td class="text-align:center"><p>9.98</p></td>
<td class="text-align:center"><p>2.29 x 10<span class="math notranslate nohighlight">\(^{-2}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>5.500 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
<td class="text-align:center"><p>9.89</p></td>
<td class="text-align:center"><p>1.14 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>3.667 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
<td class="text-align:center"><p>9.83</p></td>
<td class="text-align:center"><p>1.70 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>2.750 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
<td class="text-align:center"><p>9.78</p></td>
<td class="text-align:center"><p>2.25 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>1.375 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
<td class="text-align:center"><p>9.56</p></td>
<td class="text-align:center"><p>4.40 x 10<span class="math notranslate nohighlight">\(^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>5.500 x 10<span class="math notranslate nohighlight">\(^{-2}\)</span></p></td>
<td class="text-align:center"><p>8.97</p></td>
<td class="text-align:center"><p>1.03</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>2.750 x 10<span class="math notranslate nohighlight">\(^{-2}\)</span></p></td>
<td class="text-align:center"><p>8.13</p></td>
<td class="text-align:center"><p>1.87</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>1.833 x 10<span class="math notranslate nohighlight">\(^{-2}\)</span></p></td>
<td class="text-align:center"><p>7.43</p></td>
<td class="text-align:center"><p>2.57</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>1.375 x 10<span class="math notranslate nohighlight">\(^{-2}\)</span></p></td>
<td class="text-align:center"><p>6.85</p></td>
<td class="text-align:center"><p>3.15</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>5.500 x 10<span class="math notranslate nohighlight">\(^{-3}\)</span></p></td>
<td class="text-align:center"><p>4.65</p></td>
<td class="text-align:center"><p>5.35</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>2.750 x 10<span class="math notranslate nohighlight">\(^{-3}\)</span></p></td>
<td class="text-align:center"><p>3.03</p></td>
<td class="text-align:center"><p>6.97</p></td>
</tr>
</tbody>
</table>
<p>Assuming the reaction rate is described by power law kinetics,</p>
<div class="math notranslate nohighlight">
\[r = kC_A^{\alpha}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is an integer, use the measured concentrations of A in the reactor effluent to determine the reaction order in A and the rate constant for this reaction.</p>
<section id="solution-to-example-problem-01">
<h3>Solution to Example Problem 01<a class="headerlink" href="#solution-to-example-problem-01" title="Permalink to this headline">#</a></h3>
<p>Let’s stick with our conventional wisdom that, if we want to determine the reaction order with respect to A, we need to know how the rate of reaction changes in response to the concentration of species A.  This is easiest to do if everything else is constant.  Fortunately, these reactions are performed at constant temperature and in a solvent, so the fluid density is constant.  Also, we know from the problem statement that the rate of reaction <em><strong>does not</strong></em> depend on B.  This allows us to focus on how changing the concentration of A will impact the rate of reaction.</p>
<section id="estimation-of-reaction-rates-in-a-cstr-at-steady-state">
<h4>Estimation of reaction rates in a CSTR at Steady State<a class="headerlink" href="#estimation-of-reaction-rates-in-a-cstr-at-steady-state" title="Permalink to this headline">#</a></h4>
<p>As with a batch reactor, the starting point for this analysis is a material balance.  We’ll choose to work with a balance on A. The problem statement requests information about the order in A, so this is a sensible approach.</p>
<p>For a CSTR at steady state:</p>
<div class="math notranslate nohighlight">
\[0 = F_{A,f} - F_{A} + R_AV\]</div>
<p>We are given data about concentrations and volumetric flowrates, so I’ll recast this balance in terms of those parameters:</p>
<div class="math notranslate nohighlight">
\[0 = C_{A,f}Q_f - C_AQ_f + R_AV\]</div>
<p>Dividing through by the feed volumetric flowrate, we get:</p>
<div class="math notranslate nohighlight">
\[0 = C_{A,f} - C_A + R_A\tau\]</div>
<p>Finally, recognizing that we have a single reaction here, we can make the substitution that <span class="math notranslate nohighlight">\(R_A = -r\)</span>:</p>
<div class="math notranslate nohighlight">
\[0 = C_{A,f} - C_A - r\tau\]</div>
<p>And we can solve that balance for r to get:</p>
<div class="math notranslate nohighlight">
\[r = \frac{C_{A,f} - C_A}{\tau}\]</div>
<p>Interesting – in a CSTR, dividing <span class="math notranslate nohighlight">\(\Delta C_A\)</span> by <span class="math notranslate nohighlight">\(\Delta \tau\)</span> gives us a direct calculation of reaction rate at the concentration inside of the CSTR (rather than a finite difference approximation like in a batch reactor).  That seems promising…</p>
<p>Once we have a reaction rate calculated, it reflects the conditions inside the CSTR, which is a well-mixed reactor.  That means that solving this equation for each experimental condition will give us a set of reaction rates measured at various concentrations of A.</p>
</section>
<section id="analysis-of-perfect-data">
<h4>Analysis of Perfect Data<a class="headerlink" href="#analysis-of-perfect-data" title="Permalink to this headline">#</a></h4>
<p>First, we’ll analyze the data set that I generated by solving the material balance for known kinetics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V</span>       <span class="o">=</span> <span class="mf">0.275</span> <span class="c1">#L</span>
<span class="n">CAf</span>     <span class="o">=</span> <span class="mi">10</span>    <span class="c1">#mol/L</span>
<span class="n">Qftrue</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.7500000000</span><span class="p">,</span> <span class="mf">0.5500000000</span><span class="p">,</span> <span class="mf">0.3666666667</span><span class="p">,</span> <span class="mf">0.2750000000</span><span class="p">,</span> <span class="mf">0.1375000000</span><span class="p">,</span> <span class="mf">0.0550000000</span><span class="p">,</span> <span class="mf">0.0275000000</span><span class="p">,</span> <span class="mf">0.0183333333</span><span class="p">,</span> <span class="mf">0.0137500000</span><span class="p">,</span> <span class="mf">0.0055000000</span><span class="p">,</span> <span class="mf">0.0027500000</span><span class="p">])</span> <span class="c1">#L/sec</span>
<span class="n">CAtrue</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.9770527786</span><span class="p">,</span> <span class="mf">9.8863074642</span><span class="p">,</span> <span class="mf">9.8304251659</span><span class="p">,</span> <span class="mf">9.7751710655</span><span class="p">,</span> <span class="mf">9.5602294455</span><span class="p">,</span> <span class="mf">8.9686098655</span><span class="p">,</span> <span class="mf">8.1300813008</span><span class="p">,</span> <span class="mf">7.4349442379</span><span class="p">,</span> <span class="mf">6.8493150685</span><span class="p">,</span> <span class="mf">4.6511627907</span><span class="p">,</span> <span class="mf">3.0303030303</span><span class="p">])</span> <span class="c1">#mol/L</span>
<span class="n">tautrue</span> <span class="o">=</span> <span class="n">V</span><span class="o">/</span><span class="n">Qftrue</span>
<span class="n">rtrue</span>   <span class="o">=</span> <span class="p">(</span><span class="n">CAf</span> <span class="o">-</span> <span class="n">CAtrue</span><span class="p">)</span><span class="o">/</span><span class="n">tautrue</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tautrue</span><span class="p">,</span> <span class="n">CAtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;tau (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CA vs. space time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">rtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;rate (M/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rtrue</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.51</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L31_4_0.png" src="../_images/587-L31_4_0.png" />
<img alt="../_images/587-L31_4_1.png" src="../_images/587-L31_4_1.png" />
<img alt="../_images/587-L31_4_2.png" src="../_images/587-L31_4_2.png" />
</div>
</div>
</section>
<section id="assessing-linearity-in-rate-data">
<h4>Assessing linearity in rate data<a class="headerlink" href="#assessing-linearity-in-rate-data" title="Permalink to this headline">#</a></h4>
<p>Well, that looks linear, suggesting we have power law kinetics, though the reaction order is unknown currently.  We can estimate the reaction order and the rate constant by linear regression, which I implemented below using standard matrix notation that would be in your statistics textbook from CEN 212.  As a refresher, we’re solving this problem:</p>
<div class="math notranslate nohighlight">
\[XA = Y\]</div>
<p>Where X is the truncated Vandermonde matrix up to whatever order we’re considering (here, it is up to first order).  A is the matrix of polynomial coefficients.  Here it is of length 2 because we are fitting a first order equation to the data, so, the slope of the line is given by A[0], and the y-intercept is given by A[1]. Y is a vector of our measurements.</p>
<p>In our linearized model, our “X” values are given by ln(CA), and our Y values are given by ln(r).</p>
<p>The X matrix is “tall” here.  It has 6 rows (because we made six measurements), but only 2 columns (because we only have a first order model with two coefficients).  The Y vector is a 6x1 column.  This system is overdetermined, and there is no single line that will pass through all data points.  There is however a unique least squares solution that gives the line that models all data points with minimum residual error.  That is given by:</p>
<div class="math notranslate nohighlight">
\[\hat{A} = (X^\prime X)^{-1}X^\prime Y\]</div>
<p>Which, in numpy would be solved either as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span>
</pre></div>
</div>
<p>Or the convenience least squares solution in numpy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>I use the first one because I just do all the linear regression calculations and definitions manually. We calculate the residual sum of squares as usual:</p>
<div class="math notranslate nohighlight">
\[SSE = \sum_i (y_i - \hat{y}_i)^2\]</div>
<p>Which, for a linear regression problem is equivalent to:</p>
<div class="math notranslate nohighlight">
\[SSE = (Y - XA)'(Y - XA)\]</div>
<p>In numpy that would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span>
</pre></div>
</div>
<p>The total sum of squares quantifies the error between the measurement and the mean of measurments:</p>
<div class="math notranslate nohighlight">
\[SST = \sum_i (y_i - \bar{y}_i)\]</div>
<p>If we have the residual and total sum of squares, we can calculate the coefficient of determination:</p>
<div class="math notranslate nohighlight">
\[R^2 = 1 - \frac{SSE}{SST}\]</div>
<p>If you want to obtain estimates of standard error in the slope and y intercept that you regress, you need to estimate the covariance matrix.  First, we estimate the variance, <span class="math notranslate nohighlight">\(\sigma^2\)</span> with the following:</p>
<div class="math notranslate nohighlight">
\[\sigma^2 \approx s^2\]</div>
<p>and:</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{n_m - n_p}\]</div>
<p>Where <span class="math notranslate nohighlight">\(n_m\)</span> is the number of measurements and <span class="math notranslate nohighlight">\(n_p\)</span> is the number of regressed parameters.  This is also known as the “degrees of freedom” in our regression.</p>
<div class="math notranslate nohighlight">
\[s^2 = \frac{SSE}{DOF}\]</div>
<p>With that, we can estimate the covariance matrix from the measured data:</p>
<div class="math notranslate nohighlight">
\[COV = s^2(X'X)^{-1}\]</div>
<p>The standard error in our regressed parameters is given by the diagonal elements in the following matrix:</p>
<div class="math notranslate nohighlight">
\[se = \sqrt{COV}\]</div>
<p>From that, we get the standard error in the slope from se[0,0] and the standard error in the intercept from se[1,1], i.e., the diagonal elements.</p>
<p>If you want to calculate confidence intervals, they are given by:</p>
<div class="math notranslate nohighlight">
\[CI = t(q, DOF)\times SE\]</div>
<p>Finally, noting that I’m working with a linear system, if I want to generate predicted values of my measured quantity (here ln(CA)), I can do so by multiplying my truncated vandermonde matrix by the regressed coefficients:</p>
<div class="math notranslate nohighlight">
\[\hat{Y} = X\hat{A}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##These are textbook linear least squares formulas that I got from my statistics book</span>
<span class="c1">##They are calculating statistics on the fit, standard errors, confidence intervals, SSE, SST, R2, etc.</span>

<span class="n">X</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#X matrix, powers of measured ln(CA)</span>
<span class="n">Y</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rtrue</span><span class="p">)</span>                 <span class="c1">#Y vector, values of measured ln(r) </span>
<span class="n">A</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> <span class="c1">#regression coefficients, slope and intercept</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">X</span><span class="nd">@A</span><span class="p">)</span>           <span class="c1">#Residual sum of squares, equivalent to sum (y_i - y_hat_i)^2</span>
<span class="n">SST</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>      <span class="c1">#Total sum of squares, SST = sum(y_i - mean(y))^2</span>
<span class="n">R2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>                   <span class="c1">#R2</span>
<span class="n">s2</span>  <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>         <span class="c1">#essentially, a standard deviation approximation for variance, sigma^2</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">))</span>     <span class="c1">#covariance matrix</span>
<span class="n">se</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>             <span class="c1">#standard error matrix; diagonal elements are standard error in each coefficient</span>
<span class="n">ci</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="n">se</span> <span class="c1">#confidence intervals</span>
<span class="n">Ypred</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>   <span class="c1">#predicted values of Y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The R2 value for this fit is </span><span class="si">{</span><span class="n">R2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The regressed order is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.4f</span><span class="si">}</span><span class="s1"> and the regressed value of ln(k) is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The rate constant is approximately </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> s^-1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rtrue</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.51</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.         -3.77226106]
The R2 value for this fit is 1.000
The regressed order is 1.000 plus/minus 0.0000 and the regressed value of ln(k) is -3.772 plus/minus 0.000
The rate constant is approximately 0.023 s^-1
</pre></div>
</div>
<img alt="../_images/587-L31_6_1.png" src="../_images/587-L31_6_1.png" />
</div>
</div>
</section>
<section id="analysis-of-more-realistic-data">
<h4>Analysis of more realistic data…<a class="headerlink" href="#analysis-of-more-realistic-data" title="Permalink to this headline">#</a></h4>
<p>Now let’s work toward what a real data set might look like.  First, we’d never keep 10 sig figs for data we generated from, e.g., gas-chromatography in the lab. Let’s round the data to expected experimental precision; this includes measurements obtained at very short residence times by increasing the inlet flowrate to very large values. At this point, we are still looking at “perfect” data that I generated by solving a CSTR model.  I’ve just truncated the results and reported only 3 significant figures everywhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V</span>       <span class="o">=</span> <span class="mf">0.275</span> <span class="c1">#L</span>
<span class="n">CAf</span>     <span class="o">=</span> <span class="mi">10</span>    <span class="c1">#mol/L</span>
<span class="n">Qfdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.75</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.3667</span><span class="p">,</span> <span class="mf">0.275</span><span class="p">,</span> <span class="mf">0.1375</span><span class="p">,</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">0.0275</span><span class="p">,</span> <span class="mf">0.01833</span><span class="p">,</span> <span class="mf">0.01375</span><span class="p">,</span> <span class="mf">0.0055</span><span class="p">,</span> <span class="mf">0.00275</span><span class="p">])</span> <span class="c1">#mol/L</span>
<span class="n">CAdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.98</span><span class="p">,</span> <span class="mf">9.89</span><span class="p">,</span> <span class="mf">9.83</span><span class="p">,</span> <span class="mf">9.78</span><span class="p">,</span> <span class="mf">9.56</span><span class="p">,</span> <span class="mf">8.97</span><span class="p">,</span> <span class="mf">8.13</span><span class="p">,</span> <span class="mf">7.43</span><span class="p">,</span> <span class="mf">6.85</span><span class="p">,</span> <span class="mf">4.65</span><span class="p">,</span> <span class="mf">3.03</span><span class="p">])</span> <span class="c1">#L/sec</span>
<span class="n">taudata</span> <span class="o">=</span> <span class="n">V</span><span class="o">/</span><span class="n">Qfdata</span>
<span class="n">rdata</span>   <span class="o">=</span> <span class="p">(</span><span class="n">CAf</span> <span class="o">-</span> <span class="n">CAdata</span><span class="p">)</span><span class="o">/</span><span class="n">taudata</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tautrue</span><span class="p">,</span> <span class="n">CAtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">taudata</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data rounded to instrument precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;tau (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CA vs. space time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">rtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAdata</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data rounded to instrument precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;rate (M/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rtrue</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdata</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data rounded to instrument precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.51</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">CAdata</span><span class="p">,</span> <span class="p">(</span><span class="n">CAtrue</span> <span class="o">-</span> <span class="n">CAdata</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">CAtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rtrue</span><span class="p">,</span> <span class="n">rdata</span><span class="p">,</span> <span class="p">(</span><span class="n">rtrue</span> <span class="o">-</span> <span class="n">rdata</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">rtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L31_8_0.png" src="../_images/587-L31_8_0.png" />
<img alt="../_images/587-L31_8_1.png" src="../_images/587-L31_8_1.png" />
<img alt="../_images/587-L31_8_2.png" src="../_images/587-L31_8_2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 9.977e+00,  9.980e+00, -3.000e-02],
       [ 9.886e+00,  9.890e+00, -3.700e-02],
       [ 9.830e+00,  9.830e+00,  4.000e-03],
       [ 9.775e+00,  9.780e+00, -4.900e-02],
       [ 9.560e+00,  9.560e+00,  2.000e-03],
       [ 8.969e+00,  8.970e+00, -1.500e-02],
       [ 8.130e+00,  8.130e+00,  1.000e-03],
       [ 7.435e+00,  7.430e+00,  6.600e-02],
       [ 6.849e+00,  6.850e+00, -1.000e-02],
       [ 4.651e+00,  4.650e+00,  2.500e-02],
       [ 3.030e+00,  3.030e+00,  1.000e-02]])
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 2.2900e-01,  2.0000e-01,  1.2843e+01],
       [ 2.2700e-01,  2.2000e-01,  3.2480e+00],
       [ 2.2600e-01,  2.2700e-01, -2.6000e-01],
       [ 2.2500e-01,  2.2000e-01,  2.1480e+00],
       [ 2.2000e-01,  2.2000e-01, -5.2000e-02],
       [ 2.0600e-01,  2.0600e-01,  1.3500e-01],
       [ 1.8700e-01,  1.8700e-01, -4.0000e-03],
       [ 1.7100e-01,  1.7100e-01, -1.7500e-01],
       [ 1.5800e-01,  1.5800e-01,  2.2000e-02],
       [ 1.0700e-01,  1.0700e-01, -2.2000e-02],
       [ 7.0000e-02,  7.0000e-02, -4.0000e-03]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-regression-on-data-rounded-to-instrument-precision">
<h4>Linear Regression on Data Rounded to Instrument Precision<a class="headerlink" href="#linear-regression-on-data-rounded-to-instrument-precision" title="Permalink to this headline">#</a></h4>
<p>Just with rounding error, we can see some issues already starting to pop up here.  Data look mostly linear, except for at very high concentrations of A.  Let’s run through the regression and see what we get back.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##These are textbook linear least squares formulas that I got from my statistics book</span>
<span class="c1">##They are calculating statistics on the fit, standard errors, confidence intervals, SSE, SST, R2, etc.</span>

<span class="n">X</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#X matrix, powers of measured ln(CA)</span>
<span class="n">Y</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>                 <span class="c1">#Y vector, values of measured ln(r) </span>
<span class="n">A</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> <span class="c1">#regression coefficients, slope and intercept</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">X</span><span class="nd">@A</span><span class="p">)</span>           <span class="c1">#Residual sum of squares, equivalent to sum (y_i - y_hat_i)^2</span>
<span class="n">SST</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>      <span class="c1">#Total sum of squares, SST = sum(y_i - mean(y))^2</span>
<span class="n">R2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>                   <span class="c1">#R2</span>
<span class="n">s2</span>  <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>         <span class="c1">#essentially, a standard deviation approximation for variance, sigma^2</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">))</span>     <span class="c1">#covariance matrix</span>
<span class="n">se</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>             <span class="c1">#standard error matrix; diagonal elements are standard error in each coefficient</span>
<span class="n">ci</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="n">se</span> <span class="c1">#confidence intervals</span>
<span class="n">Ypred</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>   <span class="c1">#predicted values of Y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The R2 value for this fit is </span><span class="si">{</span><span class="n">R2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The regressed order is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.4f</span><span class="si">}</span><span class="s1"> and the regressed value of ln(k) is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The rate constant is approximately </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> s^-1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdata</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data rounded to instrument precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">),</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.51</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.96411599 -3.71675384]
The R2 value for this fit is 0.989
The regressed order is 0.964 plus/minus 0.0777 and the regressed value of ln(k) is -3.717 plus/minus 0.160
The rate constant is approximately 0.024 s^-1
</pre></div>
</div>
<img alt="../_images/587-L31_10_1.png" src="../_images/587-L31_10_1.png" />
</div>
</div>
</section>
<section id="adding-noise-to-the-data-simulating-a-real-experiment">
<h4>Adding Noise to the Data (simulating a real experiment)<a class="headerlink" href="#adding-noise-to-the-data-simulating-a-real-experiment" title="Permalink to this headline">#</a></h4>
<p>Now we are going to make this data resemble something we’d get in a lab by adding some random noise.  This is gaussian noise (I’m adding a random number taken from a gaussian distribution with a given standard deviation).  For now, we’ll look at how that impacts our measurments and the rates that we estimate from those measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#percent standard deviation on the mean.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">noise_level</span><span class="p">))</span>
<span class="n">V</span>       <span class="o">=</span> <span class="mf">0.275</span> <span class="c1">#L</span>
<span class="n">CAf</span>     <span class="o">=</span> <span class="mi">10</span>    <span class="c1">#mol/L</span>
<span class="n">Qfdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.75</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.3667</span><span class="p">,</span> <span class="mf">0.275</span><span class="p">,</span> <span class="mf">0.1375</span><span class="p">,</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">0.0275</span><span class="p">,</span> <span class="mf">0.01833</span><span class="p">,</span> <span class="mf">0.01375</span><span class="p">,</span> <span class="mf">0.0055</span><span class="p">,</span> <span class="mf">0.00275</span><span class="p">])</span> <span class="c1">#mol/L</span>
<span class="n">CAdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.98</span><span class="p">,</span> <span class="mf">9.89</span><span class="p">,</span> <span class="mf">9.83</span><span class="p">,</span> <span class="mf">9.78</span><span class="p">,</span> <span class="mf">9.56</span><span class="p">,</span> <span class="mf">8.97</span><span class="p">,</span> <span class="mf">8.13</span><span class="p">,</span> <span class="mf">7.43</span><span class="p">,</span> <span class="mf">6.85</span><span class="p">,</span> <span class="mf">4.65</span><span class="p">,</span> <span class="mf">3.03</span><span class="p">])</span> <span class="c1">#L/sec</span>
<span class="n">taudata</span> <span class="o">=</span> <span class="n">V</span><span class="o">/</span><span class="n">Qfdata</span>
<span class="n">noise</span>   <span class="o">=</span> <span class="n">CAdata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">CAdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">CAdatan</span> <span class="o">=</span> <span class="n">CAdata</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">rdata</span>   <span class="o">=</span> <span class="p">(</span><span class="n">CAf</span> <span class="o">-</span> <span class="n">CAdata</span><span class="p">)</span><span class="o">/</span><span class="n">taudata</span>
<span class="n">rdatan</span>  <span class="o">=</span> <span class="p">(</span><span class="n">CAf</span> <span class="o">-</span> <span class="n">CAdatan</span><span class="p">)</span><span class="o">/</span><span class="n">taudata</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tautrue</span><span class="p">,</span> <span class="n">CAtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">taudata</span><span class="p">,</span> <span class="n">CAdatan</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;tau (s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CA vs. space time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">rtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">,</span> <span class="n">rdatan</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;rate (M/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;rate vs. CA&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(0, 12)</span>
<span class="c1">#plt.ylim(0, 0.4)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rtrue</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdatan</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(1.0, 2.5)</span>
<span class="c1">#plt.xticks(np.arange(1.0, 2.51, 0.25))</span>
<span class="c1">#plt.ylim(-1.0, -3.0)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">CAdatan</span><span class="p">,</span> <span class="p">(</span><span class="n">CAtrue</span> <span class="o">-</span> <span class="n">CAdatan</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">CAtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rtrue</span><span class="p">,</span> <span class="n">rdatan</span><span class="p">,</span> <span class="p">(</span><span class="n">rtrue</span> <span class="o">-</span> <span class="n">rdatan</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">rtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L31_12_0.png" src="../_images/587-L31_12_0.png" />
<img alt="../_images/587-L31_12_1.png" src="../_images/587-L31_12_1.png" />
<img alt="../_images/587-L31_12_2.png" src="../_images/587-L31_12_2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 9.97705278e+00,  9.98000000e+00, -2.95400001e-02],
       [ 9.88630746e+00,  9.89000000e+00, -3.73499996e-02],
       [ 9.83042517e+00,  9.83000000e+00,  4.32500012e-03],
       [ 9.77517107e+00,  9.78000000e+00, -4.93999999e-02],
       [ 9.56022945e+00,  9.56000000e+00,  2.39999993e-03],
       [ 8.96860987e+00,  8.97000000e+00, -1.54999997e-02],
       [ 8.13008130e+00,  8.13000000e+00,  9.99999840e-04],
       [ 7.43494424e+00,  7.43000000e+00,  6.64999998e-02],
       [ 6.84931507e+00,  6.85000000e+00, -9.99999990e-03],
       [ 4.65116279e+00,  4.65000000e+00,  2.50000000e-02],
       [ 3.03030303e+00,  3.03000000e+00,  9.99999990e-03]])
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 2.2900e-01,  2.0000e-01,  1.2843e+01],
       [ 2.2700e-01,  2.2000e-01,  3.2480e+00],
       [ 2.2600e-01,  2.2700e-01, -2.6000e-01],
       [ 2.2500e-01,  2.2000e-01,  2.1480e+00],
       [ 2.2000e-01,  2.2000e-01, -5.2000e-02],
       [ 2.0600e-01,  2.0600e-01,  1.3500e-01],
       [ 1.8700e-01,  1.8700e-01, -4.0000e-03],
       [ 1.7100e-01,  1.7100e-01, -1.7500e-01],
       [ 1.5800e-01,  1.5800e-01,  2.2000e-02],
       [ 1.0700e-01,  1.0700e-01, -2.2000e-02],
       [ 7.0000e-02,  7.0000e-02, -4.0000e-03]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##These are textbook linear least squares formulas that I got from my statistics book</span>
<span class="c1">##They are calculating statistics on the fit, standard errors, confidence intervals, SSE, SST, R2, etc.</span>

<span class="n">X</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#X matrix, powers of measured ln(CA)</span>
<span class="n">Y</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdatan</span><span class="p">)</span>                 <span class="c1">#Y vector, values of measured ln(r) </span>
<span class="n">A</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> <span class="c1">#regression coefficients, slope and intercept</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">X</span><span class="nd">@A</span><span class="p">)</span>           <span class="c1">#Residual sum of squares, equivalent to sum (y_i - y_hat_i)^2</span>
<span class="n">SST</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>      <span class="c1">#Total sum of squares, SST = sum(y_i - mean(y))^2</span>
<span class="n">R2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>                   <span class="c1">#R2</span>
<span class="n">s2</span>  <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>         <span class="c1">#essentially, a standard deviation approximation for variance, sigma^2</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">))</span>     <span class="c1">#covariance matrix</span>
<span class="n">se</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>             <span class="c1">#standard error matrix; diagonal elements are standard error in each coefficient</span>
<span class="n">ci</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="n">se</span> <span class="c1">#confidence intervals</span>
<span class="n">Ypred</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>   <span class="c1">#predicted values of Y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The R2 value for this fit is </span><span class="si">{</span><span class="n">R2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The regressed order is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.4f</span><span class="si">}</span><span class="s1"> and the regressed value of ln(k) is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The rate constant is approximately </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> s^-1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdatan</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(1.0, 2.5)</span>
<span class="c1">#plt.xticks(np.arange(1.0, 2.51, 0.25))</span>
<span class="c1">#plt.ylim(-1.4, -2.8)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.96411599 -3.71675384]
The R2 value for this fit is 0.989
The regressed order is 0.964 plus/minus 0.0777 and the regressed value of ln(k) is -3.717 plus/minus 0.160
The rate constant is approximately 0.024 s^-1
</pre></div>
</div>
<img alt="../_images/587-L31_13_1.png" src="../_images/587-L31_13_1.png" />
</div>
</div>
<p>The problem above isn’t in our logic or in our math…it’s in our precision, specifically the ability to measure concentrations in the laboratory.  Consider our definition of the rate in this CSTR as we’ve defined it so far.  It is based on measuring the change in the concentration of species A relative to the feed at a given residence time:</p>
<div class="math notranslate nohighlight">
\[r = \frac{C_{Af} - C_A}{\tau}\]</div>
<p>If we go to residence times near zero, then our fractional conversion goes to zero (consider that <span class="math notranslate nohighlight">\(X_A = r\tau/C_{Af}\)</span>).  In the limit of zero conversion, then:</p>
<div class="math notranslate nohighlight">
\[C_{Af} \approx C_A\]</div>
<p>Measuring precise changes in the concentration of reactant as the conversion of that reactant approaches zero is very difficult.  It only takes a bit of uncertainty in our measurements before we’re getting results like <span class="math notranslate nohighlight">\(C_A &gt; C_{Af}\)</span> for very small values of <span class="math notranslate nohighlight">\(\tau\)</span>.  Physically, that’s impossible for this reaction, but our limits on precision make it something we have to contend with.  When we’re in this situation of trying to determine reaction rates at nearly zero conversion, the better approach is to do this based on a balance on our product:</p>
<div class="math notranslate nohighlight">
\[0 = C_{Bf} - C_B + R_B\tau\]</div>
<p>Since <span class="math notranslate nohighlight">\(R_B = r\)</span>, this can be solved to give:</p>
<div class="math notranslate nohighlight">
\[r = \frac{C_B}{\tau}\]</div>
<p>Now, we’re basically measuring the change in concentration of species B relative to zero (the inlet concentration of B).  Those measurements are still subject to the usual uncertainty, but we’ll see that the reaction rates we estimate are far more precise in the limit of zero conversion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_level</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#percent standard deviation on the mean.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">noise_level</span><span class="p">))</span>

<span class="n">V</span>       <span class="o">=</span> <span class="mf">0.275</span> <span class="c1">#L</span>
<span class="n">CAf</span>     <span class="o">=</span> <span class="mi">10</span>    <span class="c1">#mol/L</span>
<span class="n">Qfdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.75</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.3667</span><span class="p">,</span> <span class="mf">0.275</span><span class="p">,</span> <span class="mf">0.1375</span><span class="p">,</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">0.0275</span><span class="p">,</span> <span class="mf">0.01833</span><span class="p">,</span> <span class="mf">0.01375</span><span class="p">,</span> <span class="mf">0.0055</span><span class="p">,</span> <span class="mf">0.00275</span><span class="p">])</span> <span class="c1">#mol/L</span>
<span class="n">CAdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.98</span><span class="p">,</span> <span class="mf">9.89</span><span class="p">,</span> <span class="mf">9.83</span><span class="p">,</span> <span class="mf">9.78</span><span class="p">,</span> <span class="mf">9.56</span><span class="p">,</span> <span class="mf">8.97</span><span class="p">,</span> <span class="mf">8.13</span><span class="p">,</span> <span class="mf">7.43</span><span class="p">,</span> <span class="mf">6.85</span><span class="p">,</span> <span class="mf">4.65</span><span class="p">,</span> <span class="mf">3.03</span><span class="p">])</span> <span class="c1">#L/sec</span>
<span class="n">CBtrue</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.022947221</span><span class="p">,</span> <span class="mf">0.113692536</span><span class="p">,</span> <span class="mf">0.169574834</span><span class="p">,</span> <span class="mf">0.224828935</span><span class="p">,</span> <span class="mf">0.439770554</span><span class="p">,</span> <span class="mf">1.031390135</span><span class="p">,</span> <span class="mf">1.869918699</span><span class="p">,</span> <span class="mf">2.565055762</span><span class="p">,</span> <span class="mf">3.150684932</span><span class="p">,</span> <span class="mf">5.348837209</span><span class="p">,</span> <span class="mf">6.96969697</span><span class="p">])</span> 
<span class="n">taudata</span> <span class="o">=</span> <span class="n">V</span><span class="o">/</span><span class="n">Qfdata</span>
<span class="n">CBdata</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">CBtrue</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">noise</span>   <span class="o">=</span> <span class="n">CBdata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">CBdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">CBdatan</span> <span class="o">=</span> <span class="n">CBdata</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">noiseA</span>  <span class="o">=</span> <span class="n">CAdata</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">CAdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">CAdatan</span> <span class="o">=</span> <span class="n">CAdata</span> <span class="o">+</span> <span class="n">noiseA</span>

<span class="n">rbtrue</span>  <span class="o">=</span> <span class="n">CBtrue</span><span class="o">/</span><span class="n">tautrue</span>
<span class="n">rbdatan</span>  <span class="o">=</span> <span class="p">(</span><span class="n">CBdatan</span><span class="p">)</span><span class="o">/</span><span class="n">taudata</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tautrue</span><span class="p">,</span> <span class="n">CBtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">taudata</span><span class="p">,</span> <span class="n">CBdatan</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;tau (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CB (M)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CB vs. space time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">,</span> <span class="n">rbtrue</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">,</span> <span class="n">rbdatan</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CA (M)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;rate (M/s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAtrue</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rbtrue</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;perfect data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rbdatan</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">CBtrue</span><span class="p">,</span> <span class="n">CBdatan</span><span class="p">,</span> <span class="p">(</span><span class="n">CBtrue</span> <span class="o">-</span> <span class="n">CBdatan</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">CBtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rbtrue</span><span class="p">,</span> <span class="n">rbdatan</span><span class="p">,</span> <span class="p">(</span><span class="n">rbtrue</span> <span class="o">-</span> <span class="n">rbdatan</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">rbtrue</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/587-L31_15_0.png" src="../_images/587-L31_15_0.png" />
<img alt="../_images/587-L31_15_1.png" src="../_images/587-L31_15_1.png" />
<img alt="../_images/587-L31_15_2.png" src="../_images/587-L31_15_2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 2.29472210e-02,  2.30000000e-02, -2.30001707e-01],
       [ 1.13692536e-01,  1.14000000e-01, -2.70434640e-01],
       [ 1.69574834e-01,  1.70000000e-01, -2.50724704e-01],
       [ 2.24828935e-01,  2.25000000e-01, -7.60867368e-02],
       [ 4.39770554e-01,  4.40000000e-01, -5.21740253e-02],
       [ 1.03139014e+00,  1.03100000e+00,  3.78261326e-02],
       [ 1.86991870e+00,  1.87000000e+00, -4.34783609e-03],
       [ 2.56505576e+00,  2.56500000e+00,  2.17390986e-03],
       [ 3.15068493e+00,  3.15100000e+00, -9.99998435e-03],
       [ 5.34883721e+00,  5.34900000e+00, -3.04348391e-03],
       [ 6.96969697e+00,  6.97000000e+00, -4.34782174e-03]])
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.22947221,  0.23      , -0.23000171],
       [ 0.22738507,  0.228     , -0.27043464],
       [ 0.22609978,  0.22668727, -0.2598384 ],
       [ 0.22482894,  0.225     , -0.07608674],
       [ 0.21988528,  0.22      , -0.05217403],
       [ 0.20627803,  0.2062    ,  0.03782613],
       [ 0.18699187,  0.187     , -0.00434784],
       [ 0.17100372,  0.17096891,  0.02035515],
       [ 0.15753425,  0.15755   , -0.00999998],
       [ 0.10697674,  0.10698   , -0.00304348],
       [ 0.06969697,  0.0697    , -0.00434782]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##These are textbook linear least squares formulas that I got from my statistics book</span>
<span class="c1">##They are calculating statistics on the fit, standard errors, confidence intervals, SSE, SST, R2, etc.</span>

<span class="n">X</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#X matrix, powers of measured ln(CA)</span>
<span class="n">Y</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rbdatan</span><span class="p">)</span>                 <span class="c1">#Y vector, values of measured ln(r) </span>
<span class="n">A</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span> <span class="c1">#regression coefficients, slope and intercept</span>
<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">X</span><span class="nd">@A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">X</span><span class="nd">@A</span><span class="p">)</span>           <span class="c1">#Residual sum of squares, equivalent to sum (y_i - y_hat_i)^2</span>
<span class="n">SST</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>      <span class="c1">#Total sum of squares, SST = sum(y_i - mean(y))^2</span>
<span class="n">R2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSE</span><span class="o">/</span><span class="n">SST</span>                   <span class="c1">#R2</span>
<span class="n">s2</span>  <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>         <span class="c1">#essentially, a standard deviation approximation for variance, sigma^2</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">s2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">))</span>     <span class="c1">#covariance matrix</span>
<span class="n">se</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cov</span><span class="p">))</span>             <span class="c1">#standard error matrix; diagonal elements are standard error in each coefficient</span>
<span class="n">ci</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="n">se</span> <span class="c1">#confidence intervals</span>
<span class="n">Ypred</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>   <span class="c1">#predicted values of Y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The R2 value for this fit is </span><span class="si">{</span><span class="n">R2</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The regressed order is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.4f</span><span class="si">}</span><span class="s1"> and the regressed value of ln(k) is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> plus/minus </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The rate constant is approximately </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s1">3.3f</span><span class="si">}</span><span class="s1"> s^-1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rbdatan</span><span class="p">),</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;real data with </span><span class="si">{</span><span class="n">noise_level</span><span class="si">}</span><span class="s1">% standard deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdatan</span><span class="p">),</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;linear regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ln(CA)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;linearized rate vs. CA&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(1.0, 2.5)</span>
<span class="c1">#plt.xticks(np.arange(1.0, 2.51, 0.25))</span>
<span class="c1">#plt.ylim(-1.4, -2.8)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.00115817 -3.77386275]
The R2 value for this fit is 1.000
The regressed order is 1.001 plus/minus 0.0019 and the regressed value of ln(k) is -3.774 plus/minus 0.004
The rate constant is approximately 0.023 s^-1
</pre></div>
</div>
<img alt="../_images/587-L31_16_1.png" src="../_images/587-L31_16_1.png" />
</div>
</div>
</section>
</section>
</section>
<section id="example-problem-02">
<h2>Example Problem 02<a class="headerlink" href="#example-problem-02" title="Permalink to this headline">#</a></h2>
<p>Next, we’ll consider a data set where not much has been done systematically.</p>
<p>Someone decided to perform a “kinetic study” of the following reaction in a CSTR.</p>
<div class="math notranslate nohighlight">
\[A + 2B \longrightarrow 3C\]</div>
<p>We propose that the rate of reaction depends on concentrations of A and B in some power law model:</p>
<div class="math notranslate nohighlight">
\[r = kC_A^\alpha C_B^\beta\]</div>
<p>Our technician made some interesting choices in how they ran the experiment.  They apparently varied space time (by varying feed flowrate), and they also seem to have been randomly changing the concentrations of both A and B in the feed with every change in residence time.  We’d love to get an estimate for k, <span class="math notranslate nohighlight">\(\alpha\)</span>, and <span class="math notranslate nohighlight">\(\beta\)</span>, but it looks like it might be challenging considering the way the experiment was performed.</p>
<p>Never fear; we know how to wrangle data…</p>
<p>The data are in an attached CSV file.  The bit of code below opens that file and convert it into a numpy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;CSTRdata.csv&quot;</span><span class="p">)</span>
<span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">~\AppData\Local\Temp\ipykernel_8336\852484166.py</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;CSTRdata.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">dataframe</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\util\_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span> 
<span class="ne">--&gt; </span><span class="mi">680</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">681</span> 
<span class="g g-Whitespace">    </span><span class="mi">682</span> 

<span class="nn">~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span> 
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">575</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span> 
<span class="g g-Whitespace">    </span><span class="mi">577</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">932</span> 
<span class="g g-Whitespace">    </span><span class="mi">933</span>         <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">934</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> 
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1216</span>             <span class="c1"># &quot;Union[str, PathLike[str], ReadCsvBuffer[bytes], ReadCsvBuffer[str]]&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1217</span>             <span class="c1"># , &quot;str&quot;, &quot;bool&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1218</span>             <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>  <span class="c1"># type: ignore[call-overload]</span>
<span class="g g-Whitespace">   </span><span class="mi">1219</span>                 <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1220</span>                 <span class="n">mode</span><span class="p">,</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\io\common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">784</span>         <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span>             <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">786</span>             <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">787</span>                 <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span>                 <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;CSTRdata.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;CSTRdata.csv&quot;</span><span class="p">)</span>
<span class="n">csvreader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">csvreader</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csvreader</span><span class="p">:</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="parameter-estimation-using-nonlinear-regression">
<h3>Parameter Estimation Using Nonlinear Regression<a class="headerlink" href="#parameter-estimation-using-nonlinear-regression" title="Permalink to this headline">#</a></h3>
<p>One solution is to use nonlinear regression to minimize an objective function created by calculating the residual sum of squares between measured rates and model predicted rates.  Example below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taudata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">CAfdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">CBfdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">CCfdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">XAdata</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>

<span class="n">CAdata</span>  <span class="o">=</span> <span class="n">CAfdata</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">XAdata</span><span class="p">)</span>
<span class="n">CBdata</span>  <span class="o">=</span> <span class="n">CBfdata</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">CAfdata</span><span class="o">*</span><span class="n">XAdata</span>
<span class="n">CCdata</span>  <span class="o">=</span> <span class="n">CCfdata</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">CAfdata</span><span class="o">*</span><span class="n">XAdata</span>
<span class="n">rdata</span>   <span class="o">=</span> <span class="n">CCdata</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="n">taudata</span>
<span class="n">meas</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">CAdata</span><span class="p">,</span> <span class="n">CBdata</span><span class="p">,</span> <span class="n">CCdata</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rates_CSTR</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">meas</span><span class="p">):</span>
    <span class="n">k</span>     <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">CA</span>  <span class="o">=</span> <span class="n">meas</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">CB</span>  <span class="o">=</span> <span class="n">meas</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">rmod</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">CA</span><span class="o">**</span><span class="n">alpha</span><span class="o">*</span><span class="n">CB</span><span class="o">**</span><span class="n">beta</span>
    <span class="k">return</span> <span class="n">rmod</span>

<span class="n">par0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">OBJ</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">par</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rates_CSTR</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">meas</span><span class="p">)</span> <span class="o">-</span> <span class="n">rdata</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ans</span>  <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">OBJ</span><span class="p">,</span> <span class="n">par0</span><span class="p">)</span>
<span class="n">ans</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      fun: 2.3554880977158813e-13
 hess_inv: array([[ 0.83416139,  1.38191673, -2.22554533],
       [ 1.38191673,  3.05170545, -3.48387855],
       [-2.22554533, -3.48387855,  6.06915988]])
      jac: array([-6.55642979e-07,  3.95426875e-08, -2.07312503e-07])
  message: &#39;Optimization terminated successfully.&#39;
     nfev: 100
      nit: 21
     njev: 25
   status: 0
  success: True
        x: array([0.34699937, 0.99999891, 2.00000167])
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-linear-regression">
<h3>Multiple Linear Regression<a class="headerlink" href="#multiple-linear-regression" title="Permalink to this headline">#</a></h3>
<p>Alternatively, we can linearize this problem.  We know that the rate of reaction should be given by a power law:</p>
<div class="math notranslate nohighlight">
\[r = k{C_A}^\alpha {C_B}^\beta\]</div>
<p>This can be linearized as usual by taking logarithms of both sides to give:</p>
<div class="math notranslate nohighlight">
\[\ln(r) = \ln(k) + \alpha \ln(C_A) + \beta \ln(C_B)\]</div>
<p>Putting this into matrix form, we would have:</p>
<div class="math notranslate nohighlight">
\[XA = Y\]</div>
<p>Where</p>
<p>X is a vandermonde type matrix in which each row is:</p>
<div class="math notranslate nohighlight">
\[X[i,:] = \begin{bmatrix} 1 &amp; \ln(C_A)_i &amp; \ln(C_B)_i \end{bmatrix}\]</div>
<p>Where</p>
<div class="math notranslate nohighlight">
\[\begin{split}A = \begin{bmatrix} \ln(k) \\ \alpha \\ \beta \end{bmatrix}\end{split}\]</div>
<p>And where Y is a vector of our measurements, in this case, ln(r), so each entry is given by:</p>
<div class="math notranslate nohighlight">
\[Y[i] = \ln(r)_i\]</div>
<p>With those definitions, we can perform linear regression as usual.  Below, I create the X matrix manually because I don’t know offhand of an automated way to generate the X matrix for multiple linear regression.  Once that is done, you solve the least squares problem as usual:</p>
<div class="math notranslate nohighlight">
\[\hat{A} = (X^\prime X)^{-1}X^\prime Y\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">rdata</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CAdata</span><span class="p">)</span>
<span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">CBdata</span><span class="p">)</span>
<span class="n">Y</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>
<span class="n">A</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@X</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="nd">@Y</span><span class="p">)</span>
<span class="n">Ypred</span>  <span class="o">=</span> <span class="n">X</span><span class="nd">@A</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Order in A is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1">, order in B is </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1">, rate constant is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1"> L^2/M^2/min&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Ypred</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Parity Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Measured ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted ln(r)&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Order in A is 1.00, order in B is 2.00, rate constant is 0.35 L^2/M^2/min
</pre></div>
</div>
<img alt="../_images/587-L31_24_1.png" src="../_images/587-L31_24_1.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="587-L28.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lecture 28</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="587-L32.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 32</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jesse Q. Bond, Syracuse University<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>